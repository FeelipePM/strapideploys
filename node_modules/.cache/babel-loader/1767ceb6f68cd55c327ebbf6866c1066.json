{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AssetDialog = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _Plus = _interopRequireDefault(require(\"@strapi/icons/Plus\"));\n\nvar _ModalLayout = require(\"@strapi/design-system/ModalLayout\");\n\nvar _Flex = require(\"@strapi/design-system/Flex\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Divider = require(\"@strapi/design-system/Divider\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _Tabs = require(\"@strapi/design-system/Tabs\");\n\nvar _Badge = require(\"@strapi/design-system/Badge\");\n\nvar _Loader = require(\"@strapi/design-system/Loader\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nvar _SelectedStep = require(\"./SelectedStep\");\n\nvar _BrowseStep = require(\"./BrowseStep\");\n\nvar _useMediaLibraryPermissions = require(\"../../hooks/useMediaLibraryPermissions\");\n\nvar _useModalAssets2 = require(\"../../hooks/useModalAssets\");\n\nvar _useModalQueryParams5 = _interopRequireDefault(require(\"../../hooks/useModalAssets/useModalQueryParams\"));\n\nvar _constants = require(\"../../constants\");\n\nvar _getAllowedFiles = _interopRequireDefault(require(\"../../utils/getAllowedFiles\"));\n\nvar _DialogTitle = require(\"./DialogTitle\");\n\nvar _DialogFooter = require(\"./DialogFooter\");\n\nvar _EditAssetDialog = require(\"../EditAssetDialog\");\n\nvar _EmptyAssets = require(\"../EmptyAssets\");\n\nvar _moveElement = require(\"../../utils/moveElement\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar AssetDialog = function AssetDialog(_ref) {\n  var allowedTypes = _ref.allowedTypes,\n      onClose = _ref.onClose,\n      onAddAsset = _ref.onAddAsset,\n      _onValidate = _ref.onValidate,\n      multiple = _ref.multiple,\n      initiallySelectedAssets = _ref.initiallySelectedAssets,\n      trackedLocation = _ref.trackedLocation;\n\n  var _useState = (0, _react.useState)(undefined),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      assetToEdit = _useState2[0],\n      setAssetToEdit = _useState2[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useMediaLibraryPermi = (0, _useMediaLibraryPermissions.useMediaLibraryPermissions)(),\n      canRead = _useMediaLibraryPermi.canRead,\n      canCreate = _useMediaLibraryPermi.canCreate,\n      isLoadingPermissions = _useMediaLibraryPermi.isLoading,\n      canUpdate = _useMediaLibraryPermi.canUpdate,\n      canCopyLink = _useMediaLibraryPermi.canCopyLink,\n      canDownload = _useMediaLibraryPermi.canDownload;\n\n  var _useModalQueryParams = (0, _useModalQueryParams5[\"default\"])(),\n      _useModalQueryParams2 = (0, _slicedToArray2[\"default\"])(_useModalQueryParams, 2),\n      _useModalQueryParams3 = _useModalQueryParams2[0],\n      rawQuery = _useModalQueryParams3.rawQuery,\n      queryObject = _useModalQueryParams3.queryObject,\n      _useModalQueryParams4 = _useModalQueryParams2[1],\n      onChangeFilters = _useModalQueryParams4.onChangeFilters,\n      onChangePage = _useModalQueryParams4.onChangePage,\n      onChangePageSize = _useModalQueryParams4.onChangePageSize,\n      onChangeSort = _useModalQueryParams4.onChangeSort,\n      onChangeSearch = _useModalQueryParams4.onChangeSearch;\n\n  var _useModalAssets = (0, _useModalAssets2.useModalAssets)({\n    skipWhen: !canRead,\n    rawQuery: rawQuery\n  }),\n      data = _useModalAssets.data,\n      isLoading = _useModalAssets.isLoading,\n      error = _useModalAssets.error;\n\n  var _useSelectionState = (0, _helperPlugin.useSelectionState)('id', initiallySelectedAssets),\n      _useSelectionState2 = (0, _slicedToArray2[\"default\"])(_useSelectionState, 2),\n      selectedAssets = _useSelectionState2[0],\n      _useSelectionState2$ = _useSelectionState2[1],\n      selectOne = _useSelectionState2$.selectOne,\n      selectAll = _useSelectionState2$.selectAll,\n      selectOnly = _useSelectionState2$.selectOnly,\n      setSelections = _useSelectionState2$.setSelections;\n\n  var _useState3 = (0, _react.useState)(selectedAssets.length > 0 ? 1 : 0),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      initialSelectedTabIndex = _useState4[0],\n      setInitialSelectedTabIndex = _useState4[1];\n\n  var handleSelectAllAssets = function handleSelectAllAssets() {\n    var hasAllAssets = assets.every(function (asset) {\n      return selectedAssets.findIndex(function (curr) {\n        return curr.id === asset.id;\n      }) !== -1;\n    });\n\n    if (hasAllAssets) {\n      return multiple ? selectAll(assets) : undefined;\n    }\n\n    var allowedAssets = (0, _getAllowedFiles[\"default\"])(allowedTypes, assets);\n    return multiple ? selectAll(allowedAssets) : undefined;\n  };\n\n  var handleSelectAsset = function handleSelectAsset(asset) {\n    return multiple ? selectOne(asset) : selectOnly(asset);\n  };\n\n  var loading = isLoadingPermissions || isLoading;\n  var assets = data === null || data === void 0 ? void 0 : data.results;\n\n  if (loading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n      onClose: onClose,\n      labelledBy: \"asset-dialog-title\",\n      \"aria-busy\": true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_DialogTitle.DialogTitle, null), /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, {\n      justifyContent: \"center\",\n      paddingTop: 4,\n      paddingBottom: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Loader.Loader, null, formatMessage({\n      id: (0, _getTrad[\"default\"])('list.asset.load'),\n      defaultMessage: 'How do you want to upload your assets?'\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_DialogFooter.DialogFooter, {\n      onClose: onClose\n    }));\n  }\n\n  if (error) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n      onClose: onClose,\n      labelledBy: \"asset-dialog-title\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_DialogTitle.DialogTitle, null), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.AnErrorOccurred, null), /*#__PURE__*/_react[\"default\"].createElement(_DialogFooter.DialogFooter, {\n      onClose: onClose\n    }));\n  }\n\n  if (!canRead) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n      onClose: onClose,\n      labelledBy: \"asset-dialog-title\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_DialogTitle.DialogTitle, null), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.NoPermissions, null), /*#__PURE__*/_react[\"default\"].createElement(_DialogFooter.DialogFooter, {\n      onClose: onClose\n    }));\n  }\n\n  if (canRead && (assets === null || assets === void 0 ? void 0 : assets.length) === 0 && !queryObject._q && queryObject.filters.$and.length === 0) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n      onClose: onClose,\n      labelledBy: \"asset-dialog-title\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_DialogTitle.DialogTitle, null), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingLeft: 8,\n      paddingRight: 8,\n      paddingBottom: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_EmptyAssets.EmptyAssets, {\n      size: \"S\",\n      count: 6,\n      action: canCreate ? /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        variant: \"secondary\",\n        startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Plus[\"default\"], null),\n        onClick: onAddAsset\n      }, formatMessage({\n        id: (0, _getTrad[\"default\"])('header.actions.add-assets'),\n        defaultMessage: 'Add new assets'\n      })) : undefined,\n      content: canCreate ? formatMessage({\n        id: (0, _getTrad[\"default\"])('list.assets.empty'),\n        defaultMessage: 'Upload your first assets...'\n      }) : formatMessage({\n        id: (0, _getTrad[\"default\"])('list.assets.empty.no-permissions'),\n        defaultMessage: 'The asset list is empty'\n      })\n    })), /*#__PURE__*/_react[\"default\"].createElement(_DialogFooter.DialogFooter, {\n      onClose: onClose\n    }));\n  }\n\n  if (assetToEdit) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_EditAssetDialog.EditAssetDialog, {\n      onClose: function onClose() {\n        return setAssetToEdit(undefined);\n      },\n      asset: assetToEdit,\n      canUpdate: canUpdate,\n      canCopyLink: canCopyLink,\n      canDownload: canDownload,\n      trackedLocation: trackedLocation\n    });\n  }\n\n  var handleMoveItem = function handleMoveItem(hoverIndex, destIndex) {\n    var offset = destIndex - hoverIndex;\n    var orderedAssetsClone = selectedAssets.slice();\n    var nextAssets = (0, _moveElement.moveElement)(orderedAssetsClone, hoverIndex, offset);\n    setSelections(nextAssets);\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n    onClose: onClose,\n    labelledBy: \"asset-dialog-title\",\n    \"aria-busy\": loading\n  }, /*#__PURE__*/_react[\"default\"].createElement(_DialogTitle.DialogTitle, null), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabGroup, {\n    label: formatMessage({\n      id: (0, _getTrad[\"default\"])('tabs.title'),\n      defaultMessage: 'How do you want to upload your assets?'\n    }),\n    variant: \"simple\",\n    initialSelectedTabIndex: initialSelectedTabIndex,\n    onTabChange: function onTabChange() {\n      return setInitialSelectedTabIndex(0);\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, {\n    paddingLeft: 8,\n    paddingRight: 8,\n    paddingTop: 6,\n    justifyContent: \"space-between\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.Tabs, null, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.Tab, null, formatMessage({\n    id: (0, _getTrad[\"default\"])('modal.nav.browse'),\n    defaultMessage: 'Browse'\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.Tab, null, formatMessage({\n    id: (0, _getTrad[\"default\"])('modal.header.select-files'),\n    defaultMessage: 'Selected files'\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Badge.Badge, {\n    marginLeft: 2\n  }, selectedAssets.length))), /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n    onClick: onAddAsset\n  }, formatMessage({\n    id: (0, _getTrad[\"default\"])('modal.upload-list.sub-header.button'),\n    defaultMessage: 'Add more assets'\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Divider.Divider, null), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanels, null, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalBody, null, /*#__PURE__*/_react[\"default\"].createElement(_BrowseStep.BrowseStep, {\n    allowedTypes: allowedTypes,\n    assets: assets,\n    onSelectAsset: handleSelectAsset,\n    selectedAssets: selectedAssets,\n    multiple: multiple,\n    onSelectAllAsset: handleSelectAllAssets,\n    onEditAsset: canUpdate ? setAssetToEdit : undefined,\n    pagination: data === null || data === void 0 ? void 0 : data.pagination,\n    queryObject: queryObject,\n    onChangeFilters: onChangeFilters,\n    onChangePage: onChangePage,\n    onChangePageSize: onChangePageSize,\n    onChangeSort: onChangeSort,\n    onChangeSearch: onChangeSearch\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalBody, null, /*#__PURE__*/_react[\"default\"].createElement(_SelectedStep.SelectedStep, {\n    selectedAssets: selectedAssets,\n    onSelectAsset: handleSelectAsset,\n    onReorderAsset: handleMoveItem\n  }))))), /*#__PURE__*/_react[\"default\"].createElement(_DialogFooter.DialogFooter, {\n    onClose: onClose,\n    onValidate: function onValidate() {\n      return _onValidate(selectedAssets);\n    }\n  }));\n};\n\nexports.AssetDialog = AssetDialog;\nAssetDialog.defaultProps = {\n  allowedTypes: [],\n  initiallySelectedAssets: [],\n  multiple: false,\n  trackedLocation: undefined\n};\nAssetDialog.propTypes = {\n  allowedTypes: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].string),\n  initiallySelectedAssets: _propTypes[\"default\"].arrayOf(_constants.AssetDefinition),\n  multiple: _propTypes[\"default\"].bool,\n  onAddAsset: _propTypes[\"default\"].func.isRequired,\n  onClose: _propTypes[\"default\"].func.isRequired,\n  onValidate: _propTypes[\"default\"].func.isRequired,\n  trackedLocation: _propTypes[\"default\"].string\n};","map":null,"metadata":{},"sourceType":"script"}