{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _upperFirst = _interopRequireDefault(require(\"lodash/upperFirst\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _BaseCheckbox = require(\"@strapi/design-system/BaseCheckbox\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Flex = require(\"@strapi/design-system/Flex\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _hooks = require(\"../../../../../../../../../hooks\");\n\nvar _CollapseLabel = _interopRequireDefault(require(\"../../../CollapseLabel\"));\n\nvar _Curve = _interopRequireDefault(require(\"../../../Curve\"));\n\nvar _HiddenAction = _interopRequireDefault(require(\"../../../HiddenAction\"));\n\nvar _constants = require(\"../../../Permissions/utils/constants\");\n\nvar _RequiredSign = _interopRequireDefault(require(\"../../../RequiredSign\"));\n\nvar _utils = require(\"../../../utils\");\n\nvar _utils2 = require(\"../../utils\");\n\nvar _CarretIcon = _interopRequireDefault(require(\"../CarretIcon\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar IS_DISABLED = function () {\n  if (window && window.strapi && window.strapi.isEE) {\n    return require('../../../../../../../../../../../ee/admin/pages/SettingsPage/pages/Roles/EditPage/components/ContentTypeCollapse/CollapsePropertyMatrix/SubActionRow/utils/constants')[\"default\"];\n  }\n\n  return require('./utils/constants')[\"default\"];\n}();\n\nvar Cell = /*#__PURE__*/(0, _styledComponents[\"default\"])(_Flex.Flex).withConfig({\n  displayName: \"SubActionRow__Cell\",\n  componentId: \"sc-7y8yzq-0\"\n})([\"width:\", \";position:relative;\"], _constants.cellWidth);\nvar RowWrapper = /*#__PURE__*/(0, _styledComponents[\"default\"])(_Flex.Flex).withConfig({\n  displayName: \"SubActionRow__RowWrapper\",\n  componentId: \"sc-7y8yzq-1\"\n})([\"height:\", \";\"], _constants.rowHeight);\nvar Wrapper = /*#__PURE__*/(0, _styledComponents[\"default\"])(_Box.Box).withConfig({\n  displayName: \"SubActionRow__Wrapper\",\n  componentId: \"sc-7y8yzq-2\"\n})([\"padding-left:\", \"rem;\"], 31 / 16);\nvar LeftBorderTimeline = /*#__PURE__*/(0, _styledComponents[\"default\"])(_Box.Box).withConfig({\n  displayName: \"SubActionRow__LeftBorderTimeline\",\n  componentId: \"sc-7y8yzq-3\"\n})([\"border-left:\", \";\"], function (_ref) {\n  var isVisible = _ref.isVisible,\n      theme = _ref.theme;\n  return isVisible ? \"4px solid \".concat(theme.colors.primary200) : '4px solid transparent';\n});\nvar RowStyle = /*#__PURE__*/(0, _styledComponents[\"default\"])(_Flex.Flex).withConfig({\n  displayName: \"SubActionRow__RowStyle\",\n  componentId: \"sc-7y8yzq-4\"\n})([\"padding-left:\", \";width:\", \"px;\", \" \", \";\"], function (_ref2) {\n  var theme = _ref2.theme;\n  return theme.spaces[4];\n}, function (_ref3) {\n  var level = _ref3.level;\n  return 145 - level * 36;\n}, function (_ref4) {\n  var isCollapsable = _ref4.isCollapsable,\n      theme = _ref4.theme;\n  return isCollapsable && \"\\n      \".concat(_CarretIcon[\"default\"], \" {\\n        display: block;\\n        color: \").concat(theme.colors.neutral100, \";\\n      }\\n      &:hover {\\n        \").concat((0, _utils2.activeStyle)(theme), \"\\n      }\\n  \");\n}, function (_ref5) {\n  var isActive = _ref5.isActive,\n      theme = _ref5.theme;\n  return isActive && (0, _utils2.activeStyle)(theme);\n});\n\nvar TopTimeline = /*#__PURE__*/_styledComponents[\"default\"].div.withConfig({\n  displayName: \"SubActionRow__TopTimeline\",\n  componentId: \"sc-7y8yzq-5\"\n})([\"padding-top:\", \";margin-top:\", \";width:\", \"rem;background-color:\", \";border-top-left-radius:2px;border-top-right-radius:2px;\"], function (_ref6) {\n  var theme = _ref6.theme;\n  return theme.spaces[2];\n}, function (_ref7) {\n  var theme = _ref7.theme;\n  return theme.spaces[2];\n}, 4 / 16, function (_ref8) {\n  var theme = _ref8.theme;\n  return theme.colors.primary200;\n});\n\nvar SubActionRow = function SubActionRow(_ref9) {\n  var childrenForm = _ref9.childrenForm,\n      isFormDisabled = _ref9.isFormDisabled,\n      recursiveLevel = _ref9.recursiveLevel,\n      pathToDataFromActionRow = _ref9.pathToDataFromActionRow,\n      propertyActions = _ref9.propertyActions,\n      parentName = _ref9.parentName,\n      propertyName = _ref9.propertyName;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _usePermissionsDataMa = (0, _hooks.usePermissionsDataManager)(),\n      modifiedData = _usePermissionsDataMa.modifiedData,\n      onChangeParentCheckbox = _usePermissionsDataMa.onChangeParentCheckbox,\n      onChangeSimpleCheckbox = _usePermissionsDataMa.onChangeSimpleCheckbox;\n\n  var _useState = (0, _react.useState)(null),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      rowToOpen = _useState2[0],\n      setRowToOpen = _useState2[1];\n\n  var handleClickToggleSubLevel = function handleClickToggleSubLevel(name) {\n    setRowToOpen(function (prev) {\n      if (prev === name) {\n        return null;\n      }\n\n      return name;\n    });\n  };\n\n  var displayedRecursiveChildren = (0, _react.useMemo)(function () {\n    if (!rowToOpen) {\n      return null;\n    }\n\n    return childrenForm.find(function (_ref10) {\n      var value = _ref10.value;\n      return value === rowToOpen;\n    });\n  }, [rowToOpen, childrenForm]);\n  return /*#__PURE__*/_react[\"default\"].createElement(Wrapper, null, /*#__PURE__*/_react[\"default\"].createElement(TopTimeline, null), childrenForm.map(function (_ref11, index) {\n    var label = _ref11.label,\n        value = _ref11.value,\n        required = _ref11.required,\n        subChildrenForm = _ref11.children;\n    var isVisible = index + 1 < childrenForm.length;\n    var isArrayType = Array.isArray(subChildrenForm);\n    var isActive = rowToOpen === value;\n    return /*#__PURE__*/_react[\"default\"].createElement(LeftBorderTimeline, {\n      key: value,\n      isVisible: isVisible\n    }, /*#__PURE__*/_react[\"default\"].createElement(RowWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(_Curve[\"default\"], {\n      color: \"primary200\"\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, {\n      style: {\n        flex: 1\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(RowStyle, {\n      level: recursiveLevel,\n      isActive: isActive,\n      isCollapsable: isArrayType\n    }, /*#__PURE__*/_react[\"default\"].createElement(_CollapseLabel[\"default\"], (0, _extends2[\"default\"])({\n      alignItems: \"center\",\n      isCollapsable: isArrayType\n    }, isArrayType && {\n      onClick: function onClick() {\n        return handleClickToggleSubLevel(value);\n      },\n      'aria-expanded': isActive,\n      onKeyDown: function onKeyDown(_ref12) {\n        var key = _ref12.key;\n        return (key === 'Enter' || key === ' ') && handleClickToggleSubLevel(value);\n      },\n      tabIndex: 0,\n      role: 'button'\n    }, {\n      title: label\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      ellipsis: true\n    }, (0, _upperFirst[\"default\"])(label)), required && /*#__PURE__*/_react[\"default\"].createElement(_RequiredSign[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(_CarretIcon[\"default\"], {\n      $isActive: isActive\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, {\n      style: {\n        flex: 1\n      }\n    }, propertyActions.map(function (_ref13) {\n      var actionId = _ref13.actionId,\n          propertyLabel = _ref13.label,\n          isActionRelatedToCurrentProperty = _ref13.isActionRelatedToCurrentProperty;\n\n      if (!isActionRelatedToCurrentProperty) {\n        return /*#__PURE__*/_react[\"default\"].createElement(_HiddenAction[\"default\"], {\n          key: actionId\n        });\n      }\n      /*\n       * Usually we use a 'dot' in order to know the key path of an object for which we want to change the value.\n       * Since an action and a subject are both separated by '.' or '::' we chose to use the '..' separators\n       */\n\n\n      var checkboxName = [].concat((0, _toConsumableArray2[\"default\"])(pathToDataFromActionRow.split('..')), [actionId, 'properties', propertyName], (0, _toConsumableArray2[\"default\"])(parentName.split('..')), [value]);\n      var checkboxValue = (0, _get[\"default\"])(modifiedData, checkboxName, false);\n\n      if (!subChildrenForm) {\n        return /*#__PURE__*/_react[\"default\"].createElement(Cell, {\n          key: propertyLabel,\n          justifyContent: \"center\",\n          alignItems: \"center\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(_BaseCheckbox.BaseCheckbox, {\n          disabled: isFormDisabled || IS_DISABLED,\n          name: checkboxName.join('..'),\n          \"aria-label\": formatMessage({\n            id: \"Settings.permissions.select-by-permission\",\n            defaultMessage: 'Select {label} permission'\n          }, {\n            label: \"\".concat(parentName, \" \").concat(label, \" \").concat(propertyLabel)\n          }) // Keep same signature as packages/core/admin/admin/src/components/Roles/Permissions/index.js l.91\n          ,\n          onValueChange: function onValueChange(value) {\n            onChangeSimpleCheckbox({\n              target: {\n                name: checkboxName.join('..'),\n                value: value\n              }\n            });\n          },\n          value: checkboxValue\n        }));\n      }\n\n      var _getCheckboxState = (0, _utils.getCheckboxState)(checkboxValue),\n          hasAllActionsSelected = _getCheckboxState.hasAllActionsSelected,\n          hasSomeActionsSelected = _getCheckboxState.hasSomeActionsSelected;\n\n      return /*#__PURE__*/_react[\"default\"].createElement(Cell, {\n        key: propertyLabel,\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      }, /*#__PURE__*/_react[\"default\"].createElement(_BaseCheckbox.BaseCheckbox, {\n        key: propertyLabel,\n        disabled: isFormDisabled || IS_DISABLED,\n        name: checkboxName.join('..'),\n        \"aria-label\": formatMessage({\n          id: \"Settings.permissions.select-by-permission\",\n          defaultMessage: 'Select {label} permission'\n        }, {\n          label: \"\".concat(parentName, \" \").concat(label, \" \").concat(propertyLabel)\n        }) // Keep same signature as packages/core/admin/admin/src/components/Roles/Permissions/index.js l.91\n        ,\n        onValueChange: function onValueChange(value) {\n          onChangeParentCheckbox({\n            target: {\n              name: checkboxName.join('..'),\n              value: value\n            }\n          });\n        },\n        value: hasAllActionsSelected,\n        indeterminate: hasSomeActionsSelected\n      }));\n    })))), displayedRecursiveChildren && isActive && /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingBottom: 2\n    }, /*#__PURE__*/_react[\"default\"].createElement(SubActionRow, {\n      isFormDisabled: isFormDisabled,\n      parentName: \"\".concat(parentName, \"..\").concat(value),\n      pathToDataFromActionRow: pathToDataFromActionRow,\n      propertyActions: propertyActions,\n      propertyName: propertyName,\n      recursiveLevel: recursiveLevel + 1,\n      childrenForm: displayedRecursiveChildren.children\n    })));\n  }));\n};\n\nSubActionRow.propTypes = {\n  childrenForm: _propTypes[\"default\"].array.isRequired,\n  isFormDisabled: _propTypes[\"default\"].bool.isRequired,\n  parentName: _propTypes[\"default\"].string.isRequired,\n  pathToDataFromActionRow: _propTypes[\"default\"].string.isRequired,\n  propertyActions: _propTypes[\"default\"].array.isRequired,\n  propertyName: _propTypes[\"default\"].string.isRequired,\n  recursiveLevel: _propTypes[\"default\"].number.isRequired\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(SubActionRow);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}