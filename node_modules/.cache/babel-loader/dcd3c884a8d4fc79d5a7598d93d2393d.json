{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EditAssetDialog = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _isEqual = _interopRequireDefault(require(\"lodash/isEqual\"));\n\nvar _ModalLayout = require(\"@strapi/design-system/ModalLayout\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _TextInput = require(\"@strapi/design-system/TextInput\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _VisuallyHidden = require(\"@strapi/design-system/VisuallyHidden\");\n\nvar _formik = require(\"formik\");\n\nvar yup = _interopRequireWildcard(require(\"yup\"));\n\nvar _PreviewBox = require(\"./PreviewBox\");\n\nvar _AssetMeta = require(\"./AssetMeta\");\n\nvar _utils = require(\"../../utils\");\n\nvar _formatBytes = _interopRequireDefault(require(\"../../utils/formatBytes\"));\n\nvar _useEditAsset2 = require(\"../../hooks/useEditAsset\");\n\nvar _ReplaceMediaButton = require(\"./ReplaceMediaButton\");\n\nvar _constants = require(\"../../constants\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar fileInfoSchema = yup.object({\n  name: yup.string().required(),\n  alternativeText: yup.string(),\n  caption: yup.string()\n});\n\nvar EditAssetDialog = function EditAssetDialog(_ref) {\n  var onClose = _ref.onClose,\n      asset = _ref.asset,\n      canUpdate = _ref.canUpdate,\n      canCopyLink = _ref.canCopyLink,\n      canDownload = _ref.canDownload,\n      trackedLocation = _ref.trackedLocation;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage,\n      formatDate = _useIntl.formatDate;\n\n  var submitButtonRef = (0, _react.useRef)(null);\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isCropping = _useState2[0],\n      setIsCropping = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      replacementFile = _useState4[0],\n      setReplacementFile = _useState4[1];\n\n  var _useEditAsset = (0, _useEditAsset2.useEditAsset)(),\n      editAsset = _useEditAsset.editAsset,\n      isLoading = _useEditAsset.isLoading;\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(values) {\n      var nextAsset, editedAsset;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!asset.isLocal) {\n                _context.next = 5;\n                break;\n              }\n\n              nextAsset = _objectSpread(_objectSpread({}, asset), values);\n              onClose(nextAsset);\n              _context.next = 9;\n              break;\n\n            case 5:\n              _context.next = 7;\n              return editAsset(_objectSpread(_objectSpread({}, asset), values), replacementFile);\n\n            case 7:\n              editedAsset = _context.sent;\n              onClose(editedAsset);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleStartCropping = function handleStartCropping() {\n    setIsCropping(true);\n  };\n\n  var handleCancelCropping = function handleCancelCropping() {\n    setIsCropping(false);\n  };\n\n  var handleFinishCropping = function handleFinishCropping() {\n    setIsCropping(false);\n    onClose();\n  };\n\n  var formDisabled = !canUpdate || isCropping;\n\n  var handleConfirmClose = function handleConfirmClose() {\n    // eslint-disable-next-line no-alert\n    var confirm = window.confirm(formatMessage({\n      id: 'window.confirm.close-modal.file',\n      defaultMessage: 'Are you sure? Your changes will be lost.'\n    }));\n\n    if (confirm) {\n      onClose();\n    }\n  };\n\n  var initialFormData = {\n    name: asset.name,\n    alternativeText: asset.alternativeText || '',\n    caption: asset.caption || ''\n  };\n\n  var handleClose = function handleClose(values) {\n    if (!(0, _isEqual[\"default\"])(initialFormData, values)) {\n      handleConfirmClose();\n    } else {\n      onClose();\n    }\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_formik.Formik, {\n    validationSchema: fileInfoSchema,\n    validateOnChange: false,\n    onSubmit: handleSubmit,\n    initialValues: initialFormData\n  }, function (_ref3) {\n    var values = _ref3.values,\n        errors = _ref3.errors,\n        handleChange = _ref3.handleChange;\n    return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n      onClose: function onClose() {\n        return handleClose(values);\n      },\n      labelledBy: \"title\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalHeader, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      fontWeight: \"bold\",\n      textColor: \"neutral800\",\n      as: \"h2\",\n      id: \"title\"\n    }, formatMessage({\n      id: (0, _utils.getTrad)('modal.edit.title'),\n      defaultMessage: 'Details'\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalBody, null, /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      xs: 12,\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_PreviewBox.PreviewBox, {\n      asset: asset,\n      canUpdate: canUpdate,\n      canCopyLink: canCopyLink,\n      canDownload: canDownload,\n      onDelete: onClose,\n      onCropFinish: handleFinishCropping,\n      onCropStart: handleStartCropping,\n      onCropCancel: handleCancelCropping,\n      replacementFile: replacementFile,\n      trackedLocation: trackedLocation\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      xs: 12,\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.Form, {\n      noValidate: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 3\n    }, /*#__PURE__*/_react[\"default\"].createElement(_AssetMeta.AssetMeta, {\n      size: (0, _formatBytes[\"default\"])(asset.size),\n      dimension: asset.height && asset.width ? \"\".concat(asset.width, \"\\u2715\").concat(asset.height) : '',\n      date: formatDate(new Date(asset.createdAt)),\n      extension: (0, _helperPlugin.getFileExtension)(asset.ext)\n    }), /*#__PURE__*/_react[\"default\"].createElement(_TextInput.TextInput, {\n      size: \"S\",\n      label: formatMessage({\n        id: (0, _utils.getTrad)('form.input.label.file-name'),\n        defaultMessage: 'File name'\n      }),\n      name: \"name\",\n      value: values.name,\n      error: errors.name,\n      onChange: handleChange,\n      disabled: formDisabled\n    }), /*#__PURE__*/_react[\"default\"].createElement(_TextInput.TextInput, {\n      size: \"S\",\n      label: formatMessage({\n        id: (0, _utils.getTrad)('form.input.label.file-alt'),\n        defaultMessage: 'Alternative text'\n      }),\n      name: \"alternativeText\",\n      hint: formatMessage({\n        id: (0, _utils.getTrad)({\n          id: (0, _utils.getTrad)('form.input.decription.file-alt')\n        }),\n        defaultMessage: 'This text will be displayed if the asset canâ€™t be shown.'\n      }),\n      value: values.alternativeText,\n      error: errors.alternativeText,\n      onChange: handleChange,\n      disabled: formDisabled\n    }), /*#__PURE__*/_react[\"default\"].createElement(_TextInput.TextInput, {\n      size: \"S\",\n      label: formatMessage({\n        id: (0, _utils.getTrad)('form.input.label.file-caption'),\n        defaultMessage: 'Caption'\n      }),\n      name: \"caption\",\n      value: values.caption,\n      error: errors.caption,\n      onChange: handleChange,\n      disabled: formDisabled\n    })), /*#__PURE__*/_react[\"default\"].createElement(_VisuallyHidden.VisuallyHidden, null, /*#__PURE__*/_react[\"default\"].createElement(\"button\", {\n      type: \"submit\",\n      tabIndex: -1,\n      ref: submitButtonRef,\n      disabled: formDisabled\n    }, formatMessage({\n      id: 'submit',\n      defaultMessage: 'Submit'\n    }))))))), /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalFooter, {\n      startActions: /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        onClick: function onClick() {\n          return handleClose(values);\n        },\n        variant: \"tertiary\"\n      }, formatMessage({\n        id: 'cancel',\n        defaultMessage: 'Cancel'\n      })),\n      endActions: /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_ReplaceMediaButton.ReplaceMediaButton, {\n        onSelectMedia: setReplacementFile,\n        acceptedMime: asset.mime,\n        disabled: formDisabled,\n        trackedLocation: trackedLocation\n      }), /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        onClick: function onClick() {\n          return submitButtonRef.current.click();\n        },\n        loading: isLoading,\n        disabled: formDisabled\n      }, formatMessage({\n        id: 'form.button.finish',\n        defaultMessage: 'Finish'\n      })))\n    }));\n  });\n};\n\nexports.EditAssetDialog = EditAssetDialog;\nEditAssetDialog.defaultProps = {\n  trackedLocation: undefined\n};\nEditAssetDialog.propTypes = {\n  asset: _constants.AssetDefinition.isRequired,\n  canUpdate: _propTypes[\"default\"].bool.isRequired,\n  canCopyLink: _propTypes[\"default\"].bool.isRequired,\n  canDownload: _propTypes[\"default\"].bool.isRequired,\n  onClose: _propTypes[\"default\"].func.isRequired,\n  trackedLocation: _propTypes[\"default\"].string\n};","map":null,"metadata":{},"sourceType":"script"}