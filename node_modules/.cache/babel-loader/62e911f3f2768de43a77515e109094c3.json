{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _package = _interopRequireDefault(require(\"../../../../package.json\"));\n\nvar _hooks = require(\"../../hooks\");\n\nvar _PluginsInitializer = _interopRequireDefault(require(\"../PluginsInitializer\"));\n\nvar _RBACProvider = _interopRequireDefault(require(\"../RBACProvider\"));\n\nvar _api = require(\"./utils/api\");\n\nvar _checkLatestStrapiVersion = _interopRequireDefault(require(\"./utils/checkLatestStrapiVersion\"));\n\nvar _utils = require(\"../../utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar strapiVersion = _package[\"default\"].version;\n\nvar AuthenticatedApp = function AuthenticatedApp() {\n  var _useGuidedTour = (0, _helperPlugin.useGuidedTour)(),\n      setGuidedTourVisibility = _useGuidedTour.setGuidedTourVisibility;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n  var setGuidedTourVisibilityRef = (0, _react.useRef)(setGuidedTourVisibility);\n\n  var userInfo = _helperPlugin.auth.getUserInfo();\n\n  var userName = (0, _get[\"default\"])(userInfo, 'username') || (0, _utils.getFullName)(userInfo.firstname, userInfo.lastname);\n\n  var _useState = (0, _react.useState)(userName),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      userDisplayName = _useState2[0],\n      setUserDisplayName = _useState2[1];\n\n  var _useConfigurations = (0, _hooks.useConfigurations)(),\n      showReleaseNotification = _useConfigurations.showReleaseNotification;\n\n  var _useQueries = (0, _reactQuery.useQueries)([{\n    queryKey: 'app-infos',\n    queryFn: _api.fetchAppInfo\n  }, {\n    queryKey: 'strapi-release',\n    queryFn: function queryFn() {\n      return (0, _api.fetchStrapiLatestRelease)(toggleNotification);\n    },\n    enabled: showReleaseNotification,\n    initialData: strapiVersion\n  }, {\n    queryKey: 'admin-users-permission',\n    queryFn: _api.fetchCurrentUserPermissions,\n    initialData: []\n  }, {\n    queryKey: 'user-roles',\n    queryFn: _api.fetchUserRoles\n  }]),\n      _useQueries2 = (0, _slicedToArray2[\"default\"])(_useQueries, 4),\n      _useQueries2$ = _useQueries2[0],\n      appInfos = _useQueries2$.data,\n      status = _useQueries2$.status,\n      _useQueries2$2 = _useQueries2[1],\n      tag_name = _useQueries2$2.data,\n      isLoading = _useQueries2$2.isLoading,\n      _useQueries2$3 = _useQueries2[2],\n      permissions = _useQueries2$3.data,\n      fetchPermissionsStatus = _useQueries2$3.status,\n      refetch = _useQueries2$3.refetch,\n      isFetched = _useQueries2$3.isFetched,\n      isFetching = _useQueries2$3.isFetching,\n      userRoles = _useQueries2[3].data;\n\n  var shouldUpdateStrapi = (0, _react.useMemo)(function () {\n    return (0, _checkLatestStrapiVersion[\"default\"])(strapiVersion, tag_name);\n  }, [tag_name]);\n  (0, _react.useEffect)(function () {\n    if (userRoles) {\n      var isUserSuperAdmin = userRoles.find(function (_ref) {\n        var code = _ref.code;\n        return code === 'strapi-super-admin';\n      });\n\n      if (isUserSuperAdmin) {\n        setGuidedTourVisibilityRef.current(true);\n      }\n    }\n  }, [userRoles]); // We don't need to wait for the release query to be fetched before rendering the plugins\n  // however, we need the appInfos and the permissions\n\n  var shouldShowNotDependentQueriesLoader = isFetching && isFetched || status === 'loading' || fetchPermissionsStatus === 'loading';\n  var shouldShowLoader = isLoading || shouldShowNotDependentQueriesLoader;\n\n  if (shouldShowLoader) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null);\n  } // TODO add error state\n\n\n  if (status === 'error') {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, \"error...\");\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.AppInfosContext.Provider, {\n    value: _objectSpread(_objectSpread({}, appInfos), {}, {\n      latestStrapiReleaseTag: tag_name,\n      setUserDisplayName: setUserDisplayName,\n      shouldUpdateStrapi: shouldUpdateStrapi,\n      userDisplayName: userDisplayName\n    })\n  }, /*#__PURE__*/_react[\"default\"].createElement(_RBACProvider[\"default\"], {\n    permissions: permissions,\n    refetchPermissions: refetch\n  }, /*#__PURE__*/_react[\"default\"].createElement(_PluginsInitializer[\"default\"], null)));\n};\n\nvar _default = AuthenticatedApp;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}