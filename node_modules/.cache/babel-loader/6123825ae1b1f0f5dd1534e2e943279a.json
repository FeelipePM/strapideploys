{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _redux = require(\"redux\");\n\nvar _DataManagerContext = _interopRequireDefault(require(\"../../contexts/DataManagerContext\"));\n\nvar _useFormModalNavigation = _interopRequireDefault(require(\"../../hooks/useFormModalNavigation\"));\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nvar _makeUnique = _interopRequireDefault(require(\"../../utils/makeUnique\"));\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _FormModal = _interopRequireDefault(require(\"../FormModal\"));\n\nvar _createDataObject = _interopRequireDefault(require(\"./utils/createDataObject\"));\n\nvar _createModifiedDataSchema = _interopRequireDefault(require(\"./utils/createModifiedDataSchema\"));\n\nvar _retrieveSpecificInfoFromComponents = _interopRequireDefault(require(\"./utils/retrieveSpecificInfoFromComponents\"));\n\nvar _retrieveComponentsFromSchema = _interopRequireDefault(require(\"./utils/retrieveComponentsFromSchema\"));\n\nvar _retrieveNestedComponents = _interopRequireDefault(require(\"./utils/retrieveNestedComponents\"));\n\nvar _retrieveComponentsThatHaveComponents = require(\"./utils/retrieveComponentsThatHaveComponents\");\n\nvar _cleanData = require(\"./utils/cleanData\");\n\nvar _validateSchema = _interopRequireDefault(require(\"./utils/validateSchema\"));\n\nvar _constants = require(\"./constants\");\n\nvar _selectors = _interopRequireDefault(require(\"./selectors\"));\n\nvar _formatSchemas = _interopRequireDefault(require(\"./utils/formatSchemas\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar DataManagerProvider = function DataManagerProvider(_ref) {\n  var allIcons = _ref.allIcons,\n      children = _ref.children,\n      components = _ref.components,\n      contentTypes = _ref.contentTypes,\n      isLoading = _ref.isLoading,\n      isLoadingForDataToBeSet = _ref.isLoadingForDataToBeSet,\n      initialData = _ref.initialData,\n      modifiedData = _ref.modifiedData,\n      reservedNames = _ref.reservedNames;\n  var dispatch = (0, _reactRedux.useDispatch)();\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useAutoReloadOverlay = (0, _helperPlugin.useAutoReloadOverlayBlocker)(),\n      lockAppWithAutoreload = _useAutoReloadOverlay.lockAppWithAutoreload,\n      unlockAppWithAutoreload = _useAutoReloadOverlay.unlockAppWithAutoreload;\n\n  var _useGuidedTour = (0, _helperPlugin.useGuidedTour)(),\n      setCurrentStep = _useGuidedTour.setCurrentStep;\n\n  var _useStrapiApp = (0, _helperPlugin.useStrapiApp)(),\n      getPlugin = _useStrapiApp.getPlugin;\n\n  var _getPlugin = getPlugin(_pluginId[\"default\"]),\n      apis = _getPlugin.apis;\n\n  var _useAppInfos = (0, _helperPlugin.useAppInfos)(),\n      autoReload = _useAppInfos.autoReload;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useRBACProvider = (0, _helperPlugin.useRBACProvider)(),\n      refetchPermissions = _useRBACProvider.refetchPermissions;\n\n  var _useLocation = (0, _reactRouterDom.useLocation)(),\n      pathname = _useLocation.pathname;\n\n  var _useFormModalNavigati = (0, _useFormModalNavigation[\"default\"])(),\n      onCloseModal = _useFormModalNavigati.onCloseModal;\n\n  var contentTypeMatch = (0, _reactRouterDom.useRouteMatch)(\"/plugins/\".concat(_pluginId[\"default\"], \"/content-types/:uid\"));\n  var componentMatch = (0, _reactRouterDom.useRouteMatch)(\"/plugins/\".concat(_pluginId[\"default\"], \"/component-categories/:categoryUid/:componentUid\"));\n  var formatMessageRef = (0, _react.useRef)();\n  formatMessageRef.current = formatMessage;\n  var isInDevelopmentMode = autoReload;\n  var isInContentTypeView = contentTypeMatch !== null;\n  var firstKeyToMainSchema = isInContentTypeView ? 'contentType' : 'component';\n  var currentUid = isInContentTypeView ? (0, _lodash.get)(contentTypeMatch, 'params.uid', null) : (0, _lodash.get)(componentMatch, 'params.componentUid', null);\n  var abortController = new AbortController();\n  var signal = abortController.signal;\n  var getDataRef = (0, _react.useRef)();\n  var endPoint = isInContentTypeView ? 'content-types' : 'components';\n  getDataRef.current = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n    var _yield$Promise$all, _yield$Promise$all2, componentsArray, contentTypesArray, _reservedNames, _components, formattedComponents, _contentTypes, formattedContentTypes;\n\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return Promise.all(['components', 'content-types', 'reserved-names'].map(function (endPoint) {\n              return (0, _helperPlugin.request)(\"/\".concat(_pluginId[\"default\"], \"/\").concat(endPoint), {\n                method: 'GET',\n                signal: signal\n              });\n            }));\n\n          case 3:\n            _yield$Promise$all = _context.sent;\n            _yield$Promise$all2 = (0, _slicedToArray2[\"default\"])(_yield$Promise$all, 3);\n            componentsArray = _yield$Promise$all2[0].data;\n            contentTypesArray = _yield$Promise$all2[1].data;\n            _reservedNames = _yield$Promise$all2[2];\n            _components = (0, _createDataObject[\"default\"])(componentsArray);\n            formattedComponents = (0, _formatSchemas[\"default\"])(_components);\n            _contentTypes = (0, _createDataObject[\"default\"])(contentTypesArray);\n            formattedContentTypes = (0, _formatSchemas[\"default\"])(_contentTypes);\n            dispatch({\n              type: _constants.GET_DATA_SUCCEEDED,\n              components: formattedComponents,\n              contentTypes: formattedContentTypes,\n              reservedNames: _reservedNames\n            });\n            _context.next = 19;\n            break;\n\n          case 15:\n            _context.prev = 15;\n            _context.t0 = _context[\"catch\"](0);\n            console.error({\n              err: _context.t0\n            });\n            toggleNotification({\n              type: 'warning',\n              message: {\n                id: 'notification.error'\n              }\n            });\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 15]]);\n  }));\n  (0, _react.useEffect)(function () {\n    getDataRef.current();\n  }, []);\n  (0, _react.useEffect)(function () {\n    // We need to set the modifiedData after the data has been retrieved\n    // and also on pathname change\n    if (!isLoading && currentUid) {\n      setModifiedData();\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [isLoading, pathname, currentUid]);\n  (0, _react.useEffect)(function () {\n    if (!autoReload) {\n      toggleNotification({\n        type: 'info',\n        message: {\n          id: (0, _getTrad[\"default\"])('notification.info.autoreaload-disable')\n        }\n      });\n    }\n  }, [autoReload, toggleNotification]);\n\n  var addAttribute = function addAttribute(attributeToSet, forTarget, targetUid) {\n    var isEditing = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    var initialAttribute = arguments.length > 4 ? arguments[4] : undefined;\n    var shouldAddComponentToData = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n    var actionType = isEditing ? _constants.EDIT_ATTRIBUTE : _constants.ADD_ATTRIBUTE;\n    dispatch({\n      type: actionType,\n      attributeToSet: attributeToSet,\n      forTarget: forTarget,\n      targetUid: targetUid,\n      initialAttribute: initialAttribute,\n      shouldAddComponentToData: shouldAddComponentToData\n    });\n  };\n\n  var addCreatedComponentToDynamicZone = function addCreatedComponentToDynamicZone(dynamicZoneTarget, componentsToAdd) {\n    dispatch({\n      type: _constants.ADD_CREATED_COMPONENT_TO_DYNAMIC_ZONE,\n      dynamicZoneTarget: dynamicZoneTarget,\n      componentsToAdd: componentsToAdd\n    });\n  };\n\n  var createSchema = function createSchema(data, schemaType, uid, componentCategory) {\n    var shouldAddComponentToData = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n    var type = schemaType === 'contentType' ? _constants.CREATE_SCHEMA : _constants.CREATE_COMPONENT_SCHEMA;\n    dispatch({\n      type: type,\n      data: data,\n      componentCategory: componentCategory,\n      schemaType: schemaType,\n      uid: uid,\n      shouldAddComponentToData: shouldAddComponentToData\n    });\n  };\n\n  var changeDynamicZoneComponents = function changeDynamicZoneComponents(dynamicZoneTarget, newComponents) {\n    dispatch({\n      type: _constants.CHANGE_DYNAMIC_ZONE_COMPONENTS,\n      dynamicZoneTarget: dynamicZoneTarget,\n      newComponents: newComponents\n    });\n  };\n\n  var removeAttribute = function removeAttribute(mainDataKey, attributeToRemoveName) {\n    var componentUid = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n    var type = mainDataKey === 'components' ? _constants.REMOVE_FIELD_FROM_DISPLAYED_COMPONENT : _constants.REMOVE_FIELD;\n\n    if (mainDataKey === 'contentType') {\n      trackUsage('willDeleteFieldOfContentType');\n    }\n\n    dispatch({\n      type: type,\n      mainDataKey: mainDataKey,\n      attributeToRemoveName: attributeToRemoveName,\n      componentUid: componentUid\n    });\n  };\n\n  var deleteCategory = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(categoryUid) {\n      var requestURL, userConfirm;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              requestURL = \"/\".concat(_pluginId[\"default\"], \"/component-categories/\").concat(categoryUid); // eslint-disable-next-line no-alert\n\n              userConfirm = window.confirm(formatMessage({\n                id: (0, _getTrad[\"default\"])('popUpWarning.bodyMessage.category.delete')\n              })); // Close the modal\n\n              onCloseModal();\n\n              if (!userConfirm) {\n                _context2.next = 12;\n                break;\n              }\n\n              lockAppWithAutoreload();\n              _context2.next = 8;\n              return (0, _helperPlugin.request)(requestURL, {\n                method: 'DELETE'\n              }, true);\n\n            case 8:\n              _context2.next = 10;\n              return updatePermissions();\n\n            case 10:\n              // Reload the plugin so the cycle is new again\n              dispatch({\n                type: _constants.RELOAD_PLUGIN\n              }); // Refetch all the data\n\n              getDataRef.current();\n\n            case 12:\n              _context2.next = 18;\n              break;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error({\n                err: _context2.t0\n              });\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 18:\n              _context2.prev = 18;\n              unlockAppWithAutoreload();\n              return _context2.finish(18);\n\n            case 21:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 14, 18, 21]]);\n    }));\n\n    return function deleteCategory(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var deleteData = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n      var requestURL, isTemporary, userConfirm;\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              requestURL = \"/\".concat(_pluginId[\"default\"], \"/\").concat(endPoint, \"/\").concat(currentUid);\n              isTemporary = (0, _lodash.get)(modifiedData, [firstKeyToMainSchema, 'isTemporary'], false); // eslint-disable-next-line no-alert\n\n              userConfirm = window.confirm(formatMessage({\n                id: (0, _getTrad[\"default\"])(\"popUpWarning.bodyMessage.\".concat(isInContentTypeView ? 'contentType' : 'component', \".delete\"))\n              })); // Close the modal\n\n              onCloseModal();\n\n              if (!userConfirm) {\n                _context3.next = 16;\n                break;\n              }\n\n              if (!isTemporary) {\n                _context3.next = 9;\n                break;\n              }\n\n              // Delete the not saved type\n              // Here we just need to reset the components to the initial ones and also the content types\n              // Doing so will trigging a url change since the type doesn't exist in either the contentTypes or the components\n              // so the modified and the initial data will also be reset in the useEffect...\n              dispatch({\n                type: _constants.DELETE_NOT_SAVED_TYPE\n              });\n              return _context3.abrupt(\"return\");\n\n            case 9:\n              lockAppWithAutoreload();\n              _context3.next = 12;\n              return (0, _helperPlugin.request)(requestURL, {\n                method: 'DELETE'\n              }, true);\n\n            case 12:\n              // Reload the plugin so the cycle is new again\n              dispatch({\n                type: _constants.RELOAD_PLUGIN\n              }); // Refetch the permissions\n\n              _context3.next = 15;\n              return updatePermissions();\n\n            case 15:\n              // Refetch all the data\n              getDataRef.current();\n\n            case 16:\n              _context3.next = 22;\n              break;\n\n            case 18:\n              _context3.prev = 18;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error({\n                err: _context3.t0\n              });\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 22:\n              _context3.prev = 22;\n              unlockAppWithAutoreload();\n              return _context3.finish(22);\n\n            case 25:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 18, 22, 25]]);\n    }));\n\n    return function deleteData() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var editCategory = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(categoryUid, body) {\n      var requestURL;\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              requestURL = \"/\".concat(_pluginId[\"default\"], \"/component-categories/\").concat(categoryUid); // Close the modal\n\n              onCloseModal(); // Lock the app\n\n              lockAppWithAutoreload(); // Update the category\n\n              _context4.next = 6;\n              return (0, _helperPlugin.request)(requestURL, {\n                method: 'PUT',\n                body: body\n              }, true);\n\n            case 6:\n              _context4.next = 8;\n              return updatePermissions();\n\n            case 8:\n              // Reload the plugin so the cycle is new again\n              dispatch({\n                type: _constants.RELOAD_PLUGIN\n              }); // Refetch all the data\n\n              getDataRef.current();\n              _context4.next = 16;\n              break;\n\n            case 12:\n              _context4.prev = 12;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error({\n                err: _context4.t0\n              });\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 16:\n              _context4.prev = 16;\n              unlockAppWithAutoreload();\n              return _context4.finish(16);\n\n            case 19:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 12, 16, 19]]);\n    }));\n\n    return function editCategory(_x2, _x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var getAllComponentsThatHaveAComponentInTheirAttributes = function getAllComponentsThatHaveAComponentInTheirAttributes() {\n    // We need to create an object with all the non modified compos\n    // plus the ones that are created on the fly\n    var allCompos = Object.assign({}, components, modifiedData.components); // Since we apply the modification of a specific component only in the modified data\n    // we need to update all compos with the modifications\n\n    if (!isInContentTypeView) {\n      var currentEditedCompo = (0, _lodash.get)(modifiedData, 'component', {});\n      (0, _lodash.set)(allCompos, (0, _lodash.get)(currentEditedCompo, ['uid'], ''), currentEditedCompo);\n    }\n\n    var composWithCompos = (0, _retrieveComponentsThatHaveComponents.retrieveComponentsThatHaveComponents)(allCompos);\n    return (0, _makeUnique[\"default\"])(composWithCompos);\n  };\n\n  var getAllNestedComponents = function getAllNestedComponents() {\n    var appNestedCompo = (0, _retrieveNestedComponents[\"default\"])(components);\n    var editingDataNestedCompos = (0, _retrieveNestedComponents[\"default\"])(modifiedData.components || {});\n    return (0, _makeUnique[\"default\"])([].concat((0, _toConsumableArray2[\"default\"])(editingDataNestedCompos), (0, _toConsumableArray2[\"default\"])(appNestedCompo)));\n  };\n\n  var removeComponentFromDynamicZone = function removeComponentFromDynamicZone(dzName, componentToRemoveIndex) {\n    dispatch({\n      type: _constants.REMOVE_COMPONENT_FROM_DYNAMIC_ZONE,\n      dzName: dzName,\n      componentToRemoveIndex: componentToRemoveIndex\n    });\n  };\n\n  var setModifiedData = function setModifiedData() {\n    var currentSchemas = isInContentTypeView ? contentTypes : components;\n    var schemaToSet = (0, _lodash.get)(currentSchemas, currentUid, {\n      schema: {\n        attributes: []\n      }\n    });\n    var retrievedComponents = (0, _retrieveComponentsFromSchema[\"default\"])(schemaToSet.schema.attributes, components);\n    var newSchemaToSet = (0, _createModifiedDataSchema[\"default\"])(schemaToSet, retrievedComponents, components, isInContentTypeView);\n    var hasJustCreatedSchema = (0, _lodash.get)(schemaToSet, 'isTemporary', false) && (0, _lodash.size)((0, _lodash.get)(schemaToSet, 'schema.attributes', [])) === 0;\n    dispatch({\n      type: _constants.SET_MODIFIED_DATA,\n      schemaToSet: newSchemaToSet,\n      hasJustCreatedSchema: hasJustCreatedSchema\n    });\n  };\n\n  var shouldRedirect = (0, _react.useMemo)(function () {\n    var dataSet = isInContentTypeView ? contentTypes : components;\n\n    if (currentUid === 'create-content-type') {\n      return false;\n    }\n\n    return !Object.keys(dataSet).includes(currentUid) && !isLoading;\n  }, [components, contentTypes, currentUid, isInContentTypeView, isLoading]);\n  var redirectEndpoint = (0, _react.useMemo)(function () {\n    var allowedEndpoints = Object.keys(contentTypes).filter(function (uid) {\n      return (0, _lodash.get)(contentTypes, [uid, 'schema', 'visible'], true);\n    }).sort();\n    return (0, _lodash.get)(allowedEndpoints, '0', 'create-content-type');\n  }, [contentTypes]);\n\n  if (shouldRedirect) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Redirect, {\n      to: \"/plugins/\".concat(_pluginId[\"default\"], \"/content-types/\").concat(redirectEndpoint)\n    });\n  }\n\n  var submitData = /*#__PURE__*/function () {\n    var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(additionalContentTypeData) {\n      var _initialData$contentT, _initialData$contentT2, isCreating, body, contentType, isValidSchema, method, baseURL, requestURL, oldName, newName;\n\n      return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              isCreating = (0, _lodash.get)(modifiedData, [firstKeyToMainSchema, 'isTemporary'], false);\n              body = {\n                components: (0, _cleanData.getComponentsToPost)(modifiedData.components, components, currentUid, isCreating)\n              };\n\n              if (!isInContentTypeView) {\n                _context5.next = 13;\n                break;\n              }\n\n              contentType = apis.forms.mutateContentTypeSchema(_objectSpread(_objectSpread({}, (0, _cleanData.formatMainDataType)(modifiedData.contentType)), additionalContentTypeData), initialData.contentType);\n              isValidSchema = (0, _validateSchema[\"default\"])(contentType);\n\n              if (isValidSchema) {\n                _context5.next = 9;\n                break;\n              }\n\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: (0, _getTrad[\"default\"])('notification.error.dynamiczone-min.validation'),\n                  defaultMessage: 'At least one component is required in a dynamic zone to be able to save a content type'\n                }\n              });\n              return _context5.abrupt(\"return\");\n\n            case 9:\n              body.contentType = contentType;\n              trackUsage('willSaveContentType');\n              _context5.next = 15;\n              break;\n\n            case 13:\n              body.component = (0, _cleanData.formatMainDataType)(modifiedData.component, true);\n              trackUsage('willSaveComponent');\n\n            case 15:\n              method = isCreating ? 'POST' : 'PUT';\n              baseURL = \"/\".concat(_pluginId[\"default\"], \"/\").concat(endPoint);\n              requestURL = isCreating ? baseURL : \"\".concat(baseURL, \"/\").concat(currentUid); // Lock the app\n\n              lockAppWithAutoreload();\n              _context5.next = 21;\n              return (0, _helperPlugin.request)(requestURL, {\n                method: method,\n                body: body\n              }, true);\n\n            case 21:\n              unlockAppWithAutoreload();\n\n              if (isCreating && (((_initialData$contentT = initialData.contentType) === null || _initialData$contentT === void 0 ? void 0 : _initialData$contentT.schema.kind) === 'collectionType' || ((_initialData$contentT2 = initialData.contentType) === null || _initialData$contentT2 === void 0 ? void 0 : _initialData$contentT2.schema.kind) === 'singleType')) {\n                setCurrentStep('contentTypeBuilder.success');\n              }\n\n              _context5.next = 25;\n              return updatePermissions();\n\n            case 25:\n              // Submit ct tracking success\n              if (isInContentTypeView) {\n                trackUsage('didSaveContentType');\n                oldName = (0, _lodash.get)(body, ['contentType', 'schema', 'name'], '');\n                newName = (0, _lodash.get)(initialData, ['contentType', 'schema', 'name'], '');\n\n                if (!isCreating && oldName !== newName) {\n                  trackUsage('didEditNameOfContentType');\n                }\n              } else {\n                trackUsage('didSaveComponent');\n              } // Reload the plugin so the cycle is new again\n\n\n              dispatch({\n                type: _constants.RELOAD_PLUGIN\n              }); // Refetch all the data\n\n              getDataRef.current();\n              _context5.next = 35;\n              break;\n\n            case 30:\n              _context5.prev = 30;\n              _context5.t0 = _context5[\"catch\"](0);\n\n              if (!isInContentTypeView) {\n                trackUsage('didNotSaveComponent');\n              }\n\n              console.error({\n                err: _context5.t0.response\n              });\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 35:\n              _context5.prev = 35;\n              unlockAppWithAutoreload();\n              return _context5.finish(35);\n\n            case 38:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 30, 35, 38]]);\n    }));\n\n    return function submitData(_x4) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  var updatePermissions = /*#__PURE__*/function () {\n    var _ref7 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6() {\n      return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return refetchPermissions();\n\n            case 2:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function updatePermissions() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var updateSchema = function updateSchema(data, schemaType, componentUID) {\n    dispatch({\n      type: _constants.UPDATE_SCHEMA,\n      data: data,\n      schemaType: schemaType,\n      uid: componentUID\n    });\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_DataManagerContext[\"default\"].Provider, {\n    value: {\n      addAttribute: addAttribute,\n      addCreatedComponentToDynamicZone: addCreatedComponentToDynamicZone,\n      allComponentsCategories: (0, _retrieveSpecificInfoFromComponents[\"default\"])(components, ['category']),\n      allComponentsIconAlreadyTaken: (0, _retrieveSpecificInfoFromComponents[\"default\"])(components, ['schema', 'icon']),\n      allIcons: allIcons,\n      changeDynamicZoneComponents: changeDynamicZoneComponents,\n      components: components,\n      componentsGroupedByCategory: (0, _lodash.groupBy)(components, 'category'),\n      componentsThatHaveOtherComponentInTheirAttributes: getAllComponentsThatHaveAComponentInTheirAttributes(),\n      contentTypes: contentTypes,\n      createSchema: createSchema,\n      deleteCategory: deleteCategory,\n      deleteData: deleteData,\n      editCategory: editCategory,\n      isInDevelopmentMode: isInDevelopmentMode,\n      initialData: initialData,\n      isInContentTypeView: isInContentTypeView,\n      modifiedData: modifiedData,\n      nestedComponents: getAllNestedComponents(),\n      removeAttribute: removeAttribute,\n      removeComponentFromDynamicZone: removeComponentFromDynamicZone,\n      reservedNames: reservedNames,\n      setModifiedData: setModifiedData,\n      sortedContentTypesList: (0, _cleanData.sortContentType)(contentTypes),\n      submitData: submitData,\n      updateSchema: updateSchema\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, isLoadingForDataToBeSet ? /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null) : /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, children, isInDevelopmentMode && /*#__PURE__*/_react[\"default\"].createElement(_FormModal[\"default\"], null))));\n};\n\nDataManagerProvider.defaultProps = {\n  components: {}\n};\nDataManagerProvider.propTypes = {\n  allIcons: _propTypes[\"default\"].array.isRequired,\n  children: _propTypes[\"default\"].node.isRequired,\n  components: _propTypes[\"default\"].object,\n  contentTypes: _propTypes[\"default\"].object.isRequired,\n  isLoading: _propTypes[\"default\"].bool.isRequired,\n  isLoadingForDataToBeSet: _propTypes[\"default\"].bool.isRequired,\n  initialData: _propTypes[\"default\"].object.isRequired,\n  modifiedData: _propTypes[\"default\"].object.isRequired,\n  reservedNames: _propTypes[\"default\"].object.isRequired\n};\nvar mapStateToProps = (0, _selectors[\"default\"])();\nvar withConnect = (0, _reactRedux.connect)(mapStateToProps, null);\n\nvar _default = (0, _redux.compose)(withConnect)( /*#__PURE__*/(0, _react.memo)(DataManagerProvider));\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}