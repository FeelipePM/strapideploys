{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _codemirror = _interopRequireDefault(require(\"codemirror\"));\n\nvar _trimStart = _interopRequireDefault(require(\"lodash/trimStart\"));\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Field = require(\"@strapi/design-system/Field\");\n\nvar _jsonlint = _interopRequireDefault(require(\"./jsonlint\"));\n\nvar _components = require(\"./components\");\n\nvar _Label = _interopRequireDefault(require(\"./Label\"));\n\nvar _FieldWrapper = _interopRequireDefault(require(\"./FieldWrapper\"));\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2[\"default\"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2[\"default\"])(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nvar WAIT = 600;\nvar DEFAULT_THEME = 'blackboard';\n\nvar loadCss = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return import(\n            /* webpackChunkName: \"codemirror-javacript\" */\n            'codemirror/mode/javascript/javascript');\n\n          case 2:\n            _context.next = 4;\n            return import(\n            /* webpackChunkName: \"codemirror-addon-lint\" */\n            'codemirror/addon/lint/lint');\n\n          case 4:\n            _context.next = 6;\n            return import(\n            /* webpackChunkName: \"codemirror-addon-lint-js\" */\n            'codemirror/addon/lint/javascript-lint');\n\n          case 6:\n            _context.next = 8;\n            return import(\n            /* webpackChunkName: \"codemirror-addon-closebrackets\" */\n            'codemirror/addon/edit/closebrackets');\n\n          case 8:\n            _context.next = 10;\n            return import(\n            /* webpackChunkName: \"codemirror-addon-mark-selection\" */\n            'codemirror/addon/selection/mark-selection');\n\n          case 10:\n            _context.next = 12;\n            return import(\n            /* webpackChunkName: \"codemirror-css\" */\n            'codemirror/lib/codemirror.css');\n\n          case 12:\n            _context.next = 14;\n            return import(\n            /* webpackChunkName: \"codemirror-theme\" */\n            'codemirror/theme/blackboard.css');\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function loadCss() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nloadCss();\n\nvar InputJSON = /*#__PURE__*/function (_React$Component) {\n  (0, _inherits2[\"default\"])(InputJSON, _React$Component);\n\n  var _super = _createSuper(InputJSON);\n\n  function InputJSON(props) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, InputJSON);\n    _this = _super.call(this, props);\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"timer\", null);\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"setInitValue\", function () {\n      var value = _this.props.value;\n\n      try {\n        if (value === null) return _this.codeMirror.setValue('');\n        return _this.codeMirror.setValue(value);\n      } catch (err) {\n        return _this.setState({\n          error: true\n        });\n      }\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"setSize\", function () {\n      return _this.codeMirror.setSize('100%', 'auto');\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"getContentAtLine\", function (line) {\n      return _this.codeMirror.getLine(line);\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"getEditorOption\", function (opt) {\n      return _this.codeMirror.getOption(opt);\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"getValue\", function () {\n      return _this.codeMirror.getValue();\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"markSelection\", function (_ref2) {\n      var message = _ref2.message;\n      var line = parseInt(message.split(':')[0].split('line ')[1], 10) - 1;\n\n      var content = _this.getContentAtLine(line);\n\n      if (content === '{') {\n        line += 1;\n        content = _this.getContentAtLine(line);\n      }\n\n      var chEnd = content.length;\n      var chStart = chEnd - (0, _trimStart[\"default\"])(content, ' ').length;\n\n      var markedText = _this.codeMirror.markText({\n        line: line,\n        ch: chStart\n      }, {\n        line: line,\n        ch: chEnd\n      }, {\n        className: 'colored'\n      });\n\n      _this.setState({\n        markedText: markedText\n      });\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleChange\", function (doc, change) {\n      if (change.origin === 'setValue') {\n        return;\n      }\n\n      var _this$props = _this.props,\n          name = _this$props.name,\n          onChange = _this$props.onChange;\n      var value = doc.getValue();\n\n      if (value === '') {\n        value = null;\n      } // Update the parent\n\n\n      onChange({\n        target: {\n          name: name,\n          value: value,\n          type: 'json'\n        }\n      }); // Remove higlight error\n\n      if (_this.state.markedText) {\n        _this.state.markedText.clear();\n\n        _this.setState({\n          markedText: null,\n          error: null\n        });\n      }\n\n      clearTimeout(_this.timer);\n      _this.timer = setTimeout(function () {\n        return _this.testJSON(doc.getValue());\n      }, WAIT);\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"testJSON\", function (value) {\n      try {\n        _jsonlint[\"default\"].parse(value);\n      } catch (err) {\n        _this.markSelection(err);\n      }\n    });\n    _this.editor = /*#__PURE__*/_react[\"default\"].createRef();\n    _this.state = {\n      error: false,\n      markedText: null\n    };\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(InputJSON, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Init codemirror component\n      this.codeMirror = _codemirror[\"default\"].fromTextArea(this.editor.current, {\n        autoCloseBrackets: true,\n        lineNumbers: true,\n        matchBrackets: true,\n        mode: 'application/json',\n        readOnly: this.props.disabled,\n        smartIndent: true,\n        styleSelectedText: true,\n        tabSize: 2,\n        theme: DEFAULT_THEME,\n        fontSize: '13px'\n      });\n      this.codeMirror.on('change', this.handleChange);\n      this.setSize();\n      this.setInitValue();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.value !== this.props.value && !this.codeMirror.state.focused) {\n        this.setInitValue();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.error) {\n        return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, \"error json\");\n      }\n\n      return /*#__PURE__*/_react[\"default\"].createElement(_FieldWrapper[\"default\"], {\n        name: this.props.name,\n        hint: this.props.description,\n        error: this.props.error\n      }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n        spacing: 1\n      }, /*#__PURE__*/_react[\"default\"].createElement(_Label[\"default\"], {\n        intlLabel: this.props.intlLabel,\n        labelAction: this.props.labelAction,\n        name: this.props.name,\n        required: this.props.required\n      }), /*#__PURE__*/_react[\"default\"].createElement(_components.StyledBox, {\n        error: this.props.error\n      }, /*#__PURE__*/_react[\"default\"].createElement(_components.EditorWrapper, {\n        disabled: this.props.disabled\n      }, /*#__PURE__*/_react[\"default\"].createElement(\"textarea\", {\n        ref: this.editor,\n        autoComplete: \"off\",\n        id: this.props.id || this.props.name,\n        defaultValue: \"\"\n      }))), /*#__PURE__*/_react[\"default\"].createElement(_Field.FieldHint, null), /*#__PURE__*/_react[\"default\"].createElement(_Field.FieldError, null)));\n    }\n  }]);\n  return InputJSON;\n}(_react[\"default\"].Component);\n\nInputJSON.defaultProps = {\n  description: null,\n  disabled: false,\n  id: undefined,\n  error: undefined,\n  intlLabel: undefined,\n  labelAction: undefined,\n  onChange: function onChange() {},\n  value: null,\n  required: false\n};\nInputJSON.propTypes = {\n  description: _propTypes[\"default\"].shape({\n    id: _propTypes[\"default\"].string.isRequired,\n    defaultMessage: _propTypes[\"default\"].string.isRequired,\n    values: _propTypes[\"default\"].object\n  }),\n  disabled: _propTypes[\"default\"].bool,\n  error: _propTypes[\"default\"].string,\n  id: _propTypes[\"default\"].string,\n  intlLabel: _propTypes[\"default\"].shape({\n    id: _propTypes[\"default\"].string.isRequired,\n    defaultMessage: _propTypes[\"default\"].string.isRequired,\n    values: _propTypes[\"default\"].object\n  }),\n  labelAction: _propTypes[\"default\"].element,\n  name: _propTypes[\"default\"].string.isRequired,\n  onChange: _propTypes[\"default\"].func,\n  value: _propTypes[\"default\"].any,\n  required: _propTypes[\"default\"].bool\n};\nvar _default = InputJSON;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}