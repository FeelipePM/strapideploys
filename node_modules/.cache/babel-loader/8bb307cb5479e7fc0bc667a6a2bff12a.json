{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Popover = require(\"@strapi/design-system/Popover\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _FocusTrap = require(\"@strapi/design-system/FocusTrap\");\n\nvar _Select = require(\"@strapi/design-system/Select\");\n\nvar _Plus = _interopRequireDefault(require(\"@strapi/icons/Plus\"));\n\nvar _FilterValueInput = _interopRequireDefault(require(\"./FilterValueInput\"));\n\nvar _getFilterList = _interopRequireDefault(require(\"./utils/getFilterList\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar FilterPopover = function FilterPopover(_ref) {\n  var displayedFilters = _ref.displayedFilters,\n      filters = _ref.filters,\n      onSubmit = _ref.onSubmit,\n      onToggle = _ref.onToggle,\n      source = _ref.source;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)({\n    name: 'createdAt',\n    filter: '$eq',\n    value: ''\n  }),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      modifiedData = _useState2[0],\n      setModifiedData = _useState2[1];\n\n  var handleChangeFilterField = function handleChangeFilterField(value) {\n    var nextField = displayedFilters.find(function (f) {\n      return f.name === value;\n    });\n    var _nextField$fieldSchem = nextField.fieldSchema,\n        type = _nextField$fieldSchem.type,\n        options = _nextField$fieldSchem.options;\n    var filterValue = '';\n\n    if (type === 'enumeration') {\n      filterValue = options[0].value;\n    }\n\n    var filter = (0, _getFilterList[\"default\"])(nextField)[0].value;\n    setModifiedData({\n      name: value,\n      filter: filter,\n      value: filterValue\n    });\n  };\n\n  var handleChangeOperator = function handleChangeOperator(operator) {\n    if (modifiedData.name === 'mime') {\n      setModifiedData(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          filter: operator,\n          value: 'image'\n        });\n      });\n    } else {\n      setModifiedData(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          filter: operator,\n          value: ''\n        });\n      });\n    }\n  };\n\n  var handleSubmit = function handleSubmit(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (modifiedData.value) {\n      if (modifiedData.name === 'mime') {\n        var alreadyAppliedFilters = filters.filter(function (filter) {\n          return Object.keys(filter)[0] === 'mime';\n        });\n\n        if (modifiedData.value === 'file') {\n          var filtersWithoutMimeType = filters.filter(function (filter) {\n            return Object.keys(filter)[0] !== 'mime';\n          });\n          var hasCurrentFilter = false;\n\n          var _filterToAdd;\n\n          if (modifiedData.filter === '$contains') {\n            hasCurrentFilter = alreadyAppliedFilters.find(function (filter) {\n              var _filter$mime, _filter$mime$$not;\n\n              return ((_filter$mime = filter.mime) === null || _filter$mime === void 0 ? void 0 : (_filter$mime$$not = _filter$mime.$not) === null || _filter$mime$$not === void 0 ? void 0 : _filter$mime$$not.$contains) !== undefined;\n            }) !== undefined;\n            _filterToAdd = {\n              mime: {\n                $not: {\n                  $contains: ['image', 'video']\n                }\n              }\n            };\n          } else {\n            hasCurrentFilter = alreadyAppliedFilters.find(function (filter) {\n              var _filter$mime2;\n\n              return Array.isArray((_filter$mime2 = filter.mime) === null || _filter$mime2 === void 0 ? void 0 : _filter$mime2.$contains);\n            }) !== undefined;\n            _filterToAdd = {\n              mime: {\n                $contains: ['image', 'video']\n              }\n            };\n          }\n\n          if (hasCurrentFilter) {\n            onToggle();\n            return;\n          }\n\n          var nextFilters = [].concat((0, _toConsumableArray2[\"default\"])(filtersWithoutMimeType), [_filterToAdd]);\n          onSubmit(nextFilters);\n          onToggle();\n          return;\n        }\n\n        var _hasFilter = alreadyAppliedFilters.find(function (filter) {\n          return filter.mime[modifiedData.filter] === modifiedData.value;\n        }) !== undefined; // Don't apply the same filter twice\n\n\n        if (_hasFilter) {\n          onToggle();\n          return;\n        }\n\n        var filtersWithoutFile = filters.filter(function (filter) {\n          var _filter$mime3, _filter$mime3$$not, _filter$mime4;\n\n          var filterType = Object.keys(filter)[0];\n\n          if (filterType !== 'mime') {\n            return true;\n          }\n\n          if (((_filter$mime3 = filter.mime) === null || _filter$mime3 === void 0 ? void 0 : (_filter$mime3$$not = _filter$mime3.$not) === null || _filter$mime3$$not === void 0 ? void 0 : _filter$mime3$$not.$contains) !== undefined) {\n            return false;\n          }\n\n          if (Array.isArray(filter === null || filter === void 0 ? void 0 : (_filter$mime4 = filter.mime) === null || _filter$mime4 === void 0 ? void 0 : _filter$mime4.$contains)) {\n            return false;\n          }\n\n          return true;\n        });\n        var oppositeFilter = modifiedData.filter === '$contains' ? '$notContains' : '$contains';\n        var oppositeFilterIndex = filtersWithoutFile.findIndex(function (filter) {\n          var _filter$mime5;\n\n          return ((_filter$mime5 = filter.mime) === null || _filter$mime5 === void 0 ? void 0 : _filter$mime5[oppositeFilter]) === modifiedData.value;\n        });\n        var hasOppositeFilter = oppositeFilterIndex !== -1;\n        var filterToAdd = (0, _defineProperty2[\"default\"])({}, modifiedData.name, (0, _defineProperty2[\"default\"])({}, modifiedData.filter, modifiedData.value));\n\n        if (!hasOppositeFilter) {\n          var _nextFilters = [].concat((0, _toConsumableArray2[\"default\"])(filtersWithoutFile), [filterToAdd]);\n\n          onSubmit(_nextFilters);\n          onToggle();\n          return;\n        }\n\n        if (hasOppositeFilter) {\n          var _nextFilters2 = filtersWithoutFile.slice();\n\n          _nextFilters2.splice(oppositeFilterIndex, 1, filterToAdd);\n\n          onSubmit(_nextFilters2);\n          onToggle();\n        }\n\n        return;\n      }\n\n      var hasFilter = filters.find(function (filter) {\n        var _filter$modifiedData$;\n\n        return filter[modifiedData.name] && ((_filter$modifiedData$ = filter[modifiedData.name]) === null || _filter$modifiedData$ === void 0 ? void 0 : _filter$modifiedData$[modifiedData.filter]) === modifiedData.value;\n      }) !== undefined;\n\n      if (!hasFilter) {\n        var _filterToAdd3 = (0, _defineProperty2[\"default\"])({}, modifiedData.name, (0, _defineProperty2[\"default\"])({}, modifiedData.filter, modifiedData.value));\n\n        var _nextFilters3 = [].concat((0, _toConsumableArray2[\"default\"])(filters), [_filterToAdd3]);\n\n        onSubmit(_nextFilters3);\n      }\n    }\n\n    onToggle();\n  };\n\n  var appliedFilter = displayedFilters.find(function (filter) {\n    return filter.name === modifiedData.name;\n  });\n  return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_Popover.Popover, {\n    source: source,\n    padding: 3,\n    spacing: 4\n  }, /*#__PURE__*/_react[\"default\"].createElement(_FocusTrap.FocusTrap, {\n    onEscape: onToggle\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n    spacing: 1,\n    style: {\n      minWidth: 184\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Select.Select, {\n    \"aria-label\": formatMessage({\n      id: 'app.utils.select-field',\n      defaultMessage: 'Select field'\n    }),\n    name: \"name\",\n    size: \"M\",\n    onChange: handleChangeFilterField,\n    value: modifiedData.name\n  }, displayedFilters.map(function (filter) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Select.Option, {\n      key: filter.name,\n      value: filter.name\n    }, filter.metadatas.label);\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Select.Select, {\n    \"aria-label\": formatMessage({\n      id: 'app.utils.select-filter',\n      defaultMessage: 'Select filter'\n    }),\n    name: \"filter\",\n    size: \"M\",\n    value: modifiedData.filter,\n    onChange: handleChangeOperator\n  }, (0, _getFilterList[\"default\"])(appliedFilter).map(function (option) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Select.Option, {\n      key: option.value,\n      value: option.value\n    }, formatMessage(option.intlLabel));\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_FilterValueInput[\"default\"], (0, _extends2[\"default\"])({}, appliedFilter.metadatas, appliedFilter.fieldSchema, {\n    value: modifiedData.value,\n    onChange: function onChange(value) {\n      return setModifiedData(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          value: value\n        });\n      });\n    }\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n    size: \"L\",\n    variant: \"secondary\",\n    startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Plus[\"default\"], null),\n    type: \"submit\",\n    fullWidth: true\n  }, formatMessage({\n    id: 'app.utils.add-filter',\n    defaultMessage: 'Add filter'\n  }))))))));\n};\n\nFilterPopover.propTypes = {\n  displayedFilters: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].shape({\n    name: _propTypes[\"default\"].string.isRequired,\n    metadatas: _propTypes[\"default\"].shape({\n      label: _propTypes[\"default\"].string\n    }),\n    fieldSchema: _propTypes[\"default\"].shape({\n      type: _propTypes[\"default\"].string\n    })\n  })).isRequired,\n  filters: _propTypes[\"default\"].array.isRequired,\n  onSubmit: _propTypes[\"default\"].func.isRequired,\n  onToggle: _propTypes[\"default\"].func.isRequired,\n  source: _propTypes[\"default\"].shape({\n    current: _propTypes[\"default\"].instanceOf(Element)\n  }).isRequired\n};\nvar _default = FilterPopover;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}