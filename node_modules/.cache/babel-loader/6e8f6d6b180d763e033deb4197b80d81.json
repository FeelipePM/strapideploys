{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.SettingsPage = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactHelmet = require(\"react-helmet\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Check = _interopRequireDefault(require(\"@strapi/icons/Check\"));\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Flex = require(\"@strapi/design-system/Flex\");\n\nvar _ToggleInput = require(\"@strapi/design-system/ToggleInput\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _isEqual = _interopRequireDefault(require(\"lodash/isEqual\"));\n\nvar _utils = require(\"../../utils\");\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _permissions = _interopRequireDefault(require(\"../../permissions\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar SettingsPage = function SettingsPage() {\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useOverlayBlocker = (0, _helperPlugin.useOverlayBlocker)(),\n      lockApp = _useOverlayBlocker.lockApp,\n      unlockApp = _useOverlayBlocker.unlockApp;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n  (0, _helperPlugin.useFocusWhenNavigate)();\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, _init[\"default\"]),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      initialData = _useReducer2$.initialData,\n      isLoading = _useReducer2$.isLoading,\n      isSubmiting = _useReducer2$.isSubmiting,\n      modifiedData = _useReducer2$.modifiedData,\n      dispatch = _useReducer2[1];\n\n  var isMounted = (0, _react.useRef)(true);\n  (0, _react.useEffect)(function () {\n    var CancelToken = _axios[\"default\"].CancelToken;\n    var source = CancelToken.source();\n\n    var getData = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        var _yield$axiosInstance$, data;\n\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _utils.axiosInstance.get((0, _utils.getRequestUrl)('settings'), {\n                  cancelToken: source.token\n                });\n\n              case 3:\n                _yield$axiosInstance$ = _context.sent;\n                data = _yield$axiosInstance$.data.data;\n                dispatch({\n                  type: 'GET_DATA_SUCCEEDED',\n                  data: data\n                });\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n                console.error(_context.t0);\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8]]);\n      }));\n\n      return function getData() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    if (isMounted.current) {\n      getData();\n    }\n\n    return function () {\n      source.cancel('Operation canceled by the user.');\n      isMounted.current = false;\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var isSaveButtonDisabled = (0, _isEqual[\"default\"])(initialData, modifiedData);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(e) {\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!isSaveButtonDisabled) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              lockApp();\n              dispatch({\n                type: 'ON_SUBMIT'\n              });\n              _context2.prev = 5;\n              _context2.next = 8;\n              return _utils.axiosInstance.put((0, _utils.getRequestUrl)('settings'), modifiedData);\n\n            case 8:\n              dispatch({\n                type: 'SUBMIT_SUCCEEDED'\n              });\n              toggleNotification({\n                type: 'success',\n                message: {\n                  id: 'notification.form.success.fields'\n                }\n              });\n              _context2.next = 16;\n              break;\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](5);\n              console.error(_context2.t0);\n              dispatch({\n                type: 'ON_SUBMIT_ERROR'\n              });\n\n            case 16:\n              unlockApp();\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[5, 12]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(_ref3) {\n    var _ref3$target = _ref3.target,\n        name = _ref3$target.name,\n        value = _ref3$target.value;\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: name,\n      value: value\n    });\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, {\n    tabIndex: -1\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactHelmet.Helmet, {\n    title: formatMessage({\n      id: (0, _utils.getTrad)('page.title'),\n      defaultMessage: 'Settings - Media Libray'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n    title: formatMessage({\n      id: (0, _utils.getTrad)('settings.header.label'),\n      defaultMessage: 'Media Library'\n    }),\n    primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n      disabled: isSaveButtonDisabled,\n      \"data-testid\": \"save-button\",\n      loading: isSubmiting,\n      type: \"submit\",\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Check[\"default\"], null),\n      size: \"L\"\n    }, formatMessage({\n      id: 'app.components.Button.save',\n      defaultMessage: 'Save'\n    })),\n    subtitle: formatMessage({\n      id: (0, _utils.getTrad)('settings.sub-header.label'),\n      defaultMessage: 'Configure the settings for the Media Library'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, isLoading ? /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null) : /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n    spacing: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n    background: \"neutral0\",\n    padding: 6,\n    shadow: \"filterShadow\",\n    hasRadius: true\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n    spacing: 4\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n    variant: \"delta\",\n    as: \"h2\"\n  }, formatMessage({\n    id: (0, _utils.getTrad)('settings.blockTitle'),\n    defaultMessage: 'Asset management'\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n    gap: 6\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n    col: 6,\n    s: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ToggleInput.ToggleInput, {\n    \"aria-label\": \"responsiveDimensions\",\n    \"data-testid\": \"responsiveDimensions\",\n    checked: modifiedData.responsiveDimensions,\n    hint: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.responsiveDimensions.description'),\n      defaultMessage: 'Enabling this option will generate multiple formats (small, medium and large) of the uploaded asset.'\n    }),\n    label: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.responsiveDimensions.label'),\n      defaultMessage: 'Responsive friendly upload'\n    }),\n    name: \"responsiveDimensions\",\n    offLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.off-label',\n      defaultMessage: 'Off'\n    }),\n    onLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.on-label',\n      defaultMessage: 'On'\n    }),\n    onChange: function onChange(e) {\n      handleChange({\n        target: {\n          name: 'responsiveDimensions',\n          value: e.target.checked\n        }\n      });\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n    col: 6,\n    s: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ToggleInput.ToggleInput, {\n    \"aria-label\": \"sizeOptimization\",\n    \"data-testid\": \"sizeOptimization\",\n    checked: modifiedData.sizeOptimization,\n    hint: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.sizeOptimization.description'),\n      defaultMessage: 'Enabling this option will reduce the image size and slightly reduce its quality.'\n    }),\n    label: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.sizeOptimization.label'),\n      defaultMessage: 'Size optimization'\n    }),\n    name: \"sizeOptimization\",\n    offLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.off-label',\n      defaultMessage: 'Off'\n    }),\n    onLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.on-label',\n      defaultMessage: 'On'\n    }),\n    onChange: function onChange(e) {\n      handleChange({\n        target: {\n          name: 'sizeOptimization',\n          value: e.target.checked\n        }\n      });\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n    col: 6,\n    s: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ToggleInput.ToggleInput, {\n    \"aria-label\": \"autoOrientation\",\n    \"data-testid\": \"autoOrientation\",\n    checked: modifiedData.autoOrientation,\n    hint: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.autoOrientation.description'),\n      defaultMessage: 'Enabling this option will automatically rotate the image according to EXIF orientation tag.'\n    }),\n    label: formatMessage({\n      id: (0, _utils.getTrad)('settings.form.autoOrientation.label'),\n      defaultMessage: 'Auto orientation'\n    }),\n    name: \"autoOrientation\",\n    offLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.off-label',\n      defaultMessage: 'Off'\n    }),\n    onLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.on-label',\n      defaultMessage: 'On'\n    }),\n    onChange: function onChange(e) {\n      handleChange({\n        target: {\n          name: 'autoOrientation',\n          value: e.target.checked\n        }\n      });\n    }\n  }))))))))));\n};\n\nexports.SettingsPage = SettingsPage;\n\nvar ProtectedSettingsPage = function ProtectedSettingsPage() {\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: _permissions[\"default\"].settings\n  }, /*#__PURE__*/_react[\"default\"].createElement(SettingsPage, null));\n};\n\nvar _default = ProtectedSettingsPage;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}