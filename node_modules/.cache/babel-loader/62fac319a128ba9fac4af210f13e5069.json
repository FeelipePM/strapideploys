{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Table = require(\"@strapi/design-system/Table\");\n\nvar _VisuallyHidden = require(\"@strapi/design-system/VisuallyHidden\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _LiveRegions = require(\"@strapi/design-system/LiveRegions\");\n\nvar _Plus = _interopRequireDefault(require(\"@strapi/icons/Plus\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _matchSorter = _interopRequireDefault(require(\"match-sorter\"));\n\nvar _api = require(\"./utils/api\");\n\nvar _utils = require(\"../../../utils\");\n\nvar _pluginId = _interopRequireDefault(require(\"../../../pluginId\"));\n\nvar _permissions = _interopRequireDefault(require(\"../../../permissions\"));\n\nvar _TableBody = _interopRequireDefault(require(\"./components/TableBody\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar RoleListPage = function RoleListPage() {\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      push = _useHistory.push;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useNotifyAT = (0, _LiveRegions.useNotifyAT)(),\n      notifyStatus = _useNotifyAT.notifyStatus;\n\n  var _useQueryParams = (0, _helperPlugin.useQueryParams)(),\n      _useQueryParams2 = (0, _slicedToArray2[\"default\"])(_useQueryParams, 1),\n      query = _useQueryParams2[0].query;\n\n  var _q = (query === null || query === void 0 ? void 0 : query._q) || '';\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      showConfirmDelete = _useState2[0],\n      setShowConfirmDelete = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(false),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      isConfirmButtonLoading = _useState4[0],\n      setIsConfirmButtonLoading = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      roleToDelete = _useState6[0],\n      setRoleToDelete = _useState6[1];\n\n  (0, _helperPlugin.useFocusWhenNavigate)();\n  var queryClient = (0, _reactQuery.useQueryClient)();\n  var updatePermissions = (0, _react.useMemo)(function () {\n    return {\n      create: _permissions[\"default\"].createRole,\n      read: _permissions[\"default\"].readRoles,\n      update: _permissions[\"default\"].updateRole,\n      \"delete\": _permissions[\"default\"].deleteRole\n    };\n  }, []);\n\n  var _useRBAC = (0, _helperPlugin.useRBAC)(updatePermissions),\n      isLoadingForPermissions = _useRBAC.isLoading,\n      _useRBAC$allowedActio = _useRBAC.allowedActions,\n      canRead = _useRBAC$allowedActio.canRead,\n      canDelete = _useRBAC$allowedActio.canDelete;\n\n  var _useQuery = (0, _reactQuery.useQuery)('get-roles', function () {\n    return (0, _api.fetchData)(toggleNotification, notifyStatus);\n  }, {\n    initialData: {},\n    enabled: canRead\n  }),\n      isLoadingForData = _useQuery.isLoading,\n      roles = _useQuery.data.roles,\n      isFetching = _useQuery.isFetching;\n\n  var isLoading = isLoadingForData || isFetching;\n\n  var handleNewRoleClick = function handleNewRoleClick() {\n    trackUsage('willCreateRole');\n    push(\"/settings/\".concat(_pluginId[\"default\"], \"/roles/new\"));\n  };\n\n  var handleShowConfirmDelete = function handleShowConfirmDelete() {\n    setShowConfirmDelete(!showConfirmDelete);\n  };\n\n  var emptyLayout = {\n    roles: {\n      id: (0, _utils.getTrad)('Roles.empty'),\n      defaultMessage: \"You don't have any roles yet.\"\n    },\n    search: {\n      id: (0, _utils.getTrad)('Roles.empty.search'),\n      defaultMessage: 'No roles match the search.'\n    }\n  };\n  var pageTitle = formatMessage({\n    id: (0, _utils.getTrad)('HeaderNav.link.roles'),\n    defaultMessage: 'Roles'\n  });\n  var deleteMutation = (0, _reactQuery.useMutation)(function (id) {\n    return (0, _api.deleteData)(id, toggleNotification);\n  }, {\n    onSuccess: function () {\n      var _onSuccess = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return queryClient.invalidateQueries('get-roles');\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onSuccess() {\n        return _onSuccess.apply(this, arguments);\n      }\n\n      return onSuccess;\n    }()\n  });\n\n  var handleConfirmDelete = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setIsConfirmButtonLoading(true);\n              _context2.next = 3;\n              return deleteMutation.mutateAsync(roleToDelete);\n\n            case 3:\n              setShowConfirmDelete(!showConfirmDelete);\n              setIsConfirmButtonLoading(false);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleConfirmDelete() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var sortedRoles = (0, _matchSorter[\"default\"])(roles || [], _q, {\n    keys: ['name', 'description']\n  });\n  var emptyContent = _q && !sortedRoles.length ? 'search' : 'roles';\n  var colCount = 4;\n  var rowCount = ((roles === null || roles === void 0 ? void 0 : roles.length) || 0) + 1;\n  return /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SettingsPageTitle, {\n    name: pageTitle\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, {\n    \"aria-busy\": isLoading\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n    title: formatMessage({\n      id: 'Settings.roles.title',\n      defaultMessage: 'Roles'\n    }),\n    subtitle: formatMessage({\n      id: 'Settings.roles.list.description',\n      defaultMessage: 'List of roles'\n    }),\n    primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPermissions, {\n      permissions: _permissions[\"default\"].createRole\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n      onClick: handleNewRoleClick,\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Plus[\"default\"], null),\n      size: \"L\"\n    }, formatMessage({\n      id: (0, _utils.getTrad)('List.button.roles'),\n      defaultMessage: 'Add new role'\n    })))\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ActionLayout, {\n    startActions: /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SearchURLQuery, {\n      label: formatMessage({\n        id: 'app.component.search.label',\n        defaultMessage: 'Search'\n      })\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, !canRead && /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.NoPermissions, null), (isLoading || isLoadingForPermissions) && /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null), canRead && sortedRoles && sortedRoles !== null && sortedRoles !== void 0 && sortedRoles.length ? /*#__PURE__*/_react[\"default\"].createElement(_Table.Table, {\n    colCount: colCount,\n    rowCount: rowCount\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Table.Thead, null, /*#__PURE__*/_react[\"default\"].createElement(_Table.Tr, null, /*#__PURE__*/_react[\"default\"].createElement(_Table.Th, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n    variant: \"sigma\",\n    textColor: \"neutral600\"\n  }, formatMessage({\n    id: (0, _utils.getTrad)('Roles.name'),\n    defaultMessage: 'Name'\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Table.Th, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n    variant: \"sigma\",\n    textColor: \"neutral600\"\n  }, formatMessage({\n    id: (0, _utils.getTrad)('Roles.description'),\n    defaultMessage: 'Description'\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Table.Th, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n    variant: \"sigma\",\n    textColor: \"neutral600\"\n  }, formatMessage({\n    id: (0, _utils.getTrad)('Roles.users'),\n    defaultMessage: 'Users'\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_Table.Th, null, /*#__PURE__*/_react[\"default\"].createElement(_VisuallyHidden.VisuallyHidden, null, formatMessage({\n    id: 'components.TableHeader.actions-label',\n    defaultMessage: 'Actions'\n  }))))), /*#__PURE__*/_react[\"default\"].createElement(_TableBody[\"default\"], {\n    sortedRoles: sortedRoles,\n    canDelete: canDelete,\n    permissions: _permissions[\"default\"],\n    setRoleToDelete: setRoleToDelete,\n    onDelete: [showConfirmDelete, setShowConfirmDelete]\n  })) : /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.EmptyStateLayout, {\n    content: emptyLayout[emptyContent]\n  })), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.ConfirmDialog, {\n    isConfirmButtonLoading: isConfirmButtonLoading,\n    onConfirm: handleConfirmDelete,\n    onToggleDialog: handleShowConfirmDelete,\n    isOpen: showConfirmDelete\n  })));\n};\n\nvar _default = RoleListPage;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}