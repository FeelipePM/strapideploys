{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _ModalLayout = require(\"@strapi/design-system/ModalLayout\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _Breadcrumbs = require(\"@strapi/design-system/Breadcrumbs\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _formik = require(\"formik\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _utils = require(\"../../../../../../core/utils\");\n\nvar _SelectRoles = _interopRequireDefault(require(\"../../components/SelectRoles\"));\n\nvar _layout = _interopRequireDefault(require(\"./utils/layout\"));\n\nvar _schema = _interopRequireDefault(require(\"./utils/schema\"));\n\nvar _stepper = _interopRequireDefault(require(\"./utils/stepper\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar formDataModel = function () {\n  if (window && window.strapi && window.strapi.isEE) {\n    return require('../../../../../../../../ee/admin/pages/SettingsPage/pages/Users/ListPage/ModalForm/utils/formDataModel')[\"default\"];\n  }\n\n  return require('./utils/formDataModel')[\"default\"];\n}();\n\nvar roleSettingsForm = function () {\n  if (window && window.strapi && window.strapi.isEE) {\n    return require('../../../../../../../../ee/admin/pages/SettingsPage/pages/Users/ListPage/ModalForm/utils/roleSettingsForm')[\"default\"];\n  }\n\n  return require('./utils/roleSettingsForm')[\"default\"];\n}();\n\nvar MagicLink = function () {\n  if (window && window.strapi && window.strapi.isEE) {\n    return require('../../../../../../../../ee/admin/pages/SettingsPage/pages/Users/components/MagicLink')[\"default\"];\n  }\n\n  return require('../../components/MagicLink')[\"default\"];\n}();\n\nvar ModalForm = function ModalForm(_ref) {\n  var queryName = _ref.queryName,\n      onToggle = _ref.onToggle;\n\n  var _useState = (0, _react.useState)('create'),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      currentStep = _useState2[0],\n      setStep = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(false),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      isSubmitting = _useState4[0],\n      setIsSubmitting = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(null),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      registrationToken = _useState6[0],\n      setRegistrationToken = _useState6[1];\n\n  var queryClient = (0, _reactQuery.useQueryClient)();\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useOverlayBlocker = (0, _helperPlugin.useOverlayBlocker)(),\n      lockApp = _useOverlayBlocker.lockApp,\n      unlockApp = _useOverlayBlocker.unlockApp;\n\n  var postMutation = (0, _reactQuery.useMutation)(function (body) {\n    return _utils.axiosInstance.post('/admin/users', body);\n  }, {\n    onSuccess: function () {\n      var _onSuccess = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(_ref2) {\n        var data;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = _ref2.data;\n                setRegistrationToken(data.data.registrationToken);\n                _context.next = 4;\n                return queryClient.invalidateQueries(queryName);\n\n              case 4:\n                goNext();\n                setIsSubmitting(false);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onSuccess(_x) {\n        return _onSuccess.apply(this, arguments);\n      }\n\n      return onSuccess;\n    }(),\n    onError: function onError(err) {\n      setIsSubmitting(false);\n      toggleNotification({\n        type: 'warning',\n        message: {\n          id: 'notification.error',\n          defaultMessage: 'An error occured'\n        }\n      });\n      throw err;\n    },\n    onSettled: function onSettled() {\n      unlockApp();\n    }\n  });\n  var headerTitle = formatMessage({\n    id: 'Settings.permissions.users.create',\n    defaultMessage: 'Invite new user'\n  });\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(body, _ref3) {\n      var setErrors, _err$response;\n\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setErrors = _ref3.setErrors;\n              lockApp();\n              setIsSubmitting(true);\n              _context2.prev = 3;\n              _context2.next = 6;\n              return postMutation.mutateAsync(body);\n\n            case 6:\n              _context2.next = 12;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](3);\n              unlockApp();\n\n              if ((_context2.t0 === null || _context2.t0 === void 0 ? void 0 : (_err$response = _context2.t0.response) === null || _err$response === void 0 ? void 0 : _err$response.data.message) === 'Email already taken') {\n                setErrors({\n                  email: _context2.t0.response.data.message\n                });\n              }\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[3, 8]]);\n    }));\n\n    return function handleSubmit(_x2, _x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var goNext = function goNext() {\n    if (next) {\n      setStep(next);\n    } else {\n      onToggle();\n    }\n  };\n\n  var _stepper$currentStep = _stepper[\"default\"][currentStep],\n      buttonSubmitLabel = _stepper$currentStep.buttonSubmitLabel,\n      isDisabled = _stepper$currentStep.isDisabled,\n      next = _stepper$currentStep.next;\n  var endActions = currentStep === 'create' ? /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n    type: \"submit\",\n    loading: isSubmitting\n  }, formatMessage(buttonSubmitLabel)) : /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n    type: \"button\",\n    loading: isSubmitting,\n    onClick: onToggle\n  }, formatMessage(buttonSubmitLabel));\n  return /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalLayout, {\n    onClose: onToggle,\n    labelledBy: \"title\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalHeader, null, /*#__PURE__*/_react[\"default\"].createElement(_Breadcrumbs.Breadcrumbs, {\n    label: headerTitle\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Breadcrumbs.Crumb, null, headerTitle))), /*#__PURE__*/_react[\"default\"].createElement(_formik.Formik, {\n    initialValues: formDataModel,\n    onSubmit: handleSubmit,\n    validationSchema: _schema[\"default\"],\n    validateOnChange: false\n  }, function (_ref5) {\n    var errors = _ref5.errors,\n        handleChange = _ref5.handleChange,\n        values = _ref5.values;\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.Form, null, /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalBody, null, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 6\n    }, currentStep !== 'create' && /*#__PURE__*/_react[\"default\"].createElement(MagicLink, {\n      registrationToken: registrationToken\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      variant: \"beta\",\n      as: \"h2\"\n    }, formatMessage({\n      id: 'app.components.Users.ModalCreateBody.block-title.details',\n      defaultMessage: 'User details'\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingTop: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 1\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 5\n    }, _layout[\"default\"].map(function (row) {\n      return row.map(function (input) {\n        return /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, (0, _extends2[\"default\"])({\n          key: input.name\n        }, input.size), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.GenericInput, (0, _extends2[\"default\"])({}, input, {\n          disabled: isDisabled,\n          error: errors[input.name],\n          onChange: handleChange,\n          value: values[input.name]\n        })));\n      });\n    }))))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      variant: \"beta\",\n      as: \"h2\"\n    }, formatMessage({\n      id: 'app.components.Users.ModalCreateBody.block-title.login',\n      defaultMessage: \"User's role\"\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingTop: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 5\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 6,\n      xs: 12\n    }, /*#__PURE__*/_react[\"default\"].createElement(_SelectRoles[\"default\"], {\n      disabled: isDisabled,\n      error: errors.roles,\n      onChange: handleChange,\n      value: values.roles\n    })), roleSettingsForm.map(function (row) {\n      return row.map(function (input) {\n        return /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, (0, _extends2[\"default\"])({\n          key: input.name\n        }, input.size), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.GenericInput, (0, _extends2[\"default\"])({}, input, {\n          disabled: isDisabled,\n          onChange: handleChange,\n          value: values[input.name]\n        })));\n      });\n    })))))), /*#__PURE__*/_react[\"default\"].createElement(_ModalLayout.ModalFooter, {\n      startActions: /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        variant: \"tertiary\",\n        onClick: onToggle,\n        type: \"button\"\n      }, formatMessage({\n        id: 'app.components.Button.cancel',\n        defaultMessage: 'Cancel'\n      })),\n      endActions: endActions\n    }));\n  }));\n};\n\nModalForm.propTypes = {\n  onToggle: _propTypes[\"default\"].func.isRequired,\n  queryName: _propTypes[\"default\"].array.isRequired\n};\nvar _default = ModalForm;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}