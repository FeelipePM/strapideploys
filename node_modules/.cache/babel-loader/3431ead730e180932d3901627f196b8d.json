{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.CreatePage = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Link = require(\"@strapi/design-system/Link\");\n\nvar _Flex = require(\"@strapi/design-system/Flex\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _TextInput = require(\"@strapi/design-system/TextInput\");\n\nvar _Textarea = require(\"@strapi/design-system/Textarea\");\n\nvar _ArrowLeft = _interopRequireDefault(require(\"@strapi/icons/ArrowLeft\"));\n\nvar _formik = require(\"formik\");\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _isEmpty = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _Permissions = _interopRequireDefault(require(\"../../../../../../../admin/src/pages/SettingsPage/pages/Roles/EditPage/components/Permissions\"));\n\nvar _hooks = require(\"../../../../../../../admin/src/hooks\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../../../../../admin/src/permissions\"));\n\nvar _schema = _interopRequireDefault(require(\"./utils/schema\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar UsersRoleNumber = /*#__PURE__*/_styledComponents[\"default\"].div.withConfig({\n  displayName: \"CreatePage__UsersRoleNumber\",\n  componentId: \"sc-f7k9id-0\"\n})([\"border:1px solid \", \";background:\", \";padding:\", \";color:\", \";border-radius:\", \";font-size:\", \"rem;font-width:bold;\"], function (_ref) {\n  var theme = _ref.theme;\n  return theme.colors.primary200;\n}, function (_ref2) {\n  var theme = _ref2.theme;\n  return theme.colors.primary100;\n}, function (_ref3) {\n  var theme = _ref3.theme;\n  return \"\".concat(theme.spaces[2], \" \").concat(theme.spaces[4]);\n}, function (_ref4) {\n  var theme = _ref4.theme;\n  return theme.colors.primary600;\n}, function (_ref5) {\n  var theme = _ref5.theme;\n  return theme.borderRadius;\n}, 12 / 16);\n\nvar CreatePage = function CreatePage() {\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useOverlayBlocker = (0, _helperPlugin.useOverlayBlocker)(),\n      lockApp = _useOverlayBlocker.lockApp,\n      unlockApp = _useOverlayBlocker.unlockApp;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isSubmitting = _useState2[0],\n      setIsSubmiting = _useState2[1];\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      replace = _useHistory.replace;\n\n  var permissionsRef = (0, _react.useRef)();\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var params = (0, _reactRouterDom.useRouteMatch)('/settings/roles/duplicate/:id');\n  var id = (0, _get[\"default\"])(params, 'params.id', null);\n\n  var _useFetchPermissionsL = (0, _hooks.useFetchPermissionsLayout)(),\n      isLayoutLoading = _useFetchPermissionsL.isLoading,\n      permissionsLayout = _useFetchPermissionsL.data;\n\n  var _useFetchRole = (0, _hooks.useFetchRole)(id),\n      rolePermissions = _useFetchRole.permissions,\n      isRoleLoading = _useFetchRole.isLoading;\n\n  var handleCreateRoleSubmit = function handleCreateRoleSubmit(data) {\n    lockApp();\n    setIsSubmiting(true);\n\n    if (id) {\n      trackUsage('willDuplicateRole');\n    } else {\n      trackUsage('willCreateNewRole');\n    }\n\n    Promise.resolve((0, _helperPlugin.request)('/admin/roles', {\n      method: 'POST',\n      body: data\n    })).then( /*#__PURE__*/function () {\n      var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(res) {\n        var _permissionsRef$curre, permissionsToSend;\n\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _permissionsRef$curre = permissionsRef.current.getPermissions(), permissionsToSend = _permissionsRef$curre.permissionsToSend;\n\n                if (id) {\n                  trackUsage('didDuplicateRole');\n                } else {\n                  trackUsage('didCreateNewRole');\n                }\n\n                if (!(res.data.id && !(0, _isEmpty[\"default\"])(permissionsToSend))) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _context.next = 5;\n                return (0, _helperPlugin.request)(\"/admin/roles/\".concat(res.data.id, \"/permissions\"), {\n                  method: 'PUT',\n                  body: {\n                    permissions: permissionsToSend\n                  }\n                });\n\n              case 5:\n                return _context.abrupt(\"return\", res);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref6.apply(this, arguments);\n      };\n    }()).then(function (res) {\n      setIsSubmiting(false);\n      toggleNotification({\n        type: 'success',\n        message: {\n          id: 'Settings.roles.created',\n          defaultMessage: 'created'\n        }\n      });\n      replace(\"/settings/roles/\".concat(res.data.id));\n    })[\"catch\"](function (err) {\n      console.error(err);\n      setIsSubmiting(false);\n      toggleNotification({\n        type: 'warning',\n        message: {\n          id: 'notification.error'\n        }\n      });\n    })[\"finally\"](function () {\n      unlockApp();\n    });\n  };\n\n  var defaultDescription = \"\".concat(formatMessage({\n    id: 'Settings.roles.form.created',\n    defaultMessage: 'Created'\n  }), \" \").concat((0, _moment[\"default\"])().format('LL'));\n  return /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, null, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SettingsPageTitle, {\n    name: \"Roles\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_formik.Formik, {\n    initialValues: {\n      name: '',\n      description: defaultDescription\n    },\n    onSubmit: handleCreateRoleSubmit,\n    validationSchema: _schema[\"default\"],\n    validateOnChange: false\n  }, function (_ref7) {\n    var handleSubmit = _ref7.handleSubmit,\n        values = _ref7.values,\n        errors = _ref7.errors,\n        handleReset = _ref7.handleReset,\n        handleChange = _ref7.handleChange;\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.Form, {\n      noValidate: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n      primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n        horizontal: true,\n        spacing: 2\n      }, /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        variant: \"secondary\",\n        onClick: function onClick() {\n          handleReset();\n          permissionsRef.current.resetForm();\n        },\n        size: \"L\"\n      }, formatMessage({\n        id: 'app.components.Button.reset',\n        defaultMessage: 'Reset'\n      })), /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        onClick: handleSubmit,\n        loading: isSubmitting,\n        size: \"L\"\n      }, formatMessage({\n        id: 'app.components.Button.save',\n        defaultMessage: 'Save'\n      }))),\n      title: formatMessage({\n        id: 'Settings.roles.create.title',\n        defaultMessage: 'Create a role'\n      }),\n      subtitle: formatMessage({\n        id: 'Settings.roles.create.description',\n        defaultMessage: 'Define the rights given to the role'\n      }),\n      navigationAction: /*#__PURE__*/_react[\"default\"].createElement(_Link.Link, {\n        startIcon: /*#__PURE__*/_react[\"default\"].createElement(_ArrowLeft[\"default\"], null),\n        to: \"/settings/roles\"\n      }, formatMessage({\n        id: 'app.components.go-back',\n        defaultMessage: 'Back'\n      }))\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      background: \"neutral0\",\n      padding: 6,\n      shadow: \"filterShadow\",\n      hasRadius: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Flex.Flex, {\n      justifyContent: \"space-between\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      fontWeight: \"bold\"\n    }, formatMessage({\n      id: 'Settings.roles.form.title',\n      defaultMessage: 'Details'\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, null, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      variant: \"pi\",\n      textColor: \"neutral600\"\n    }, formatMessage({\n      id: 'Settings.roles.form.description',\n      defaultMessage: 'Name and description of the role'\n    })))), /*#__PURE__*/_react[\"default\"].createElement(UsersRoleNumber, null, formatMessage({\n      id: 'Settings.roles.form.button.users-with-role',\n      defaultMessage: '{number, plural, =0 {# users} one {# user} other {# users}} with this role'\n    }, {\n      number: 0\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_TextInput.TextInput, {\n      name: \"name\",\n      error: errors.name && formatMessage({\n        id: errors.name\n      }),\n      label: formatMessage({\n        id: 'Settings.roles.form.input.name',\n        defaultMessage: 'Name'\n      }),\n      onChange: handleChange,\n      value: values.name\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Textarea.Textarea, {\n      label: formatMessage({\n        id: 'Settings.roles.form.input.description',\n        defaultMessage: 'Description'\n      }),\n      name: \"description\",\n      error: errors.description && formatMessage({\n        id: errors.description\n      }),\n      onChange: handleChange\n    }, values.description))))), !isLayoutLoading && !isRoleLoading ? /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      shadow: \"filterShadow\",\n      hasRadius: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Permissions[\"default\"], {\n      isFormDisabled: false,\n      ref: permissionsRef,\n      permissions: rolePermissions,\n      layout: permissionsLayout\n    })) : /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      background: \"neutral0\",\n      padding: 6,\n      shadow: \"filterShadow\",\n      hasRadius: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null))))));\n  }));\n};\n\nexports.CreatePage = CreatePage;\n\nvar _default = function _default() {\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: _permissions[\"default\"].settings.roles.create\n  }, /*#__PURE__*/_react[\"default\"].createElement(CreatePage, null));\n};\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}