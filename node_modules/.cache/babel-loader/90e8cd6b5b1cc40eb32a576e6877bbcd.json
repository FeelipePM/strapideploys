{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Blocker = _interopRequireDefault(require(\"./Blocker\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar ELAPSED = 30;\n\nvar AutoReloadOverlayBlockerProvider = function AutoReloadOverlayBlockerProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isOpen = _useState2[0],\n      setIsOpen = _useState2[1];\n\n  var _useState3 = (0, _react.useState)({\n    elapsed: 0,\n    start: 0\n  }),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      elapsed = _useState4[0].elapsed,\n      setState = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(undefined),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      config = _useState6[0],\n      setConfig = _useState6[1];\n\n  var lockAppWithAutoreload = function lockAppWithAutoreload() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;\n    setIsOpen(true);\n    setConfig(config);\n    setState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        start: Date.now()\n      });\n    });\n  };\n\n  var unlockAppWithAutoreload = function unlockAppWithAutoreload() {\n    setIsOpen(false);\n    setState({\n      start: 0,\n      elapsed: 0\n    });\n    setConfig(undefined);\n  };\n\n  var lockApp = (0, _react.useRef)(lockAppWithAutoreload);\n  var unlockApp = (0, _react.useRef)(unlockAppWithAutoreload);\n  (0, _react.useEffect)(function () {\n    var timer = null;\n\n    if (isOpen) {\n      timer = setInterval(function () {\n        if (elapsed > ELAPSED) {\n          clearInterval(timer);\n          return null;\n        }\n\n        setState(function (prev) {\n          return _objectSpread(_objectSpread({}, prev), {}, {\n            elapsed: Math.round(Date.now() - prev.start) / 1000\n          });\n        });\n        return null;\n      }, 1000);\n    } else {\n      clearInterval(timer);\n    }\n\n    return function () {\n      clearInterval(timer);\n    };\n  }, [isOpen, elapsed]);\n  var displayedIcon = (config === null || config === void 0 ? void 0 : config.icon) || 'reload';\n  var description = {\n    id: (config === null || config === void 0 ? void 0 : config.description) || 'components.OverlayBlocker.description',\n    defaultMessage: \"You're using a feature that needs the server to restart. Please wait until the server is up.\"\n  };\n  var title = {\n    id: (config === null || config === void 0 ? void 0 : config.title) || 'components.OverlayBlocker.title',\n    defaultMessage: 'Waiting for restart'\n  };\n\n  if (elapsed > ELAPSED) {\n    displayedIcon = 'time';\n    description = {\n      id: 'components.OverlayBlocker.description.serverError',\n      defaultMessage: 'The server should have restarted, please check your logs in the terminal.'\n    };\n    title = {\n      id: 'components.OverlayBlocker.title.serverError',\n      defaultMessage: 'The restart is taking longer than expected'\n    };\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.AutoReloadOverlayBockerContext.Provider, {\n    value: {\n      lockApp: lockApp.current,\n      unlockApp: unlockApp.current\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Blocker[\"default\"], {\n    displayedIcon: displayedIcon,\n    isOpen: isOpen,\n    description: description,\n    title: title\n  }), children);\n};\n\nAutoReloadOverlayBlockerProvider.propTypes = {\n  children: _propTypes[\"default\"].element.isRequired\n};\nvar _default = AutoReloadOverlayBlockerProvider;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}