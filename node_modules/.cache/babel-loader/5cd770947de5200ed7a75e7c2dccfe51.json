{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _TextInput = require(\"@strapi/design-system/TextInput\");\n\nvar _Textarea = require(\"@strapi/design-system/Textarea\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _Check = _interopRequireDefault(require(\"@strapi/icons/Check\"));\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _formik = require(\"formik\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _UsersPermissions = _interopRequireDefault(require(\"../../../components/UsersPermissions\"));\n\nvar _getTrad = _interopRequireDefault(require(\"../../../utils/getTrad\"));\n\nvar _pluginId = _interopRequireDefault(require(\"../../../pluginId\"));\n\nvar _hooks = require(\"../../../hooks\");\n\nvar _schema = _interopRequireDefault(require(\"./utils/schema\"));\n\nvar _axiosInstance = _interopRequireDefault(require(\"../../../utils/axiosInstance\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar EditPage = function EditPage() {\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isSubmitting = _useState2[0],\n      setIsSubmitting = _useState2[1];\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      goBack = _useHistory.goBack;\n\n  var _useOverlayBlocker = (0, _helperPlugin.useOverlayBlocker)(),\n      lockApp = _useOverlayBlocker.lockApp,\n      unlockApp = _useOverlayBlocker.unlockApp;\n\n  var _usePlugins = (0, _hooks.usePlugins)(),\n      isLoadingPlugins = _usePlugins.isLoading,\n      permissions = _usePlugins.permissions,\n      routes = _usePlugins.routes;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var permissionsRef = (0, _react.useRef)();\n\n  var handleCreateRoleSubmit = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(data) {\n      var _permissions;\n\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // Set loading state\n              lockApp();\n              setIsSubmitting(true);\n              _context.prev = 2;\n              _permissions = permissionsRef.current.getPermissions(); // Update role in Strapi\n\n              _context.next = 6;\n              return _axiosInstance[\"default\"].post(\"/\".concat(_pluginId[\"default\"], \"/roles\"), _objectSpread(_objectSpread(_objectSpread({}, data), _permissions), {}, {\n                users: []\n              }));\n\n            case 6:\n              // Notify success\n              trackUsage('didCreateRole');\n              toggleNotification({\n                type: 'success',\n                message: {\n                  id: (0, _getTrad[\"default\"])('Settings.roles.created'),\n                  defaultMessage: 'Role created'\n                }\n              }); // Forcing redirecting since we don't have the id in the response\n\n              goBack();\n              _context.next = 15;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](2);\n              console.error(_context.t0);\n              toggleNotification({\n                type: 'warning',\n                message: {\n                  id: 'notification.error',\n                  defaultMessage: 'An error occurred'\n                }\n              });\n\n            case 15:\n              // Unset loading state\n              setIsSubmitting(false);\n              unlockApp();\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 11]]);\n    }));\n\n    return function handleCreateRoleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, null, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SettingsPageTitle, {\n    name: \"Roles\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_formik.Formik, {\n    enableReinitialize: true,\n    initialValues: {\n      name: '',\n      description: ''\n    },\n    onSubmit: handleCreateRoleSubmit,\n    validationSchema: _schema[\"default\"]\n  }, function (_ref2) {\n    var handleSubmit = _ref2.handleSubmit,\n        values = _ref2.values,\n        handleChange = _ref2.handleChange,\n        errors = _ref2.errors;\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.Form, {\n      noValidate: true,\n      onSubmit: handleSubmit\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n      primaryAction: !isLoadingPlugins && /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        type: \"submit\",\n        loading: isSubmitting,\n        startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Check[\"default\"], null)\n      }, formatMessage({\n        id: 'app.components.Button.save',\n        defaultMessage: 'Save'\n      })),\n      title: formatMessage({\n        id: 'Settings.roles.create.title',\n        defaultMessage: 'Create a role'\n      }),\n      subtitle: formatMessage({\n        id: 'Settings.roles.create.description',\n        defaultMessage: 'Define the rights given to the role'\n      })\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 7\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      background: \"neutral0\",\n      hasRadius: true,\n      shadow: \"filterShadow\",\n      paddingTop: 6,\n      paddingBottom: 6,\n      paddingLeft: 7,\n      paddingRight: 7\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      variant: \"delta\",\n      as: \"h2\"\n    }, formatMessage({\n      id: (0, _getTrad[\"default\"])('EditPage.form.roles'),\n      defaultMessage: 'Role details'\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_TextInput.TextInput, {\n      name: \"name\",\n      value: values.name || '',\n      onChange: handleChange,\n      label: formatMessage({\n        id: 'Settings.roles.form.input.name',\n        defaultMessage: 'Name'\n      }),\n      error: errors.name ? formatMessage({\n        id: errors.name,\n        defaultMessage: 'Invalid value'\n      }) : null\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Textarea.Textarea, {\n      name: \"description\",\n      value: values.description || '',\n      onChange: handleChange,\n      label: formatMessage({\n        id: 'Settings.roles.form.input.description',\n        defaultMessage: 'Description'\n      }),\n      error: errors.description ? formatMessage({\n        id: errors.description,\n        defaultMessage: 'Invalid value'\n      }) : null\n    }))))), !isLoadingPlugins && /*#__PURE__*/_react[\"default\"].createElement(_UsersPermissions[\"default\"], {\n      ref: permissionsRef,\n      permissions: permissions,\n      routes: routes\n    }))));\n  }));\n};\n\nvar _default = EditPage;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}