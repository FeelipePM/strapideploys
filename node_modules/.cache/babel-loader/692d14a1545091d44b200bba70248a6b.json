{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.enhanceRelationLayout = exports.enhanceEditLayout = exports.enhanceComponentsLayout = exports.enhanceComponentLayoutForRelations = exports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _Earth = _interopRequireDefault(require(\"@strapi/icons/Earth\"));\n\nvar _EarthStriked = _interopRequireDefault(require(\"@strapi/icons/EarthStriked\"));\n\nvar _LabelAction = _interopRequireDefault(require(\"../components/LabelAction\"));\n\nvar _utils = require(\"../utils\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar enhanceRelationLayout = function enhanceRelationLayout(layout, locale) {\n  return layout.map(function (current) {\n    var labelActionProps = {\n      title: {\n        id: (0, _utils.getTrad)('Field.localized'),\n        defaultMessage: 'This value is unique for the selected locale'\n      },\n      icon: /*#__PURE__*/_react[\"default\"].createElement(_Earth[\"default\"], {\n        \"aria-hidden\": true\n      })\n    };\n    var queryInfos = current.queryInfos;\n\n    if ((0, _get[\"default\"])(current, ['targetModelPluginOptions', 'i18n', 'localized'], false)) {\n      queryInfos = _objectSpread(_objectSpread({}, queryInfos), {}, {\n        defaultParams: _objectSpread(_objectSpread({}, queryInfos.defaultParams), {}, {\n          locale: locale\n        }),\n        paramsToKeep: ['plugins.i18n.locale']\n      });\n    }\n\n    return _objectSpread(_objectSpread({}, current), {}, {\n      labelAction: /*#__PURE__*/_react[\"default\"].createElement(_LabelAction[\"default\"], labelActionProps),\n      queryInfos: queryInfos\n    });\n  });\n};\n\nexports.enhanceRelationLayout = enhanceRelationLayout;\n\nvar enhanceEditLayout = function enhanceEditLayout(layout) {\n  return layout.map(function (row) {\n    var enhancedRow = row.reduce(function (acc, field) {\n      var type = (0, _get[\"default\"])(field, ['fieldSchema', 'type'], null);\n      var hasI18nEnabled = (0, _get[\"default\"])(field, ['fieldSchema', 'pluginOptions', 'i18n', 'localized'], type === 'uid');\n      var labelActionProps = {\n        title: {\n          id: hasI18nEnabled ? (0, _utils.getTrad)('Field.localized') : (0, _utils.getTrad)('Field.not-localized'),\n          defaultMessage: hasI18nEnabled ? 'This value is unique for the selected locale' : 'This value is common to all locales'\n        },\n        icon: hasI18nEnabled ? /*#__PURE__*/_react[\"default\"].createElement(_Earth[\"default\"], {\n          \"aria-hidden\": true\n        }) : /*#__PURE__*/_react[\"default\"].createElement(_EarthStriked[\"default\"], {\n          \"aria-hidden\": true\n        })\n      };\n      acc.push(_objectSpread(_objectSpread({}, field), {}, {\n        labelAction: /*#__PURE__*/_react[\"default\"].createElement(_LabelAction[\"default\"], labelActionProps)\n      }));\n      return acc;\n    }, []);\n    return enhancedRow;\n  });\n};\n\nexports.enhanceEditLayout = enhanceEditLayout;\n\nvar enhanceComponentsLayout = function enhanceComponentsLayout(components, locale) {\n  return Object.keys(components).reduce(function (acc, current) {\n    var currentComponentLayout = components[current];\n    var enhancedEditLayout = enhanceComponentLayoutForRelations(currentComponentLayout.layouts.edit, locale);\n    acc[current] = _objectSpread(_objectSpread({}, currentComponentLayout), {}, {\n      layouts: _objectSpread(_objectSpread({}, currentComponentLayout.layouts), {}, {\n        edit: enhancedEditLayout\n      })\n    });\n    return acc;\n  }, {});\n};\n\nexports.enhanceComponentsLayout = enhanceComponentsLayout;\n\nvar enhanceComponentLayoutForRelations = function enhanceComponentLayoutForRelations(layout, locale) {\n  return layout.map(function (row) {\n    var enhancedRow = row.reduce(function (acc, field) {\n      if ((0, _get[\"default\"])(field, ['fieldSchema', 'type']) === 'relation' && (0, _get[\"default\"])(field, ['targetModelPluginOptions', 'i18n', 'localized'], false)) {\n        var queryInfos = _objectSpread(_objectSpread({}, field.queryInfos), {}, {\n          defaultParams: _objectSpread(_objectSpread({}, field.queryInfos.defaultParams), {}, {\n            locale: locale\n          }),\n          paramsToKeep: ['plugins.i18n.locale']\n        });\n\n        acc.push(_objectSpread(_objectSpread({}, field), {}, {\n          queryInfos: queryInfos\n        }));\n        return acc;\n      }\n\n      acc.push(_objectSpread({}, field));\n      return acc;\n    }, []);\n    return enhancedRow;\n  });\n};\n\nexports.enhanceComponentLayoutForRelations = enhanceComponentLayoutForRelations;\n\nvar getPathToContentType = function getPathToContentType(pathArray) {\n  return ['contentType'].concat((0, _toConsumableArray2[\"default\"])(pathArray));\n};\n\nvar mutateEditViewLayoutHook = function mutateEditViewLayoutHook(_ref) {\n  var layout = _ref.layout,\n      query = _ref.query;\n  var hasI18nEnabled = (0, _get[\"default\"])(layout, getPathToContentType(['pluginOptions', 'i18n', 'localized']), false);\n\n  if (!hasI18nEnabled) {\n    return {\n      layout: layout,\n      query: query\n    };\n  }\n\n  var currentLocale = (0, _get[\"default\"])(query, ['plugins', 'i18n', 'locale'], null); // This might break the cm, has the user might be redirected to the homepage\n\n  if (!currentLocale) {\n    return {\n      layout: layout,\n      query: query\n    };\n  }\n\n  var editLayoutPath = getPathToContentType(['layouts', 'edit']);\n  var editRelationsPath = getPathToContentType(['layouts', 'editRelations']);\n  var editLayout = (0, _get[\"default\"])(layout, editLayoutPath);\n  var editRelationsLayout = (0, _get[\"default\"])(layout, editRelationsPath);\n  var nextEditRelationLayout = enhanceRelationLayout(editRelationsLayout, currentLocale);\n  var nextEditLayout = enhanceEditLayout(editLayout);\n\n  var enhancedLayouts = _objectSpread(_objectSpread({}, layout.contentType.layouts), {}, {\n    editRelations: nextEditRelationLayout,\n    edit: nextEditLayout\n  });\n\n  var components = enhanceComponentsLayout(layout.components, currentLocale);\n  var enhancedData = {\n    query: query,\n    layout: _objectSpread(_objectSpread({}, layout), {}, {\n      contentType: _objectSpread(_objectSpread({}, layout.contentType), {}, {\n        layouts: enhancedLayouts\n      }),\n      components: components\n    })\n  };\n  return enhancedData;\n};\n\nvar _default = mutateEditViewLayoutHook;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}