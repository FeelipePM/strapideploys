{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.EditView = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Divider = require(\"@strapi/design-system/Divider\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _LinkButton = require(\"@strapi/design-system/LinkButton\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _Layer = _interopRequireDefault(require(\"@strapi/icons/Layer\"));\n\nvar _Pencil = _interopRequireDefault(require(\"@strapi/icons/Pencil\"));\n\nvar _components = require(\"../../../shared/components\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../permissions\"));\n\nvar _DynamicZone = _interopRequireDefault(require(\"../../components/DynamicZone\"));\n\nvar _FieldComponent = _interopRequireDefault(require(\"../../components/FieldComponent\"));\n\nvar _Inputs = _interopRequireDefault(require(\"../../components/Inputs\"));\n\nvar _SelectWrapper = _interopRequireDefault(require(\"../../components/SelectWrapper\"));\n\nvar _CollectionTypeFormWrapper = _interopRequireDefault(require(\"../../components/CollectionTypeFormWrapper\"));\n\nvar _EditViewDataManagerProvider = _interopRequireDefault(require(\"../../components/EditViewDataManagerProvider\"));\n\nvar _SingleTypeFormWrapper = _interopRequireDefault(require(\"../../components/SingleTypeFormWrapper\"));\n\nvar _utils = require(\"../../utils\");\n\nvar _DraftAndPublishBadge = _interopRequireDefault(require(\"./DraftAndPublishBadge\"));\n\nvar _Informations = _interopRequireDefault(require(\"./Informations\"));\n\nvar _Header = _interopRequireDefault(require(\"./Header\"));\n\nvar _utils2 = require(\"./utils\");\n\nvar _DeleteLink = _interopRequireDefault(require(\"./DeleteLink\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n// import Container from '../../components/Container';\n// import FormWrapper from '../../components/FormWrapper';\nvar cmPermissions = _permissions[\"default\"].contentManager;\nvar ctbPermissions = [{\n  action: 'plugin::content-type-builder.read',\n  subject: null\n}];\n/* eslint-disable  react/no-array-index-key */\n\nvar EditView = function EditView(_ref) {\n  var allowedActions = _ref.allowedActions,\n      isSingleType = _ref.isSingleType,\n      goBack = _ref.goBack,\n      layout = _ref.layout,\n      slug = _ref.slug,\n      id = _ref.id,\n      origin = _ref.origin,\n      userPermissions = _ref.userPermissions;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useMemo = (0, _react.useMemo)(function () {\n    return (0, _utils2.getFieldsActionMatchingPermissions)(userPermissions, slug);\n  }, [userPermissions, slug]),\n      createActionAllowedFields = _useMemo.createActionAllowedFields,\n      readActionAllowedFields = _useMemo.readActionAllowedFields,\n      updateActionAllowedFields = _useMemo.updateActionAllowedFields;\n\n  var configurationPermissions = (0, _react.useMemo)(function () {\n    return isSingleType ? cmPermissions.singleTypesConfigurations : cmPermissions.collectionTypesConfigurations;\n  }, [isSingleType]); // // FIXME when changing the routing\n\n  var configurationsURL = \"/content-manager/\".concat(isSingleType ? 'singleType' : 'collectionType', \"/\").concat(slug, \"/configurations/edit\");\n  var currentContentTypeLayoutData = (0, _get[\"default\"])(layout, ['contentType'], {});\n  var DataManagementWrapper = (0, _react.useMemo)(function () {\n    return isSingleType ? _SingleTypeFormWrapper[\"default\"] : _CollectionTypeFormWrapper[\"default\"];\n  }, [isSingleType]); // Check if a block is a dynamic zone\n\n  var isDynamicZone = (0, _react.useCallback)(function (block) {\n    return block.every(function (subBlock) {\n      return subBlock.every(function (obj) {\n        return obj.fieldSchema.type === 'dynamiczone';\n      });\n    });\n  }, []);\n  var formattedContentTypeLayout = (0, _react.useMemo)(function () {\n    if (!currentContentTypeLayoutData.layouts) {\n      return [];\n    }\n\n    return (0, _utils2.createAttributesLayout)(currentContentTypeLayoutData.layouts.edit, currentContentTypeLayoutData.attributes);\n  }, [currentContentTypeLayoutData]);\n  var relationsLayout = currentContentTypeLayoutData.layouts.editRelations;\n  var displayedRelationsLength = relationsLayout.length;\n  return /*#__PURE__*/_react[\"default\"].createElement(DataManagementWrapper, {\n    allLayoutData: layout,\n    slug: slug,\n    id: id,\n    origin: origin\n  }, function (_ref2) {\n    var componentsDataStructure = _ref2.componentsDataStructure,\n        contentTypeDataStructure = _ref2.contentTypeDataStructure,\n        data = _ref2.data,\n        isCreatingEntry = _ref2.isCreatingEntry,\n        isLoadingForData = _ref2.isLoadingForData,\n        onDelete = _ref2.onDelete,\n        onDeleteSucceeded = _ref2.onDeleteSucceeded,\n        onPost = _ref2.onPost,\n        onPublish = _ref2.onPublish,\n        onPut = _ref2.onPut,\n        onUnpublish = _ref2.onUnpublish,\n        redirectionLink = _ref2.redirectionLink,\n        status = _ref2.status;\n    return /*#__PURE__*/_react[\"default\"].createElement(_EditViewDataManagerProvider[\"default\"], {\n      allowedActions: allowedActions,\n      allLayoutData: layout,\n      createActionAllowedFields: createActionAllowedFields,\n      componentsDataStructure: componentsDataStructure,\n      contentTypeDataStructure: contentTypeDataStructure,\n      from: redirectionLink,\n      initialValues: data,\n      isCreatingEntry: isCreatingEntry,\n      isLoadingForData: isLoadingForData,\n      isSingleType: isSingleType,\n      onPost: onPost,\n      onPublish: onPublish,\n      onPut: onPut,\n      onUnpublish: onUnpublish,\n      readActionAllowedFields: readActionAllowedFields,\n      redirectToPreviousPage: goBack,\n      slug: slug,\n      status: status,\n      updateActionAllowedFields: updateActionAllowedFields\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, {\n      \"aria-busy\": status !== 'resolved'\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Header[\"default\"], {\n      allowedActions: allowedActions\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n      gap: 4\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 9,\n      s: 12\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 6\n    }, formattedContentTypeLayout.map(function (row, index) {\n      if (isDynamicZone(row)) {\n        var _row$0$ = row[0][0],\n            name = _row$0$.name,\n            fieldSchema = _row$0$.fieldSchema,\n            metadatas = _row$0$.metadatas,\n            labelAction = _row$0$.labelAction;\n        return /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n          key: index\n        }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n          gap: 4\n        }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n          col: 12,\n          s: 12,\n          xs: 12\n        }, /*#__PURE__*/_react[\"default\"].createElement(_DynamicZone[\"default\"], {\n          name: name,\n          fieldSchema: fieldSchema,\n          labelAction: labelAction,\n          metadatas: metadatas\n        }))));\n      }\n\n      return /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n        key: index,\n        hasRadius: true,\n        background: \"neutral0\",\n        shadow: \"tableShadow\",\n        paddingLeft: 6,\n        paddingRight: 6,\n        paddingTop: 6,\n        paddingBottom: 6,\n        borderColor: \"neutral150\"\n      }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n        spacing: 6\n      }, row.map(function (grid, gridIndex) {\n        return /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n          gap: 4,\n          key: gridIndex\n        }, grid.map(function (_ref3) {\n          var fieldSchema = _ref3.fieldSchema,\n              labelAction = _ref3.labelAction,\n              metadatas = _ref3.metadatas,\n              name = _ref3.name,\n              size = _ref3.size;\n          var isComponent = fieldSchema.type === 'component';\n\n          if (isComponent) {\n            var component = fieldSchema.component,\n                max = fieldSchema.max,\n                min = fieldSchema.min,\n                _fieldSchema$repeatab = fieldSchema.repeatable,\n                repeatable = _fieldSchema$repeatab === void 0 ? false : _fieldSchema$repeatab,\n                _fieldSchema$required = fieldSchema.required,\n                required = _fieldSchema$required === void 0 ? false : _fieldSchema$required;\n            return /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n              col: size,\n              s: 12,\n              xs: 12,\n              key: component\n            }, /*#__PURE__*/_react[\"default\"].createElement(_FieldComponent[\"default\"], {\n              componentUid: component,\n              labelAction: labelAction,\n              isRepeatable: repeatable,\n              intlLabel: {\n                id: metadatas.label,\n                defaultMessage: metadatas.label\n              },\n              max: max,\n              min: min,\n              name: name,\n              required: required\n            }));\n          }\n\n          return /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n            col: size,\n            key: name,\n            s: 12,\n            xs: 12\n          }, /*#__PURE__*/_react[\"default\"].createElement(_Inputs[\"default\"], {\n            fieldSchema: fieldSchema,\n            keys: name,\n            labelAction: labelAction,\n            metadatas: metadatas\n          }));\n        }));\n      })));\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 3,\n      s: 12\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 2\n    }, /*#__PURE__*/_react[\"default\"].createElement(_DraftAndPublishBadge[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      as: \"aside\",\n      \"aria-labelledby\": \"additional-informations\",\n      background: \"neutral0\",\n      borderColor: \"neutral150\",\n      hasRadius: true,\n      paddingBottom: 4,\n      paddingLeft: 4,\n      paddingRight: 4,\n      paddingTop: 6,\n      shadow: \"tableShadow\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Informations[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(_components.InjectionZone, {\n      area: \"contentManager.editView.informations\"\n    })), displayedRelationsLength > 0 && /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      as: \"aside\",\n      \"aria-labelledby\": \"relations-title\",\n      background: \"neutral0\",\n      borderColor: \"neutral150\",\n      hasRadius: true,\n      paddingBottom: 4,\n      paddingLeft: 4,\n      paddingRight: 4,\n      paddingTop: 6,\n      shadow: \"tableShadow\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n      variant: \"sigma\",\n      textColor: \"neutral600\",\n      id: \"relations-title\"\n    }, formatMessage({\n      id: (0, _utils.getTrad)('containers.Edit.relations'),\n      defaultMessage: '{number, plural, =0 {relations} one {relation} other {relations}}'\n    }, {\n      number: displayedRelationsLength\n    })), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingTop: 2,\n      paddingBottom: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Divider.Divider, null)), /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 4\n    }, relationsLayout.map(function (_ref4) {\n      var name = _ref4.name,\n          fieldSchema = _ref4.fieldSchema,\n          labelAction = _ref4.labelAction,\n          metadatas = _ref4.metadatas,\n          queryInfos = _ref4.queryInfos;\n      return /*#__PURE__*/_react[\"default\"].createElement(_SelectWrapper[\"default\"], (0, _extends2[\"default\"])({}, fieldSchema, metadatas, {\n        key: name,\n        description: metadatas.description,\n        intlLabel: {\n          id: metadatas.label,\n          defaultMessage: metadatas.label\n        },\n        labelAction: labelAction,\n        name: name,\n        relationsType: fieldSchema.relationType,\n        queryInfos: queryInfos,\n        placeholder: metadatas.placeholder ? {\n          id: metadatas.placeholder,\n          defaultMessage: metadatas.placeholder\n        } : null\n      }));\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      as: \"aside\",\n      \"aria-labelledby\": \"links\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 2\n    }, /*#__PURE__*/_react[\"default\"].createElement(_components.InjectionZone, {\n      area: \"contentManager.editView.right-links\",\n      slug: slug\n    }), slug !== 'strapi::administrator' && /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPermissions, {\n      permissions: ctbPermissions\n    }, /*#__PURE__*/_react[\"default\"].createElement(_LinkButton.LinkButton, {\n      onClick: function onClick() {\n        trackUsage('willEditEditLayout');\n      },\n      size: \"S\",\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Pencil[\"default\"], null),\n      style: {\n        width: '100%'\n      },\n      to: \"/plugins/content-type-builder/content-types/\".concat(slug),\n      variant: \"secondary\"\n    }, formatMessage({\n      id: (0, _utils.getTrad)('link-to-ctb'),\n      defaultMessage: 'Edit the model'\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPermissions, {\n      permissions: configurationPermissions\n    }, /*#__PURE__*/_react[\"default\"].createElement(_LinkButton.LinkButton, {\n      size: \"S\",\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Layer[\"default\"], null),\n      style: {\n        width: '100%'\n      },\n      to: configurationsURL,\n      variant: \"secondary\"\n    }, formatMessage({\n      id: 'app.links.configure-view',\n      defaultMessage: 'Configure the view'\n    }))), allowedActions.canDelete && /*#__PURE__*/_react[\"default\"].createElement(_DeleteLink[\"default\"], {\n      isCreatingEntry: isCreatingEntry,\n      onDelete: onDelete,\n      onDeleteSucceeded: onDeleteSucceeded\n    })))))))));\n  });\n};\n\nexports.EditView = EditView;\nEditView.defaultProps = {\n  id: null,\n  isSingleType: false,\n  origin: null,\n  userPermissions: []\n};\nEditView.propTypes = {\n  allowedActions: _propTypes[\"default\"].shape({\n    canRead: _propTypes[\"default\"].bool.isRequired,\n    canUpdate: _propTypes[\"default\"].bool.isRequired,\n    canCreate: _propTypes[\"default\"].bool.isRequired,\n    canDelete: _propTypes[\"default\"].bool.isRequired\n  }).isRequired,\n  layout: _propTypes[\"default\"].shape({\n    components: _propTypes[\"default\"].object.isRequired,\n    contentType: _propTypes[\"default\"].shape({\n      uid: _propTypes[\"default\"].string.isRequired,\n      settings: _propTypes[\"default\"].object.isRequired,\n      metadatas: _propTypes[\"default\"].object.isRequired,\n      options: _propTypes[\"default\"].object.isRequired,\n      attributes: _propTypes[\"default\"].object.isRequired\n    }).isRequired\n  }).isRequired,\n  id: _propTypes[\"default\"].string,\n  isSingleType: _propTypes[\"default\"].bool,\n  goBack: _propTypes[\"default\"].func.isRequired,\n  origin: _propTypes[\"default\"].string,\n  slug: _propTypes[\"default\"].string.isRequired,\n  userPermissions: _propTypes[\"default\"].array\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(EditView); // export default () => 'TODO Edit view';\n\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}