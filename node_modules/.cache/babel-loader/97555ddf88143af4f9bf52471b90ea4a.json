{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.SingleSignOn = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Check = _interopRequireDefault(require(\"@strapi/icons/Check\"));\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _Typography = require(\"@strapi/design-system/Typography\");\n\nvar _ToggleInput = require(\"@strapi/design-system/ToggleInput\");\n\nvar _Select = require(\"@strapi/design-system/Select\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _isEqual = _interopRequireDefault(require(\"lodash/isEqual\"));\n\nvar _utils = require(\"../../../../../admin/src/utils\");\n\nvar _hooks = require(\"../../../../../admin/src/hooks\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../../../admin/src/permissions\"));\n\nvar _schema = _interopRequireDefault(require(\"./utils/schema\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar ssoPermissions = _objectSpread(_objectSpread({}, _permissions[\"default\"].settings.sso), {}, {\n  readRoles: _permissions[\"default\"].settings.roles.read\n});\n\nvar SingleSignOn = function SingleSignOn() {\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useRBAC = (0, _helperPlugin.useRBAC)(ssoPermissions),\n      isLoadingForPermissions = _useRBAC.isLoading,\n      _useRBAC$allowedActio = _useRBAC.allowedActions,\n      canUpdate = _useRBAC$allowedActio.canUpdate,\n      canReadRoles = _useRBAC$allowedActio.canReadRoles;\n\n  var _useSettingsForm = (0, _hooks.useSettingsForm)((0, _utils.getRequestUrl)('providers/options'), _schema[\"default\"], function () {}, ['autoRegister', 'defaultRole']),\n      _useSettingsForm2 = (0, _slicedToArray2[\"default\"])(_useSettingsForm, 3),\n      _useSettingsForm2$ = _useSettingsForm2[0],\n      formErrors = _useSettingsForm2$.formErrors,\n      initialData = _useSettingsForm2$.initialData,\n      isLoading = _useSettingsForm2$.isLoading,\n      modifiedData = _useSettingsForm2$.modifiedData,\n      showHeaderButtonLoader = _useSettingsForm2$.showHeaderButtonLoader,\n      // eslint-disable-next-line no-unused-vars\n  dispatch = _useSettingsForm2[1],\n      _useSettingsForm2$2 = _useSettingsForm2[2],\n      handleChange = _useSettingsForm2$2.handleChange,\n      handleSubmit = _useSettingsForm2$2.handleSubmit;\n\n  var _useRolesList = (0, _hooks.useRolesList)(canReadRoles),\n      roles = _useRolesList.roles;\n\n  (0, _helperPlugin.useFocusWhenNavigate)();\n  var showLoader = isLoadingForPermissions || isLoading;\n  (0, _react.useEffect)(function () {\n    if (formErrors.defaultRole) {\n      var selector = \"[name=\\\"defaultRole\\\"]\";\n      document.querySelector(selector).focus();\n    }\n  }, [formErrors]);\n  var isHeaderButtonDisabled = (0, _isEqual[\"default\"])(initialData, modifiedData);\n  return /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SettingsPageTitle, {\n    name: \"SSO\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, {\n    tabIndex: -1\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: function onSubmit(e) {\n      if (isHeaderButtonDisabled) {\n        e.preventDefault();\n        return;\n      }\n\n      handleSubmit(e);\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n    primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n      \"data-testid\": \"save-button\",\n      disabled: isHeaderButtonDisabled,\n      loading: showHeaderButtonLoader,\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Check[\"default\"], null),\n      type: \"submit\",\n      size: \"L\"\n    }, formatMessage({\n      id: 'app.components.Button.save',\n      defaultMessage: 'Save'\n    })),\n    title: formatMessage({\n      id: 'Settings.sso.title',\n      defaultMessage: 'Single Sign-On'\n    }),\n    subtitle: formatMessage({\n      id: 'Settings.sso.description',\n      defaultMessage: 'Configure the settings for the Single Sign-On feature.'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, showLoader ? /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null) : /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n    spacing: 4,\n    background: \"neutral0\",\n    padding: 6,\n    shadow: \"filterShadow\",\n    hasRadius: true\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Typography.Typography, {\n    variant: \"delta\",\n    as: \"h2\"\n  }, formatMessage({\n    id: 'Settings.sso.form.settings.title',\n    defaultMessage: 'Settings'\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n    gap: 4\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n    col: 6,\n    m: 6,\n    s: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ToggleInput.ToggleInput, {\n    \"aria-label\": \"autoRegister\",\n    \"data-testid\": \"autoRegister\",\n    disabled: !canUpdate,\n    checked: modifiedData.autoRegister,\n    hint: formatMessage({\n      id: 'Settings.sso.form.registration.description',\n      defaultMessage: 'Create new user on SSO login if no account exists'\n    }),\n    label: formatMessage({\n      id: 'Settings.sso.form.registration.label',\n      defaultMessage: 'Auto-registration'\n    }),\n    name: \"autoRegister\",\n    offLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.off-label',\n      defaultMessage: 'Off'\n    }),\n    onLabel: formatMessage({\n      id: 'app.components.ToggleCheckbox.on-label',\n      defaultMessage: 'On'\n    }),\n    onChange: function onChange(e) {\n      handleChange({\n        target: {\n          name: 'autoRegister',\n          value: e.target.checked\n        }\n      });\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n    col: 6,\n    m: 6,\n    s: 12\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Select.Select, {\n    disabled: !canUpdate,\n    hint: formatMessage({\n      id: 'Settings.sso.form.defaultRole.description',\n      defaultMessage: 'It will attach the new authenticated user to the selected role'\n    }),\n    error: formErrors.defaultRole ? formatMessage({\n      id: formErrors.defaultRole.id,\n      defaultMessage: formErrors.defaultRole.id\n    }) : '',\n    label: formatMessage({\n      id: 'Settings.sso.form.defaultRole.label',\n      defaultMessage: 'Default role'\n    }),\n    name: \"defaultRole\",\n    onChange: function onChange(value) {\n      handleChange({\n        target: {\n          name: 'defaultRole',\n          value: value\n        }\n      });\n    },\n    placeholder: formatMessage({\n      id: 'components.InputSelect.option.placeholder',\n      defaultMessage: 'Choose here'\n    }),\n    value: modifiedData.defaultRole\n  }, roles.map(function (_ref) {\n    var id = _ref.id,\n        name = _ref.name;\n    return /*#__PURE__*/_react[\"default\"].createElement(_Select.Option, {\n      key: id,\n      value: id.toString()\n    }, name);\n  })))))))));\n};\n\nexports.SingleSignOn = SingleSignOn;\n\nvar ProtectedSSO = function ProtectedSSO() {\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: ssoPermissions.main\n  }, /*#__PURE__*/_react[\"default\"].createElement(SingleSignOn, null));\n};\n\nvar _default = ProtectedSSO;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}