{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useEditAsset = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _react = require(\"react\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _utils = require(\"../utils\");\n\nvar _pluginId = _interopRequireDefault(require(\"../pluginId\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar editAssetRequest = function editAssetRequest(asset, file, cancelToken, onProgress) {\n  var endpoint = \"/\".concat(_pluginId[\"default\"], \"?id=\").concat(asset.id);\n  var formData = new FormData();\n\n  if (file) {\n    formData.append('files', file);\n  }\n\n  formData.append('fileInfo', JSON.stringify({\n    alternativeText: asset.alternativeText,\n    caption: asset.caption,\n    name: asset.name\n  }));\n  return (0, _utils.axiosInstance)({\n    method: 'post',\n    url: endpoint,\n    data: formData,\n    cancelToken: cancelToken.token,\n    onUploadProgress: function onUploadProgress(_ref) {\n      var total = _ref.total,\n          loaded = _ref.loaded;\n      onProgress(loaded / total * 100);\n    }\n  }).then(function (res) {\n    return res.data;\n  });\n};\n\nvar useEditAsset = function useEditAsset() {\n  var _useState = (0, _react.useState)(0),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      progress = _useState2[0],\n      setProgress = _useState2[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n  var queryClient = (0, _reactQuery.useQueryClient)();\n  var tokenRef = (0, _react.useRef)(_axios[\"default\"].CancelToken.source());\n  var mutation = (0, _reactQuery.useMutation)(function (_ref2) {\n    var asset = _ref2.asset,\n        file = _ref2.file;\n    return editAssetRequest(asset, file, tokenRef.current, setProgress);\n  }, {\n    onSuccess: function onSuccess() {\n      queryClient.refetchQueries(['assets'], {\n        active: true\n      });\n      queryClient.refetchQueries(['asset-count'], {\n        active: true\n      });\n    },\n    onError: function onError(reason) {\n      if (reason.response.status === 403) {\n        toggleNotification({\n          type: 'info',\n          message: {\n            id: (0, _utils.getTrad)('permissions.not-allowed.update')\n          }\n        });\n      } else {\n        toggleNotification({\n          type: 'warning',\n          message: reason.message\n        });\n      }\n    }\n  });\n\n  var editAsset = function editAsset(asset, file) {\n    return mutation.mutateAsync({\n      asset: asset,\n      file: file\n    });\n  };\n\n  var cancel = function cancel() {\n    return tokenRef.current.cancel(formatMessage({\n      id: (0, _utils.getTrad)('modal.upload.cancelled'),\n      defaultMessage: ''\n    }));\n  };\n\n  return _objectSpread(_objectSpread({}, mutation), {}, {\n    cancel: cancel,\n    editAsset: editAsset,\n    progress: progress,\n    status: mutation.status\n  });\n};\n\nexports.useEditAsset = useEditAsset;","map":null,"metadata":{},"sourceType":"script"}