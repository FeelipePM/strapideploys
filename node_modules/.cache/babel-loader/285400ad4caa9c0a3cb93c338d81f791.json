{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = require(\"react\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _isEmpty = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _sortBy = _interopRequireDefault(require(\"lodash/sortBy\"));\n\nvar _toLower = _interopRequireDefault(require(\"lodash/toLower\"));\n\nvar _isEqual = _interopRequireDefault(require(\"lodash/isEqual\"));\n\nvar _matchSorter = _interopRequireDefault(require(\"match-sorter\"));\n\nvar _useDataManager2 = _interopRequireDefault(require(\"../../hooks/useDataManager\"));\n\nvar _useFormModalNavigation = _interopRequireDefault(require(\"../../hooks/useFormModalNavigation\"));\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar useContentTypeBuilderMenu = function useContentTypeBuilderMenu() {\n  var _useDataManager = (0, _useDataManager2[\"default\"])(),\n      components = _useDataManager.components,\n      componentsGroupedByCategory = _useDataManager.componentsGroupedByCategory,\n      contentTypes = _useDataManager.contentTypes,\n      isInDevelopmentMode = _useDataManager.isInDevelopmentMode,\n      sortedContentTypesList = _useDataManager.sortedContentTypesList,\n      modifiedData = _useDataManager.modifiedData,\n      initialData = _useDataManager.initialData;\n\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useState = (0, _react.useState)(''),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      search = _useState2[0],\n      setSearch = _useState2[1];\n\n  var _useFormModalNavigati = (0, _useFormModalNavigation[\"default\"])(),\n      onOpenModalCreateSchema = _useFormModalNavigati.onOpenModalCreateSchema,\n      onOpenModalEditCategory = _useFormModalNavigati.onOpenModalEditCategory;\n\n  var componentsData = (0, _sortBy[\"default\"])(Object.keys(componentsGroupedByCategory).map(function (category) {\n    return {\n      name: category,\n      title: category,\n      isEditable: isInDevelopmentMode,\n      onClickEdit: function onClickEdit(e, data) {\n        e.stopPropagation();\n\n        if (canOpenModalCreateCTorComponent) {\n          onOpenModalEditCategory(data.name);\n        } else {\n          toggleNotificationCannotCreateSchema();\n        }\n      },\n      links: (0, _sortBy[\"default\"])(componentsGroupedByCategory[category].map(function (compo) {\n        return {\n          name: compo.uid,\n          to: \"/plugins/\".concat(_pluginId[\"default\"], \"/component-categories/\").concat(category, \"/\").concat(compo.uid),\n          title: compo.schema.displayName\n        };\n      }), function (obj) {\n        return obj.title;\n      })\n    };\n  }), function (obj) {\n    return obj.title;\n  });\n  var canOpenModalCreateCTorComponent = !Object.keys(contentTypes).some(function (ct) {\n    return contentTypes[ct].isTemporary === true;\n  }) && !Object.keys(components).some(function (component) {\n    return components[component].isTemporary === true;\n  }) && (0, _isEqual[\"default\"])(modifiedData, initialData);\n\n  var handleClickOpenModalCreateCollectionType = function handleClickOpenModalCreateCollectionType() {\n    if (canOpenModalCreateCTorComponent) {\n      trackUsage(\"willCreateContentType\");\n      var nextState = {\n        modalType: 'contentType',\n        kind: 'collectionType',\n        actionType: 'create',\n        forTarget: 'contentType'\n      };\n      onOpenModalCreateSchema(nextState);\n    } else {\n      toggleNotificationCannotCreateSchema();\n    }\n  };\n\n  var handleClickOpenModalCreateSingleType = function handleClickOpenModalCreateSingleType() {\n    if (canOpenModalCreateCTorComponent) {\n      trackUsage(\"willCreateSingleType\");\n      var nextState = {\n        modalType: 'contentType',\n        kind: 'singleType',\n        actionType: 'create',\n        forTarget: 'contentType'\n      };\n      onOpenModalCreateSchema(nextState);\n    } else {\n      toggleNotificationCannotCreateSchema();\n    }\n  };\n\n  var handleClickOpenModalCreateComponent = function handleClickOpenModalCreateComponent() {\n    if (canOpenModalCreateCTorComponent) {\n      trackUsage('willCreateComponent');\n      var nextState = {\n        modalType: 'component',\n        kind: null,\n        actionType: 'create',\n        forTarget: 'component'\n      };\n      onOpenModalCreateSchema(nextState);\n    } else {\n      toggleNotificationCannotCreateSchema();\n    }\n  };\n\n  var toggleNotificationCannotCreateSchema = function toggleNotificationCannotCreateSchema() {\n    toggleNotification({\n      type: 'info',\n      message: {\n        id: \"\".concat((0, _getTrad[\"default\"])('notification.info.creating.notSaved')),\n        defaultMessage: 'Please save your work before creating a new collection type or component'\n      }\n    });\n  };\n\n  var displayedContentTypes = sortedContentTypesList.filter(function (obj) {\n    return obj.visible;\n  });\n  var data = [{\n    name: 'models',\n    title: {\n      id: \"\".concat((0, _getTrad[\"default\"])('menu.section.models.name')),\n      defaultMessage: 'Collection Types'\n    },\n    customLink: isInDevelopmentMode && {\n      id: \"\".concat((0, _getTrad[\"default\"])('button.model.create')),\n      defaultMessage: 'Create new collection type',\n      onClick: handleClickOpenModalCreateCollectionType\n    },\n    links: displayedContentTypes.filter(function (contentType) {\n      return contentType.kind === 'collectionType';\n    })\n  }, {\n    name: 'singleTypes',\n    title: {\n      id: \"\".concat((0, _getTrad[\"default\"])('menu.section.single-types.name')),\n      defaultMessage: 'Single Types'\n    },\n    customLink: isInDevelopmentMode && {\n      id: \"\".concat((0, _getTrad[\"default\"])('button.single-types.create')),\n      defaultMessage: 'Create new single type',\n      onClick: handleClickOpenModalCreateSingleType\n    },\n    links: displayedContentTypes.filter(function (singleType) {\n      return singleType.kind === 'singleType';\n    })\n  }, {\n    name: 'components',\n    title: {\n      id: \"\".concat((0, _getTrad[\"default\"])('menu.section.components.name')),\n      defaultMessage: 'Components'\n    },\n    customLink: isInDevelopmentMode && {\n      id: \"\".concat((0, _getTrad[\"default\"])('button.component.create')),\n      defaultMessage: 'Create a new component',\n      onClick: handleClickOpenModalCreateComponent\n    },\n    links: componentsData\n  }];\n\n  var matchByTitle = function matchByTitle(links) {\n    return (0, _matchSorter[\"default\"])(links, (0, _toLower[\"default\"])(search), {\n      keys: [function (item) {\n        return (0, _toLower[\"default\"])(item.title);\n      }]\n    });\n  };\n\n  var getMenu = function getMenu() {\n    // Maybe we can do it simpler with matchsorter wildcards ?\n    return data.map(function (section) {\n      var hasChild = section.links.some(function (l) {\n        return !(0, _isEmpty[\"default\"])(l.links);\n      });\n\n      if (hasChild) {\n        return _objectSpread(_objectSpread({}, section), {}, {\n          links: section.links.map(function (l) {\n            return _objectSpread(_objectSpread({}, l), {}, {\n              links: matchByTitle(l.links)\n            });\n          })\n        });\n      }\n\n      return _objectSpread(_objectSpread({}, section), {}, {\n        links: matchByTitle(section.links)\n      });\n    });\n  };\n\n  return {\n    menu: getMenu(),\n    searchValue: search,\n    onSearchChange: setSearch\n  };\n};\n\nvar _default = useContentTypeBuilderMenu;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}