{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _omit = _interopRequireDefault(require(\"lodash/omit\"));\n\nvar _take = _interopRequireDefault(require(\"lodash/take\"));\n\nvar _reactFastCompare = _interopRequireDefault(require(\"react-fast-compare\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"../../utils\");\n\nvar _Wysiwyg = _interopRequireDefault(require(\"../Wysiwyg\"));\n\nvar _InputJSON = _interopRequireDefault(require(\"../InputJSON\"));\n\nvar _InputUID = _interopRequireDefault(require(\"../InputUID\"));\n\nvar _SelectWrapper = _interopRequireDefault(require(\"../SelectWrapper\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction Inputs(_ref) {\n  var allowedFields = _ref.allowedFields,\n      fieldSchema = _ref.fieldSchema,\n      formErrors = _ref.formErrors,\n      isCreatingEntry = _ref.isCreatingEntry,\n      keys = _ref.keys,\n      labelAction = _ref.labelAction,\n      metadatas = _ref.metadatas,\n      onChange = _ref.onChange,\n      readableFields = _ref.readableFields,\n      shouldNotRunValidations = _ref.shouldNotRunValidations,\n      queryInfos = _ref.queryInfos,\n      value = _ref.value;\n\n  var _useLibrary = (0, _helperPlugin.useLibrary)(),\n      fields = _useLibrary.fields;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useContentTypeLayout = (0, _hooks.useContentTypeLayout)(),\n      currentContentTypeLayout = _useContentTypeLayout.contentType;\n\n  var disabled = (0, _react.useMemo)(function () {\n    return !(0, _get[\"default\"])(metadatas, 'editable', true);\n  }, [metadatas]);\n  var type = fieldSchema.type;\n  var errorId = (0, _react.useMemo)(function () {\n    return (0, _get[\"default\"])(formErrors, [keys, 'id'], null);\n  }, [formErrors, keys]);\n  var fieldName = (0, _react.useMemo)(function () {\n    return (0, _utils.getFieldName)(keys);\n  }, [keys]);\n  var validations = (0, _react.useMemo)(function () {\n    var inputValidations = (0, _omit[\"default\"])(fieldSchema, shouldNotRunValidations ? [].concat((0, _toConsumableArray2[\"default\"])(_utils2.VALIDATIONS_TO_OMIT), ['required', 'minLength']) : _utils2.VALIDATIONS_TO_OMIT);\n    var regexpString = fieldSchema.regex || null;\n\n    if (regexpString) {\n      var regexp = new RegExp(regexpString);\n\n      if (regexp) {\n        inputValidations.regex = regexp;\n      }\n    }\n\n    return inputValidations;\n  }, [fieldSchema, shouldNotRunValidations]);\n  var isRequired = (0, _react.useMemo)(function () {\n    return (0, _get[\"default\"])(validations, ['required'], false);\n  }, [validations]);\n  var isChildOfDynamicZone = (0, _react.useMemo)(function () {\n    var attributes = (0, _get[\"default\"])(currentContentTypeLayout, ['attributes'], {});\n    var foundAttributeType = (0, _get[\"default\"])(attributes, [fieldName[0], 'type'], null);\n    return foundAttributeType === 'dynamiczone';\n  }, [currentContentTypeLayout, fieldName]);\n  var inputType = (0, _react.useMemo)(function () {\n    return (0, _utils2.getInputType)(type);\n  }, [type]);\n  var inputValue = (0, _react.useMemo)(function () {\n    // Fix for input file multipe\n    if (type === 'media' && !value) {\n      return [];\n    }\n\n    return value;\n  }, [type, value]);\n  var step = (0, _react.useMemo)(function () {\n    return (0, _utils2.getStep)(type);\n  }, [type]);\n  var isUserAllowedToEditField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (allowedFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return allowedFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _take[\"default\"])(fieldName, fieldName.length - 1).join('.');\n      return allowedFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [allowedFields, fieldName, isChildOfDynamicZone]);\n  var isUserAllowedToReadField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (readableFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return readableFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _take[\"default\"])(fieldName, fieldName.length - 1).join('.');\n      return readableFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [readableFields, fieldName, isChildOfDynamicZone]);\n  var shouldDisplayNotAllowedInput = (0, _react.useMemo)(function () {\n    return isUserAllowedToReadField || isUserAllowedToEditField;\n  }, [isUserAllowedToEditField, isUserAllowedToReadField]);\n  var shouldDisableField = (0, _react.useMemo)(function () {\n    if (!isCreatingEntry) {\n      var doesNotHaveRight = isUserAllowedToReadField && !isUserAllowedToEditField;\n\n      if (doesNotHaveRight) {\n        return true;\n      }\n\n      return disabled;\n    }\n\n    return disabled;\n  }, [disabled, isCreatingEntry, isUserAllowedToEditField, isUserAllowedToReadField]);\n  var options = (0, _react.useMemo)(function () {\n    return (0, _utils2.generateOptions)(fieldSchema[\"enum\"] || [], isRequired);\n  }, [fieldSchema, isRequired]);\n  var label = metadatas.label,\n      description = metadatas.description,\n      placeholder = metadatas.placeholder,\n      visible = metadatas.visible;\n\n  if (visible === false) {\n    return null;\n  }\n\n  if (!shouldDisplayNotAllowedInput) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.NotAllowedInput, {\n      description: description ? {\n        id: description,\n        defaultMessage: description\n      } : null,\n      intlLabel: {\n        id: label,\n        defaultMessage: label\n      },\n      labelAction: labelAction,\n      error: errorId,\n      name: keys,\n      required: isRequired\n    });\n  }\n\n  if (type === 'relation') {\n    return /*#__PURE__*/_react[\"default\"].createElement(_SelectWrapper[\"default\"], (0, _extends2[\"default\"])({}, metadatas, fieldSchema, {\n      description: metadatas.description ? formatMessage({\n        id: metadatas.description,\n        defaultMessage: metadatas.description\n      }) : undefined,\n      intlLabel: {\n        id: metadatas.label,\n        defaultMessage: metadatas.label\n      },\n      labelAction: labelAction,\n      isUserAllowedToEditField: isUserAllowedToEditField,\n      isUserAllowedToReadField: isUserAllowedToReadField,\n      name: keys,\n      placeholder: metadatas.placeholder ? {\n        id: metadatas.placeholder,\n        defaultMessage: metadatas.placeholder\n      } : null,\n      queryInfos: queryInfos,\n      value: value\n    }));\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.GenericInput, {\n    attribute: fieldSchema,\n    autoComplete: \"new-password\",\n    intlLabel: {\n      id: label,\n      defaultMessage: label\n    } // in case the default value of the boolean is null, attribute.default doesn't exist\n    ,\n    isNullable: inputType === 'bool' && [null, undefined].includes(fieldSchema[\"default\"]),\n    description: description ? {\n      id: description,\n      defaultMessage: description\n    } : null,\n    disabled: shouldDisableField,\n    error: errorId,\n    labelAction: labelAction,\n    contentTypeUID: currentContentTypeLayout.uid,\n    customInputs: _objectSpread({\n      json: _InputJSON[\"default\"],\n      uid: _InputUID[\"default\"],\n      media: fields.media,\n      wysiwyg: _Wysiwyg[\"default\"]\n    }, fields),\n    multiple: fieldSchema.multiple || false,\n    name: keys,\n    onChange: onChange,\n    options: options,\n    placeholder: placeholder ? {\n      id: placeholder,\n      defaultMessage: placeholder\n    } : null,\n    required: fieldSchema.required || false,\n    step: step,\n    type: inputType // validations={validations}\n    ,\n    value: inputValue,\n    withDefaultValue: false\n  });\n}\n\nInputs.defaultProps = {\n  formErrors: {},\n  labelAction: undefined,\n  queryInfos: {},\n  value: null\n};\nInputs.propTypes = {\n  allowedFields: _propTypes[\"default\"].array.isRequired,\n  fieldSchema: _propTypes[\"default\"].object.isRequired,\n  formErrors: _propTypes[\"default\"].object,\n  keys: _propTypes[\"default\"].string.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  labelAction: _propTypes[\"default\"].element,\n  metadatas: _propTypes[\"default\"].object.isRequired,\n  onChange: _propTypes[\"default\"].func.isRequired,\n  readableFields: _propTypes[\"default\"].array.isRequired,\n  shouldNotRunValidations: _propTypes[\"default\"].bool.isRequired,\n  queryInfos: _propTypes[\"default\"].shape({\n    containsKey: _propTypes[\"default\"].string,\n    defaultParams: _propTypes[\"default\"].object,\n    endPoint: _propTypes[\"default\"].string\n  }),\n  value: _propTypes[\"default\"].any\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(Inputs, _reactFastCompare[\"default\"]);\n\nvar _default = (0, _utils2.connect)(Memoized, _utils2.select);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}