{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Tabs = require(\"@strapi/design-system/Tabs\");\n\nvar _has = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _isEmpty = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _ContentTypes = _interopRequireDefault(require(\"../ContentTypes\"));\n\nvar _PermissionsDataManagerProvider = _interopRequireDefault(require(\"../PermissionsDataManagerProvider\"));\n\nvar _PluginsAndSettings = _interopRequireDefault(require(\"../PluginsAndSettings\"));\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _formatPermissionsToAPI = _interopRequireDefault(require(\"./utils/formatPermissionsToAPI\"));\n\nvar _tabLabels = _interopRequireDefault(require(\"./utils/tabLabels\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar Permissions = /*#__PURE__*/(0, _react.forwardRef)(function (_ref, ref) {\n  var layout = _ref.layout,\n      isFormDisabled = _ref.isFormDisabled,\n      permissions = _ref.permissions;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, function () {\n    return (0, _init[\"default\"])(layout, permissions);\n  }),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      initialData = _useReducer2$.initialData,\n      layouts = _useReducer2$.layouts,\n      modifiedData = _useReducer2$.modifiedData,\n      dispatch = _useReducer2[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  (0, _react.useImperativeHandle)(ref, function () {\n    return {\n      getPermissions: function getPermissions() {\n        var collectionTypesDiff = (0, _helperPlugin.difference)(initialData.collectionTypes, modifiedData.collectionTypes);\n        var singleTypesDiff = (0, _helperPlugin.difference)(initialData.singleTypes, modifiedData.singleTypes);\n\n        var contentTypesDiff = _objectSpread(_objectSpread({}, collectionTypesDiff), singleTypesDiff);\n\n        var didUpdateConditions;\n\n        if ((0, _isEmpty[\"default\"])(contentTypesDiff)) {\n          didUpdateConditions = false;\n        } else {\n          didUpdateConditions = Object.values(contentTypesDiff).some(function (permission) {\n            return Object.values(permission).some(function (permissionValue) {\n              return (0, _has[\"default\"])(permissionValue, 'conditions');\n            });\n          });\n        }\n\n        return {\n          permissionsToSend: (0, _formatPermissionsToAPI[\"default\"])(modifiedData),\n          didUpdateConditions: didUpdateConditions\n        };\n      },\n      resetForm: function resetForm() {\n        dispatch({\n          type: 'RESET_FORM'\n        });\n      },\n      setFormAfterSubmit: function setFormAfterSubmit() {\n        dispatch({\n          type: 'SET_FORM_AFTER_SUBMIT'\n        });\n      }\n    };\n  });\n\n  var handleChangeCollectionTypeLeftActionRowCheckbox = function handleChangeCollectionTypeLeftActionRowCheckbox(pathToCollectionType, propertyName, rowName, value) {\n    dispatch({\n      type: 'ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX',\n      pathToCollectionType: pathToCollectionType,\n      propertyName: propertyName,\n      rowName: rowName,\n      value: value\n    });\n  };\n\n  var handleChangeCollectionTypeGlobalActionCheckbox = function handleChangeCollectionTypeGlobalActionCheckbox(collectionTypeKind, actionId, value) {\n    dispatch({\n      type: 'ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX',\n      collectionTypeKind: collectionTypeKind,\n      actionId: actionId,\n      value: value\n    });\n  };\n\n  var handleChangeConditions = function handleChangeConditions(conditions) {\n    dispatch({\n      type: 'ON_CHANGE_CONDITIONS',\n      conditions: conditions\n    });\n  };\n\n  var handleChangeSimpleCheckbox = (0, _react.useCallback)(function (_ref2) {\n    var _ref2$target = _ref2.target,\n        name = _ref2$target.name,\n        value = _ref2$target.value;\n    dispatch({\n      type: 'ON_CHANGE_SIMPLE_CHECKBOX',\n      keys: name,\n      value: value\n    });\n  }, []);\n  var handleChangeParentCheckbox = (0, _react.useCallback)(function (_ref3) {\n    var _ref3$target = _ref3.target,\n        name = _ref3$target.name,\n        value = _ref3$target.value;\n    dispatch({\n      type: 'ON_CHANGE_TOGGLE_PARENT_CHECKBOX',\n      keys: name,\n      value: value\n    });\n  }, []);\n  return /*#__PURE__*/_react[\"default\"].createElement(_PermissionsDataManagerProvider[\"default\"], {\n    value: {\n      availableConditions: layout.conditions,\n      modifiedData: modifiedData,\n      onChangeConditions: handleChangeConditions,\n      onChangeSimpleCheckbox: handleChangeSimpleCheckbox,\n      onChangeParentCheckbox: handleChangeParentCheckbox,\n      onChangeCollectionTypeLeftActionRowCheckbox: handleChangeCollectionTypeLeftActionRowCheckbox,\n      onChangeCollectionTypeGlobalActionCheckbox: handleChangeCollectionTypeGlobalActionCheckbox\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabGroup, {\n    id: \"tabs\",\n    label: formatMessage({\n      id: 'Settings.permissions.users.tabs.label',\n      defaultMessage: 'Tabs Permissions'\n    })\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.Tabs, null, _tabLabels[\"default\"].map(function (tabLabel) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Tabs.Tab, {\n      key: tabLabel.id\n    }, formatMessage({\n      id: tabLabel.labelId,\n      defaultMessage: tabLabel.defaultMessage\n    }));\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanels, {\n    style: {\n      position: 'relative'\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_ContentTypes[\"default\"], {\n    layout: layouts.collectionTypes,\n    kind: \"collectionTypes\",\n    isFormDisabled: isFormDisabled\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_ContentTypes[\"default\"], {\n    layout: layouts.singleTypes,\n    kind: \"singleTypes\",\n    isFormDisabled: isFormDisabled\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_PluginsAndSettings[\"default\"], {\n    layout: layouts.plugins,\n    kind: \"plugins\",\n    isFormDisabled: isFormDisabled\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Tabs.TabPanel, null, /*#__PURE__*/_react[\"default\"].createElement(_PluginsAndSettings[\"default\"], {\n    layout: layouts.settings,\n    kind: \"settings\",\n    isFormDisabled: isFormDisabled\n  })))));\n});\nPermissions.defaultProps = {\n  permissions: [],\n  layout: {\n    conditions: [],\n    sections: {\n      collectionTypes: {},\n      singleTypes: {\n        actions: []\n      },\n      settings: [],\n      plugins: []\n    }\n  }\n};\nPermissions.propTypes = {\n  layout: _propTypes[\"default\"].object,\n  isFormDisabled: _propTypes[\"default\"].bool.isRequired,\n  permissions: _propTypes[\"default\"].array\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(Permissions);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}