{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _Button = require(\"@strapi/design-system/Button\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _formik = require(\"formik\");\n\nvar _Link = require(\"@strapi/design-system/Link\");\n\nvar _ArrowLeft = _interopRequireDefault(require(\"@strapi/icons/ArrowLeft\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _components = require(\"./components\");\n\nvar _hooks = require(\"../../../../../hooks\");\n\nvar _schema = _interopRequireDefault(require(\"./utils/schema\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar EditPage = function EditPage() {\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useRouteMatch = (0, _reactRouterDom.useRouteMatch)('/settings/roles/:id'),\n      id = _useRouteMatch.params.id;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isSubmitting = _useState2[0],\n      setIsSubmiting = _useState2[1];\n\n  var permissionsRef = (0, _react.useRef)();\n\n  var _useOverlayBlocker = (0, _helperPlugin.useOverlayBlocker)(),\n      lockApp = _useOverlayBlocker.lockApp,\n      unlockApp = _useOverlayBlocker.unlockApp;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useFetchPermissionsL = (0, _hooks.useFetchPermissionsLayout)(id),\n      isLayoutLoading = _useFetchPermissionsL.isLoading,\n      permissionsLayout = _useFetchPermissionsL.data;\n\n  var _useFetchRole = (0, _hooks.useFetchRole)(id),\n      role = _useFetchRole.role,\n      rolePermissions = _useFetchRole.permissions,\n      isRoleLoading = _useFetchRole.isLoading,\n      onSubmitSucceeded = _useFetchRole.onSubmitSucceeded;\n\n  var handleEditRoleSubmit = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(data) {\n      var _permissionsRef$curre, permissionsToSend, didUpdateConditions, errorMessage, message;\n\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              lockApp();\n              setIsSubmiting(true);\n              _permissionsRef$curre = permissionsRef.current.getPermissions(), permissionsToSend = _permissionsRef$curre.permissionsToSend, didUpdateConditions = _permissionsRef$curre.didUpdateConditions;\n              _context.next = 6;\n              return (0, _helperPlugin.request)(\"/admin/roles/\".concat(id), {\n                method: 'PUT',\n                body: data\n              });\n\n            case 6:\n              if (!(role.code !== 'strapi-super-admin')) {\n                _context.next = 10;\n                break;\n              }\n\n              _context.next = 9;\n              return (0, _helperPlugin.request)(\"/admin/roles/\".concat(id, \"/permissions\"), {\n                method: 'PUT',\n                body: {\n                  permissions: permissionsToSend\n                }\n              });\n\n            case 9:\n              if (didUpdateConditions) {\n                trackUsage('didUpdateConditions');\n              }\n\n            case 10:\n              permissionsRef.current.setFormAfterSubmit();\n              onSubmitSucceeded({\n                name: data.name,\n                description: data.description\n              });\n              toggleNotification({\n                type: 'success',\n                message: {\n                  id: 'notification.success.saved'\n                }\n              });\n              _context.next = 21;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0.response);\n              errorMessage = (0, _get[\"default\"])(_context.t0, 'response.payload.message', 'An error occured');\n              message = (0, _get[\"default\"])(_context.t0, 'response.payload.data.permissions[0]', errorMessage);\n              toggleNotification({\n                type: 'warning',\n                message: message\n              });\n\n            case 21:\n              _context.prev = 21;\n              setIsSubmiting(false);\n              unlockApp();\n              return _context.finish(21);\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 15, 21, 25]]);\n    }));\n\n    return function handleEditRoleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var isFormDisabled = role.code === 'strapi-super-admin';\n  return /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, null, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.SettingsPageTitle, {\n    name: \"Roles\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_formik.Formik, {\n    enableReinitialize: true,\n    initialValues: {\n      name: role.name,\n      description: role.description\n    },\n    onSubmit: handleEditRoleSubmit,\n    validationSchema: _schema[\"default\"],\n    validateOnChange: false\n  }, function (_ref2) {\n    var handleSubmit = _ref2.handleSubmit,\n        values = _ref2.values,\n        errors = _ref2.errors,\n        handleChange = _ref2.handleChange,\n        handleBlur = _ref2.handleBlur;\n    return /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n      onSubmit: handleSubmit\n    }, /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n      primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n        horizontal: true,\n        spacing: 2\n      }, /*#__PURE__*/_react[\"default\"].createElement(_Button.Button, {\n        disabled: role.code === 'strapi-super-admin',\n        onClick: handleSubmit,\n        loading: isSubmitting,\n        size: \"L\"\n      }, formatMessage({\n        id: 'app.components.Button.save',\n        defaultMessage: 'Save'\n      }))),\n      title: formatMessage({\n        id: 'Settings.roles.edit.title',\n        defaultMessage: 'Edit a role'\n      }),\n      subtitle: formatMessage({\n        id: 'Settings.roles.create.description',\n        defaultMessage: 'Define the rights given to the role'\n      }),\n      navigationAction: /*#__PURE__*/_react[\"default\"].createElement(_Link.Link, {\n        startIcon: /*#__PURE__*/_react[\"default\"].createElement(_ArrowLeft[\"default\"], null),\n        to: \"/settings/roles\"\n      }, formatMessage({\n        id: 'app.components.go-back',\n        defaultMessage: 'Back'\n      }))\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n      spacing: 6\n    }, /*#__PURE__*/_react[\"default\"].createElement(_components.RoleForm, {\n      isLoading: isRoleLoading,\n      disabled: isFormDisabled,\n      errors: errors,\n      values: values,\n      onChange: handleChange,\n      onBlur: handleBlur,\n      role: role\n    }), !isLayoutLoading && !isRoleLoading ? /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      shadow: \"filterShadow\",\n      hasRadius: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_components.Permissions, {\n      isFormDisabled: isFormDisabled,\n      permissions: rolePermissions,\n      ref: permissionsRef,\n      layout: permissionsLayout\n    })) : /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      background: \"neutral0\",\n      padding: 6,\n      shadow: \"filterShadow\",\n      hasRadius: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null))))));\n  }));\n};\n\nvar _default = EditPage;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}