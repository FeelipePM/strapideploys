{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _reactErrorBoundary = require(\"react-error-boundary\");\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../permissions\"));\n\nvar _contexts = require(\"../../contexts\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"../../utils\");\n\nvar _EditViewLayoutManager = _interopRequireDefault(require(\"../EditViewLayoutManager\"));\n\nvar _EditSettingsView = _interopRequireDefault(require(\"../EditSettingsView\"));\n\nvar _ListViewLayoutManager = _interopRequireDefault(require(\"../ListViewLayoutManager\"));\n\nvar _ListSettingsView = _interopRequireDefault(require(\"../ListSettingsView\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar cmPermissions = _permissions[\"default\"].contentManager;\n\nvar CollectionTypeRecursivePath = function CollectionTypeRecursivePath(_ref) {\n  var _ref$match = _ref.match,\n      slug = _ref$match.params.slug,\n      url = _ref$match.url;\n\n  var _useFetchContentTypeL = (0, _hooks.useFetchContentTypeLayout)(slug),\n      isLoading = _useFetchContentTypeL.isLoading,\n      layout = _useFetchContentTypeL.layout,\n      updateLayout = _useFetchContentTypeL.updateLayout;\n\n  var _useMemo = (0, _react.useMemo)(function () {\n    var rawContentTypeLayout = {};\n    var rawComponentsLayouts = {};\n\n    if (layout.contentType) {\n      rawContentTypeLayout = (0, _utils.formatLayoutToApi)(layout.contentType);\n    }\n\n    if (layout.components) {\n      rawComponentsLayouts = Object.keys(layout.components).reduce(function (acc, current) {\n        acc[current] = (0, _utils.formatLayoutToApi)(layout.components[current]);\n        return acc;\n      }, {});\n    }\n\n    return {\n      rawContentTypeLayout: rawContentTypeLayout,\n      rawComponentsLayouts: rawComponentsLayouts\n    };\n  }, [layout]),\n      rawContentTypeLayout = _useMemo.rawContentTypeLayout,\n      rawComponentsLayouts = _useMemo.rawComponentsLayouts;\n\n  var uid = (0, _lodash.get)(layout, ['contentType', 'uid'], null); // This statement is needed in order to prevent the CollectionTypeFormWrapper effects clean up phase to be run twice.\n  // What can happen is that when navigating from one entry to another the cleanup phase of the fetch data effect is run twice : once when\n  // unmounting, once when the url changes.\n  // Since it can happen that the layout there's a delay when the layout is being fetched and the url changes adding the uid ! == slug\n  // statement prevent the component from being mounted and unmounted twice.\n\n  if (uid !== slug || isLoading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null);\n  }\n\n  var renderRoute = function renderRoute(_ref2, Component) {\n    var state = _ref2.location.state,\n        goBack = _ref2.history.goBack,\n        _ref2$match$params = _ref2.match.params,\n        id = _ref2$match$params.id,\n        origin = _ref2$match$params.origin;\n    return /*#__PURE__*/_react[\"default\"].createElement(Component, {\n      slug: slug,\n      layout: layout,\n      state: state,\n      goBack: goBack,\n      id: id,\n      origin: origin\n    });\n  };\n\n  var routes = [{\n    path: 'create/clone/:origin',\n    comp: _EditViewLayoutManager[\"default\"]\n  }, {\n    path: 'create',\n    comp: _EditViewLayoutManager[\"default\"]\n  }, {\n    path: ':id',\n    comp: _EditViewLayoutManager[\"default\"]\n  }, {\n    path: '',\n    comp: _ListViewLayoutManager[\"default\"]\n  }].map(function (_ref3) {\n    var path = _ref3.path,\n        comp = _ref3.comp;\n    return /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n      key: path,\n      path: \"\".concat(url, \"/\").concat(path),\n      render: function render(props) {\n        return renderRoute(props, comp);\n      }\n    });\n  });\n  return /*#__PURE__*/_react[\"default\"].createElement(_reactErrorBoundary.ErrorBoundary, {\n    FallbackComponent: _helperPlugin.ErrorFallback\n  }, /*#__PURE__*/_react[\"default\"].createElement(_contexts.ContentTypeLayoutContext.Provider, {\n    value: layout\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Switch, null, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"\".concat(url, \"/configurations/list\")\n  }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: cmPermissions.collectionTypesConfigurations\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ListSettingsView[\"default\"], {\n    layout: rawContentTypeLayout,\n    slug: slug,\n    updateLayout: updateLayout\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"\".concat(url, \"/configurations/edit\")\n  }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: cmPermissions.collectionTypesConfigurations\n  }, /*#__PURE__*/_react[\"default\"].createElement(_EditSettingsView[\"default\"], {\n    components: rawComponentsLayouts,\n    isContentTypeView: true,\n    mainLayout: rawContentTypeLayout,\n    slug: slug,\n    updateLayout: updateLayout\n  }))), routes)));\n};\n\nCollectionTypeRecursivePath.propTypes = {\n  match: _propTypes[\"default\"].shape({\n    url: _propTypes[\"default\"].string.isRequired,\n    params: _propTypes[\"default\"].shape({\n      slug: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }).isRequired\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(CollectionTypeRecursivePath);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}