{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.MarketPlacePage = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactHelmet = require(\"react-helmet\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _matchSorter = _interopRequireDefault(require(\"match-sorter\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Grid = require(\"@strapi/design-system/Grid\");\n\nvar _Layout = require(\"@strapi/design-system/Layout\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _Searchbar = require(\"@strapi/design-system/Searchbar\");\n\nvar _Box = require(\"@strapi/design-system/Box\");\n\nvar _LinkButton = require(\"@strapi/design-system/LinkButton\");\n\nvar _LiveRegions = require(\"@strapi/design-system/LiveRegions\");\n\nvar _Upload = _interopRequireDefault(require(\"@strapi/icons/Upload\"));\n\nvar _PluginCard = _interopRequireDefault(require(\"./components/PluginCard\"));\n\nvar _EmptyPluginSearch = require(\"./components/EmptyPluginSearch\");\n\nvar _api = require(\"./utils/api\");\n\nvar _useFetchInstalledPlugins = _interopRequireDefault(require(\"../../hooks/useFetchInstalledPlugins\"));\n\nvar _useFetchMarketplacePlugins = _interopRequireDefault(require(\"../../hooks/useFetchMarketplacePlugins\"));\n\nvar _permissions = _interopRequireDefault(require(\"../../permissions\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar matchSearch = function matchSearch(plugins, search) {\n  return (0, _matchSorter[\"default\"])(plugins, search, {\n    keys: [{\n      threshold: _matchSorter[\"default\"].rankings.WORD_STARTS_WITH,\n      key: 'attributes.name'\n    }, {\n      threshold: _matchSorter[\"default\"].rankings.WORD_STARTS_WITH,\n      key: 'attributes.description'\n    }]\n  });\n};\n\nvar MarketPlacePage = function MarketPlacePage() {\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var _useNotifyAT = (0, _LiveRegions.useNotifyAT)(),\n      notifyStatus = _useNotifyAT.notifyStatus;\n\n  var trackUsageRef = (0, _react.useRef)(trackUsage);\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useState = (0, _react.useState)(''),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      searchQuery = _useState2[0],\n      setSearchQuery = _useState2[1];\n\n  (0, _helperPlugin.useFocusWhenNavigate)();\n  var marketplaceTitle = formatMessage({\n    id: 'admin.pages.MarketPlacePage.title',\n    defaultMessage: 'Marketplace'\n  });\n\n  var notifyMarketplaceLoad = function notifyMarketplaceLoad() {\n    notifyStatus(formatMessage({\n      id: 'app.utils.notify.data-loaded',\n      defaultMessage: 'The {target} has loaded'\n    }, {\n      target: marketplaceTitle\n    }));\n  };\n\n  var _useFetchMarketplaceP = (0, _useFetchMarketplacePlugins[\"default\"])(notifyMarketplaceLoad),\n      marketplacePluginsStatus = _useFetchMarketplaceP.status,\n      marketplacePluginsResponse = _useFetchMarketplaceP.data;\n\n  var _useFetchInstalledPlu = (0, _useFetchInstalledPlugins[\"default\"])(),\n      installedPluginsStatus = _useFetchInstalledPlu.status,\n      installedPluginsResponse = _useFetchInstalledPlu.data;\n\n  var _useQuery = (0, _reactQuery.useQuery)('app-information', _api.fetchAppInformation, {\n    onError: function onError() {\n      toggleNotification({\n        type: 'warning',\n        message: {\n          id: 'notification.error',\n          defaultMessage: 'An error occured'\n        }\n      });\n    }\n  }),\n      appInfoResponse = _useQuery.data,\n      appInfoStatus = _useQuery.status;\n\n  var isLoading = [marketplacePluginsStatus, installedPluginsStatus, appInfoStatus].includes('loading');\n  var hasFailed = [marketplacePluginsStatus, installedPluginsStatus, appInfoStatus].includes('error');\n  (0, _react.useEffect)(function () {\n    trackUsageRef.current('didGoToMarketplace');\n  }, []);\n\n  if (hasFailed) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n      paddingTop: 8\n    }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.AnErrorOccurred, null))));\n  }\n\n  if (isLoading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, {\n      \"aria-busy\": true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null)));\n  }\n\n  var searchResults = matchSearch(marketplacePluginsResponse.data, searchQuery);\n  var installedPluginNames = installedPluginsResponse.plugins.map(function (plugin) {\n    return plugin.packageName;\n  });\n  return /*#__PURE__*/_react[\"default\"].createElement(_Layout.Layout, null, /*#__PURE__*/_react[\"default\"].createElement(_Main.Main, null, /*#__PURE__*/_react[\"default\"].createElement(_reactHelmet.Helmet, {\n    title: formatMessage({\n      id: 'admin.pages.MarketPlacePage.helmet',\n      defaultMessage: 'Marketplace - Plugins'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.HeaderLayout, {\n    title: formatMessage({\n      id: 'admin.pages.MarketPlacePage.title',\n      defaultMessage: 'Marketplace'\n    }),\n    subtitle: formatMessage({\n      id: 'admin.pages.MarketPlacePage.subtitle',\n      defaultMessage: 'Get more out of Strapi'\n    }),\n    primaryAction: /*#__PURE__*/_react[\"default\"].createElement(_LinkButton.LinkButton, {\n      startIcon: /*#__PURE__*/_react[\"default\"].createElement(_Upload[\"default\"], null),\n      variant: \"tertiary\",\n      href: \"https://market.strapi.io/submit-plugin\",\n      onClick: function onClick() {\n        return trackUsage('didSubmitPlugin');\n      }\n    }, formatMessage({\n      id: 'admin.pages.MarketPlacePage.submit.plugin.link',\n      defaultMessage: 'Submit your plugin'\n    }))\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Layout.ContentLayout, null, /*#__PURE__*/_react[\"default\"].createElement(_Box.Box, {\n    width: \"25%\",\n    paddingBottom: 4\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Searchbar.Searchbar, {\n    name: \"searchbar\",\n    onClear: function onClear() {\n      return setSearchQuery('');\n    },\n    value: searchQuery,\n    onChange: function onChange(e) {\n      return setSearchQuery(e.target.value);\n    },\n    clearLabel: formatMessage({\n      id: 'admin.pages.MarketPlacePage.search.clear',\n      defaultMessage: 'Clear the plugin search'\n    }),\n    placeholder: formatMessage({\n      id: 'admin.pages.MarketPlacePage.search.placeholder',\n      defaultMessage: 'Search for a plugin'\n    })\n  }, formatMessage({\n    id: 'admin.pages.MarketPlacePage.search.placeholder',\n    defaultMessage: 'Search for a plugin'\n  }))), searchQuery.length > 0 && !searchResults.length ? /*#__PURE__*/_react[\"default\"].createElement(_EmptyPluginSearch.EmptyPluginSearch, {\n    content: formatMessage({\n      id: 'admin.pages.MarketPlacePage.search.empty',\n      defaultMessage: 'No result for \"{target}\"'\n    }, {\n      target: searchQuery\n    })\n  }) : /*#__PURE__*/_react[\"default\"].createElement(_Grid.Grid, {\n    gap: 4\n  }, searchResults.map(function (plugin) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_Grid.GridItem, {\n      col: 4,\n      s: 6,\n      xs: 12,\n      style: {\n        height: '100%'\n      },\n      key: plugin.id\n    }, /*#__PURE__*/_react[\"default\"].createElement(_PluginCard[\"default\"], {\n      plugin: plugin,\n      installedPluginNames: installedPluginNames,\n      useYarn: appInfoResponse.data.useYarn\n    }));\n  })))));\n};\n\nexports.MarketPlacePage = MarketPlacePage;\n\nvar ProtectedMarketPlace = function ProtectedMarketPlace() {\n  return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.CheckPagePermissions, {\n    permissions: _permissions[\"default\"].marketplace.main\n  }, /*#__PURE__*/_react[\"default\"].createElement(MarketPlacePage, null));\n};\n\nvar _default = ProtectedMarketPlace;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}