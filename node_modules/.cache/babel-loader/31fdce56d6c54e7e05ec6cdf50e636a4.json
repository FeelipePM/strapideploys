{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _Main = require(\"@strapi/design-system/Main\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _PrivateRoute = _interopRequireDefault(require(\"../../components/PrivateRoute\"));\n\nvar _utils = require(\"../../utils\");\n\nvar _AuthPage = _interopRequireDefault(require(\"../AuthPage\"));\n\nvar _NotFoundPage = _interopRequireDefault(require(\"../NotFoundPage\"));\n\nvar _UseCasePage = _interopRequireDefault(require(\"../UseCasePage\"));\n\nvar _utils2 = require(\"./utils\");\n\nvar _routes = _interopRequireDefault(require(\"./utils/routes\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar AuthenticatedApp = /*#__PURE__*/(0, _react.lazy)(function () {\n  return import(\n  /* webpackChunkName: \"Admin-authenticatedApp\" */\n  '../../components/AuthenticatedApp');\n});\n\nfunction App() {\n  var toggleNotification = (0, _helperPlugin.useNotification)();\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)({\n    isLoading: true,\n    hasAdmin: false\n  }),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      _useState2$ = _useState2[0],\n      isLoading = _useState2$.isLoading,\n      hasAdmin = _useState2$.hasAdmin,\n      uuid = _useState2$.uuid,\n      setState = _useState2[1];\n\n  var authRoutes = (0, _react.useMemo)(function () {\n    return (0, _utils.makeUniqueRoutes)(_routes[\"default\"].map(function (_ref) {\n      var to = _ref.to,\n          Component = _ref.Component,\n          exact = _ref.exact;\n      return (0, _utils.createRoute)(Component, to, exact);\n    }));\n  }, []);\n  (0, _react.useEffect)(function () {\n    var currentToken = _helperPlugin.auth.getToken();\n\n    var renewToken = /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        var _yield$request, token;\n\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return (0, _helperPlugin.request)('/admin/renew-token', {\n                  method: 'POST',\n                  body: {\n                    token: currentToken\n                  }\n                });\n\n              case 3:\n                _yield$request = _context.sent;\n                token = _yield$request.data.token;\n\n                _helperPlugin.auth.updateToken(token);\n\n                _context.next = 12;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n\n                // Refresh app\n                _helperPlugin.auth.clearAppStorage();\n\n                window.location.reload();\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8]]);\n      }));\n\n      return function renewToken() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    if (currentToken) {\n      renewToken();\n    }\n  }, []);\n  (0, _react.useEffect)(function () {\n    var getData = /*#__PURE__*/function () {\n      var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n        var _yield$request2, _yield$request2$data, _hasAdmin, _uuid, deviceId;\n\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return (0, _helperPlugin.request)('/admin/init', {\n                  method: 'GET'\n                });\n\n              case 3:\n                _yield$request2 = _context2.sent;\n                _yield$request2$data = _yield$request2.data;\n                _hasAdmin = _yield$request2$data.hasAdmin;\n                _uuid = _yield$request2$data.uuid;\n\n                if (!_uuid) {\n                  _context2.next = 17;\n                  break;\n                }\n\n                _context2.prev = 8;\n                _context2.next = 11;\n                return (0, _utils2.getUID)();\n\n              case 11:\n                deviceId = _context2.sent;\n                fetch('https://analytics.strapi.io/track', {\n                  method: 'POST',\n                  body: JSON.stringify({\n                    event: 'didInitializeAdministration',\n                    uuid: _uuid,\n                    deviceId: deviceId\n                  }),\n                  headers: {\n                    'Content-Type': 'application/json'\n                  }\n                });\n                _context2.next = 17;\n                break;\n\n              case 15:\n                _context2.prev = 15;\n                _context2.t0 = _context2[\"catch\"](8);\n\n              case 17:\n                setState({\n                  isLoading: false,\n                  hasAdmin: _hasAdmin,\n                  uuid: _uuid\n                });\n                _context2.next = 23;\n                break;\n\n              case 20:\n                _context2.prev = 20;\n                _context2.t1 = _context2[\"catch\"](0);\n                toggleNotification({\n                  type: 'warning',\n                  message: {\n                    id: 'app.containers.App.notification.error.init'\n                  }\n                });\n\n              case 23:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 20], [8, 15]]);\n      }));\n\n      return function getData() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    getData();\n  }, [toggleNotification]);\n\n  var setHasAdmin = function setHasAdmin(hasAdmin) {\n    return setState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        hasAdmin: hasAdmin\n      });\n    });\n  };\n\n  if (isLoading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null);\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_react.Suspense, {\n    fallback: /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.LoadingIndicatorPage, null)\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Main.SkipToContent, null, formatMessage({\n    id: 'skipToContent'\n  })), /*#__PURE__*/_react[\"default\"].createElement(_helperPlugin.TrackingContext.Provider, {\n    value: uuid\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Switch, null, authRoutes, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"/auth/:authType\",\n    render: function render(routerProps) {\n      return /*#__PURE__*/_react[\"default\"].createElement(_AuthPage[\"default\"], (0, _extends2[\"default\"])({}, routerProps, {\n        setHasAdmin: setHasAdmin,\n        hasAdmin: hasAdmin\n      }));\n    },\n    exact: true\n  }), /*#__PURE__*/_react[\"default\"].createElement(_PrivateRoute[\"default\"], {\n    path: \"/usecase\",\n    component: _UseCasePage[\"default\"]\n  }), /*#__PURE__*/_react[\"default\"].createElement(_PrivateRoute[\"default\"], {\n    path: \"/\",\n    component: AuthenticatedApp\n  }), /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"\",\n    component: _NotFoundPage[\"default\"]\n  }))));\n}\n\nvar _default = App;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}