{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = require(\"react\");\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _getPluginSectionLinks = _interopRequireDefault(require(\"./utils/getPluginSectionLinks\"));\n\nvar _getGeneralLinks = _interopRequireDefault(require(\"./utils/getGeneralLinks\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar useMenu = function useMenu() {\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _useRBACProvider = (0, _helperPlugin.useRBACProvider)(),\n      allPermissions = _useRBACProvider.allPermissions;\n\n  var _useAppInfos = (0, _helperPlugin.useAppInfos)(),\n      shouldUpdateStrapi = _useAppInfos.shouldUpdateStrapi;\n\n  var _useStrapiApp = (0, _helperPlugin.useStrapiApp)(),\n      menu = _useStrapiApp.menu; // We are using a ref because we don't want our effect to have this in its dependencies array\n\n\n  var generalSectionLinksRef = (0, _react.useRef)(state.generalSectionLinks);\n  var shouldUpdateStrapiRef = (0, _react.useRef)(shouldUpdateStrapi); // Once in the app lifecycle the menu should not be added into any dependencies array\n\n  var resolvePermissions = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var permissions,\n          pluginsSectionLinks,\n          authorizedPluginSectionLinks,\n          authorizedGeneralSectionLinks,\n          _args = arguments;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              permissions = _args.length > 0 && _args[0] !== undefined ? _args[0] : allPermissions;\n              pluginsSectionLinks = menu;\n              _context.next = 4;\n              return (0, _getPluginSectionLinks[\"default\"])(permissions, pluginsSectionLinks);\n\n            case 4:\n              authorizedPluginSectionLinks = _context.sent;\n              _context.next = 7;\n              return (0, _getGeneralLinks[\"default\"])(permissions, generalSectionLinksRef.current, shouldUpdateStrapiRef.current);\n\n            case 7:\n              authorizedGeneralSectionLinks = _context.sent;\n              dispatch({\n                type: 'SET_SECTION_LINKS',\n                data: {\n                  authorizedGeneralSectionLinks: authorizedGeneralSectionLinks,\n                  authorizedPluginSectionLinks: authorizedPluginSectionLinks\n                }\n              });\n              dispatch({\n                type: 'UNSET_IS_LOADING'\n              });\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function resolvePermissions() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var resolvePermissionsRef = (0, _react.useRef)(resolvePermissions);\n  (0, _react.useEffect)(function () {\n    resolvePermissionsRef.current(allPermissions);\n  }, [allPermissions, dispatch]);\n  return state;\n};\n\nvar _default = useMenu;\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}