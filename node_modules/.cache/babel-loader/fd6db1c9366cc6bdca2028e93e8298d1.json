{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PreviewBox = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _Stack = require(\"@strapi/design-system/Stack\");\n\nvar _IconButton = require(\"@strapi/design-system/IconButton\");\n\nvar _Trash = _interopRequireDefault(require(\"@strapi/icons/Trash\"));\n\nvar _Download = _interopRequireDefault(require(\"@strapi/icons/Download\"));\n\nvar _Crop = _interopRequireDefault(require(\"@strapi/icons/Crop\"));\n\nvar _helperPlugin = require(\"@strapi/helper-plugin\");\n\nvar _getTrad = _interopRequireDefault(require(\"../../../utils/getTrad\"));\n\nvar _downloadFile = require(\"../../../utils/downloadFile\");\n\nvar _RemoveAssetDialog = require(\"../RemoveAssetDialog\");\n\nvar _useCropImg2 = require(\"../../../hooks/useCropImg\");\n\nvar _useEditAsset2 = require(\"../../../hooks/useEditAsset\");\n\nvar _useUpload2 = require(\"../../../hooks/useUpload\");\n\nvar _components = require(\"./components\");\n\nvar _CroppingActions = require(\"./CroppingActions\");\n\nvar _CopyLinkButton = require(\"../../CopyLinkButton\");\n\nvar _UploadProgress = require(\"../../UploadProgress\");\n\nvar _constants = require(\"../../../constants\");\n\nvar _AssetPreview = require(\"./AssetPreview\");\n\nvar _createAssetUrl = require(\"../../../utils/createAssetUrl\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar PreviewBox = function PreviewBox(_ref) {\n  var asset = _ref.asset,\n      canUpdate = _ref.canUpdate,\n      canCopyLink = _ref.canCopyLink,\n      canDownload = _ref.canDownload,\n      onDelete = _ref.onDelete,\n      onCropFinish = _ref.onCropFinish,\n      onCropStart = _ref.onCropStart,\n      onCropCancel = _ref.onCropCancel,\n      replacementFile = _ref.replacementFile,\n      trackedLocation = _ref.trackedLocation;\n\n  var _useTracking = (0, _helperPlugin.useTracking)(),\n      trackUsage = _useTracking.trackUsage;\n\n  var previewRef = (0, _react.useRef)(null);\n\n  var _useState = (0, _react.useState)((0, _createAssetUrl.createAssetUrl)(asset, false)),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      assetUrl = _useState2[0],\n      setAssetUrl = _useState2[1];\n\n  var _useState3 = (0, _react.useState)((0, _createAssetUrl.createAssetUrl)(asset, true)),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      thumbnailUrl = _useState4[0],\n      setThumbnailUrl = _useState4[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState5 = (0, _react.useState)(false),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      showConfirmDialog = _useState6[0],\n      setShowConfirmDialog = _useState6[1];\n\n  var _useCropImg = (0, _useCropImg2.useCropImg)(),\n      crop = _useCropImg.crop,\n      produceFile = _useCropImg.produceFile,\n      stopCropping = _useCropImg.stopCropping,\n      isCropping = _useCropImg.isCropping,\n      isCropperReady = _useCropImg.isCropperReady,\n      width = _useCropImg.width,\n      height = _useCropImg.height;\n\n  var _useEditAsset = (0, _useEditAsset2.useEditAsset)(),\n      editAsset = _useEditAsset.editAsset,\n      error = _useEditAsset.error,\n      isLoading = _useEditAsset.isLoading,\n      progress = _useEditAsset.progress,\n      cancel = _useEditAsset.cancel;\n\n  var _useUpload = (0, _useUpload2.useUpload)(),\n      upload = _useUpload.upload,\n      isLoadingUpload = _useUpload.isLoading,\n      cancelUpload = _useUpload.cancel,\n      uploadError = _useUpload.error,\n      progressUpload = _useUpload.progress;\n\n  (0, _react.useEffect)(function () {\n    // Whenever a replacementUrl is set, make sure to permutate the real asset.url by\n    // the locally generated one\n    if (replacementFile) {\n      var fileLocalUrl = URL.createObjectURL(replacementFile);\n\n      if (asset.isLocal) {\n        asset.url = fileLocalUrl;\n      }\n\n      setAssetUrl(fileLocalUrl);\n      setThumbnailUrl(fileLocalUrl);\n    }\n  }, [replacementFile, asset]);\n\n  var handleCropping = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var nextAsset, file, optimizedCachingImage, optimizedCachingThumbnailImage, updatedAsset;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              nextAsset = _objectSpread(_objectSpread({}, asset), {}, {\n                width: width,\n                height: height\n              });\n              _context.next = 3;\n              return produceFile(nextAsset.name, nextAsset.mime, nextAsset.updatedAt);\n\n            case 3:\n              file = _context.sent;\n\n              if (!asset.isLocal) {\n                _context.next = 12;\n                break;\n              }\n\n              optimizedCachingImage = URL.createObjectURL(file);\n              optimizedCachingThumbnailImage = optimizedCachingImage;\n              asset.url = optimizedCachingImage;\n              asset.rawFile = file;\n              trackUsage('didCropFile', {\n                duplicatedFile: null,\n                location: trackedLocation\n              });\n              _context.next = 18;\n              break;\n\n            case 12:\n              _context.next = 14;\n              return editAsset(nextAsset, file);\n\n            case 14:\n              updatedAsset = _context.sent;\n              optimizedCachingImage = (0, _createAssetUrl.createAssetUrl)(updatedAsset, false);\n              optimizedCachingThumbnailImage = (0, _createAssetUrl.createAssetUrl)(updatedAsset, true);\n              trackUsage('didCropFile', {\n                duplicatedFile: false,\n                location: trackedLocation\n              });\n\n            case 18:\n              stopCropping();\n              onCropCancel();\n              setAssetUrl(optimizedCachingImage);\n              setThumbnailUrl(optimizedCachingThumbnailImage);\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleCropping() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var isInCroppingMode = isCropping && !isLoading;\n\n  var handleDuplication = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      var nextAsset, file;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              nextAsset = _objectSpread(_objectSpread({}, asset), {}, {\n                width: width,\n                height: height\n              });\n              _context2.next = 3;\n              return produceFile(nextAsset.name, nextAsset.mime, nextAsset.updatedAt);\n\n            case 3:\n              file = _context2.sent;\n              _context2.next = 6;\n              return upload({\n                name: file.name,\n                rawFile: file\n              });\n\n            case 6:\n              trackUsage('didCropFile', {\n                duplicatedFile: true,\n                location: trackedLocation\n              });\n              stopCropping();\n              onCropFinish();\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleDuplication() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleCropCancel = function handleCropCancel() {\n    stopCropping();\n    onCropCancel();\n  };\n\n  var handleCropStart = function handleCropStart() {\n    crop(previewRef.current);\n    onCropStart();\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_components.RelativeBox, {\n    hasRadius: true,\n    background: \"neutral150\",\n    borderColor: \"neutral200\"\n  }, isCropperReady && isInCroppingMode && /*#__PURE__*/_react[\"default\"].createElement(_CroppingActions.CroppingActions, {\n    onValidate: handleCropping,\n    onDuplicate: asset.isLocal ? undefined : handleDuplication,\n    onCancel: handleCropCancel\n  }), /*#__PURE__*/_react[\"default\"].createElement(_components.ActionRow, {\n    paddingLeft: 3,\n    paddingRight: 3,\n    justifyContent: \"flex-end\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Stack.Stack, {\n    spacing: 1,\n    horizontal: true\n  }, canUpdate && !asset.isLocal && /*#__PURE__*/_react[\"default\"].createElement(_IconButton.IconButton, {\n    label: formatMessage({\n      id: (0, _getTrad[\"default\"])('app.utils.delete'),\n      defaultMessage: 'Delete'\n    }),\n    icon: /*#__PURE__*/_react[\"default\"].createElement(_Trash[\"default\"], null),\n    onClick: function onClick() {\n      return setShowConfirmDialog(true);\n    }\n  }), canDownload && /*#__PURE__*/_react[\"default\"].createElement(_IconButton.IconButton, {\n    label: formatMessage({\n      id: (0, _getTrad[\"default\"])('control-card.download'),\n      defaultMessage: 'Download'\n    }),\n    icon: /*#__PURE__*/_react[\"default\"].createElement(_Download[\"default\"], null),\n    onClick: function onClick() {\n      return (0, _downloadFile.downloadFile)(assetUrl, asset.name);\n    }\n  }), canCopyLink && /*#__PURE__*/_react[\"default\"].createElement(_CopyLinkButton.CopyLinkButton, {\n    url: assetUrl\n  }), canUpdate && asset.mime.includes(_constants.AssetType.Image) && /*#__PURE__*/_react[\"default\"].createElement(_IconButton.IconButton, {\n    label: formatMessage({\n      id: (0, _getTrad[\"default\"])('control-card.crop'),\n      defaultMessage: 'Crop'\n    }),\n    icon: /*#__PURE__*/_react[\"default\"].createElement(_Crop[\"default\"], null),\n    onClick: handleCropStart\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_components.Wrapper, null, isLoading && /*#__PURE__*/_react[\"default\"].createElement(_components.UploadProgressWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(_UploadProgress.UploadProgress, {\n    error: error,\n    onCancel: cancel,\n    progress: progress\n  })), isLoadingUpload && /*#__PURE__*/_react[\"default\"].createElement(_components.UploadProgressWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(_UploadProgress.UploadProgress, {\n    error: uploadError,\n    onCancel: cancelUpload,\n    progress: progressUpload\n  })), /*#__PURE__*/_react[\"default\"].createElement(_AssetPreview.AssetPreview, {\n    ref: previewRef,\n    mime: asset.mime,\n    name: asset.name,\n    url: thumbnailUrl\n  })), /*#__PURE__*/_react[\"default\"].createElement(_components.ActionRow, {\n    paddingLeft: 2,\n    paddingRight: 2,\n    justifyContent: \"flex-end\",\n    blurry: isInCroppingMode\n  }, isInCroppingMode && width && height && /*#__PURE__*/_react[\"default\"].createElement(_components.BadgeOverride, {\n    background: \"neutral900\",\n    color: \"neutral0\"\n  }, width && height ? \"\".concat(height, \"\\u2715\").concat(width) : 'N/A'))), showConfirmDialog && /*#__PURE__*/_react[\"default\"].createElement(_RemoveAssetDialog.RemoveAssetDialog, {\n    onClose: function onClose() {\n      setShowConfirmDialog(false);\n      onDelete(null);\n    },\n    asset: asset\n  }));\n};\n\nexports.PreviewBox = PreviewBox;\nPreviewBox.defaultProps = {\n  replacementFile: undefined,\n  trackedLocation: undefined\n};\nPreviewBox.propTypes = {\n  canUpdate: _propTypes[\"default\"].bool.isRequired,\n  canCopyLink: _propTypes[\"default\"].bool.isRequired,\n  canDownload: _propTypes[\"default\"].bool.isRequired,\n  replacementFile: _propTypes[\"default\"].instanceOf(File),\n  asset: _constants.AssetDefinition.isRequired,\n  onDelete: _propTypes[\"default\"].func.isRequired,\n  onCropFinish: _propTypes[\"default\"].func.isRequired,\n  onCropStart: _propTypes[\"default\"].func.isRequired,\n  onCropCancel: _propTypes[\"default\"].func.isRequired,\n  trackedLocation: _propTypes[\"default\"].string\n};","map":null,"metadata":{},"sourceType":"script"}